/**
 * Class: Player 
 * Class: PlayerEvent 
 * Class: VideoEvent 
 * Class: VideoErrorEvent  
 *
 * Class: Playlist 
 * Class: PlaylistEvent 
 *
 * Package: org.pbskids.video
 * 
 * Updated: 2013-06-14
 *
 * Author: Renzo Olguin
 * Email: rmolguin@pbs.org
 */
	
 /**
 * jQuery resize event - v1.1 - 3/14/2010
 * http://benalman.com/projects/jquery-resize-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
 
/**
 * SWFObject v2.2 <http://code.google.com/p/swfobject/>
 * is released under the MIT License
 * <http://www.opensource.org/licenses/mit-license.php>
 */
 
 /**
 * ISCROLL v4.2.pbsk (PBS KIDS MOD)
 * A modified version of iScroll v4.2 for creating
 * custom scrollable & swipable lists across devices. This modded version has
 * features not found in the iScroll v4.2 (found at http://cubiq.org)
 *
 * original: iScroll v4.2.2 ~ Copyright (c) 2012 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 *
 * source : http://pbskids.org/pbsk/js/org.pbskids.iscroll.mod.js
 *
 * Package: org.pbskids
 * Generates: org.pbskids.iScrollMOD
 * Usage: var myScroll = new org.pbskids.iScrollMOD( (String) elementID, {Optional Params...} );
 */
 var org;if(!org)org={};else if(typeof org!="object")throw new Error("org already exists and is not an object");if(!org.pbskids)org.pbskids={};else if(typeof org.pbskids!="object")throw new Error("org.pbskids already exists and is not an object");if(!org.pbskids.video)org.pbskids.video={};else if(typeof org.pbskids.video!="object")throw new Error("org.pbskids.video already exists and is not an object");org.pbskids.video.Player=function(e,t){function Tt(){$.ajax({type:"GET",url:f+"getHostProgram/",dataType:"jsonp",data:{program:window.location.href},fail:function(){var e="Connection error, please try again in a moment";throw new Error(e)},success:function(e){if(e)if(e.playerName){v=e.playerName;m=e.affiliateId||"";g=e.defaultProgram||"";y="";Dt("Validated","Player Location",window.location.href);if(g){$.ajax({type:"GET",url:f+"getShows/",dataType:"jsonp",data:{title:g},fail:function(){var e="Connection error, please try again in a moment";throw new Error(e)},success:function(e){if(!e.matched){y=g;g=""}Nt()}})}else{Nt()}return}var t="This is not an authorized instance of a PBS KIDS video player";throw new Error(t)}})}function Nt(){St.debugMode=St.debugMode&&console;org.pbskids.video.PlayerEvent.debugMode=St.debugMode;org.pbskids.video.VideoEvent.debugMode=St.debugMode;org.pbskids.video.VideoErrorEvent.debugMode=St.debugMode;bn()}function Ct(){var t={allowFullScreen:"true",scale:"default",allowscriptaccess:"always",menu:"false",wmode:"opaque",bgcolor:"#000000"},n={id:e+"-swf",name:e+"-swf"},r={isTouchDevice:mt,onVideoClick:St.onVideoClick,onHoverOverlay:"{"+"'url'       : '"+St.onHoverOverlay.url+"', "+"'width'     : '"+St.onHoverOverlay.width+"', "+"'height'    : '"+St.onHoverOverlay.height+"', "+"'fs_url'    : '"+St.onHoverOverlay.fs_url+"', "+"'fs_width'  : '"+St.onHoverOverlay.fs_width+"', "+"'fs_height' : '"+St.onHoverOverlay.fs_height+"', "+"'alignment' : '"+"TR"+"'  "+"}",playButtonOverlay:"{"+"'url'       : '"+St.playIconOverlay.url+"', "+"'width'     : '"+St.playIconOverlay.width+"', "+"'height'    : '"+St.playIconOverlay.height+"', "+"'color'     : '"+St.playIconOverlay.color+"', "+"'opacity'   : '"+St.playIconOverlay.opacity+"', "+"'alignment' : '"+"MM"+"'  "+"}",loadingOverlay:"{"+"'url'       : '"+St.loadingOverlay.url+"', "+"'swf'       : '"+St.loadingOverlay.swf+"', "+"'width'     : '"+St.loadingOverlay.width+"', "+"'height'    : '"+St.loadingOverlay.height+"', "+"'color'     : '"+St.loadingOverlay.color+"', "+"'opacity'   : '"+St.loadingOverlay.opacity+"', "+"'alignment' : '"+"MM"+"'  "+"}",PlayerEvents:"{ 'PlayerReady'         : 'org.pbskids.video.PlayerEvent.dispatchEvent'}",VideoEvents:"{"+" 'VideoEnd'            : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'MuteChange'          : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'VolumeChange'        : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'PlayStateChange'     : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'DurationChange'      : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'CurrentTimeChange'   : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'SeekingChange'       : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'CaptionsStateChange' : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'CanPlayStateChange'  : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'CanSeekStateChange'  : 'org.pbskids.video.VideoEvent.dispatchEvent', "+" 'LoadStateChange'     : 'org.pbskids.video.VideoEvent.dispatchEvent'  "+"}",VideoErrorEvents:"{"+" 'GeoRestricted' : 'org.pbskids.video.VideoErrorEvent.dispatchEvent', "+" 'VideoNotFound' : 'org.pbskids.video.VideoErrorEvent.dispatchEvent', "+" 'VideoExpired'  : 'org.pbskids.video.VideoErrorEvent.dispatchEvent', "+" 'NoResponse'    : 'org.pbskids.video.VideoErrorEvent.dispatchEvent'  "+"}"};$(document).on(org.pbskids.video.PlayerEvent.PLAYER_READY,At);$("<div/>").prop("id","temp-swf-container").append($("<div/>").prop("id","replace-with-flash-content")).insertBefore("#"+e);org.pbskids.swfobject2_2.embedSWF(u,"replace-with-flash-content","100%","100%",l,a,r,t,n,Lt)}function kt(){if(!(ct||ot||at||ft)){Mt()}else{h=$("video#"+e).length>0?$("video#"+e):$("#"+e+" video").length>0?$("#"+e+" video").first():$("<video/>").appendTo("#"+e);d="html5";p=at||ft?"flash":"iphone";if(!ht){w=$("<div/>").insertAfter($("#"+e)).css({position:"relative","z-index":"200",height:"0",overflow:"hidden"});if(St.playIconOverlay.url){x=$("<div/>").appendTo(w).addClass("overlay").append($("<img/>").prop("src",St.playIconOverlay.url).css({"line-height":"normal","vertical-align":"middle","max-height":"100%"})).css({width:"100%",height:"100%","text-align":"center","line-height":"inherit",position:"absolute","background-image":"url("+o+"pbsk/video/img/background_"+St.playIconOverlay.color+"_opacity_"+St.playIconOverlay.opacity+".png)",cursor:"pointer"}).hide().click(Zt);if(St.playIconOverlay.width)$("img",x).css("width",St.playIconOverlay.width);if(St.playIconOverlay.height)$("img",x).css("height",St.playIconOverlay.height)}if(St.loadingOverlay.url){S=$("<div/>").appendTo(w).addClass("overlay").append($("<img/>").prop("src",St.loadingOverlay.url).css({"line-height":"normal","vertical-align":"middle","max-height":"100%"})).css({width:"100%",height:"100%","text-align":"center","line-height":"inherit",position:"absolute","background-image":"url("+o+"pbsk/video/img/background_"+St.loadingOverlay.color+"_opacity_"+St.loadingOverlay.opacity+".png)"}).hide();if(St.loadingOverlay.width)$("img",S).css("width",St.loadingOverlay.width);if(St.loadingOverlay.height)$("img",S).css("height",St.loadingOverlay.height)}if(St.onVideoClick||St.onHoverOverlay.url){T=$("<div/>").prependTo(w).addClass("overlay").css({width:"100%",height:"100%",position:"absolute",cursor:"pointer"});if(St.onVideoClick)T.click(vn);if(St.onHoverOverlay.url){$("<img/>").prop("src",St.onHoverOverlay.url).css({bottom:"4px",right:"4px",position:"absolute","max-height":"100%"}).appendTo(T);if(St.onHoverOverlay.width)$("img",T).css("width",St.onHoverOverlay.width);if(St.onHoverOverlay.height)$("img",T).css("height",St.onHoverOverlay.height);if(!mt){$("img",T).hide();T.hover(function(){$("img",T).show()},function(){$("img",T).hide()})}}}E=$("<div/>").appendTo(w).addClass("overlay").css({width:"100%",height:"100%",position:"absolute","background-image":"url("+o+"pbsk/video/img/background_black_opacity_80.png)"}).hide()}if(typeof document.cancelFullScreen!="undefined"){et=true}else if(ct||ot&&!at){et=true;nt="webkit"}else{for(var t=0;t<rt.length;t++){nt=rt[t];if(typeof document[nt+"CancelFullScreen"]!="undefined"){et=true;break}}}It();jt();Ot()}}function Lt(t){if(St.debugMode)console.log(" _onFlashCheck() :: succes = "+t.success);if(t.success){et=true;k=true;d="flash";p="flash";h=t.ref;$("#"+e).remove();$("#temp-swf-container").prop("id",e).css({overflow:"hidden"});if(M)Ot(null);else yn()}else{$("#temp-swf-container").remove();kt()}}function At(e){$(document).off(org.pbskids.video.PlayerEvent.PLAYER_READY,At);if(St.debugMode)console.log(" _onFlashPlayerReady() ");M=true;if(k)Ot(e)}function Ot(t){if(St.debugMode)console.log("_initSuccessful()");b.registerControl("muteToggleControl",St["muteToggleControl"]||"");b.registerControl("pauseToggleControl",St["pauseToggleControl"]||"");b.registerControl("captionsToggleControl",St["captionsToggleControl"]||"");b.registerControl("timerRemaining",St["timerRemaining"]||"");b.registerControl("timerCurrent",St["timerCurrent"]||"");b.registerControl("timerDuration",St["timerDuration"]||"");b.registerControl("scrubber",St["scrubber"]||"");b.registerControl("volumeDisplay",St["volumeDisplay"]||"");b.registerControl("volumeSlider",St["volumeSlider"]||"");b.registerControl("verticalVolumeSlider",St["verticalVolumeSlider"]||"");$(window).resize(gn);$(document).on(org.pbskids.video.VideoEvent.PLAY_STATE_CHANGE,sn);$(document).on(org.pbskids.video.VideoEvent.CURRENT_TIME_CHANGE,fn);$(document).on(org.pbskids.video.VideoEvent.DURATION_CHANGE,ln);$(document).on(org.pbskids.video.VideoEvent.SEEKING_CHANGE,an);$(document).on(org.pbskids.video.VideoEvent.CAN_PLAY_STATE_CHANGE,on);$(document).on(org.pbskids.video.VideoEvent.CAN_SEEK_STATE_CHANGE,un);$(document).on(org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE,rn);$(document).on(org.pbskids.video.VideoEvent.VIDEO_END,cn);if(!mt){$(document).on(org.pbskids.video.VideoEvent.MUTE_CHANGE,hn);$(document).on(org.pbskids.video.VideoEvent.VOLUME_CHANGE,pn);if(k){$(document).on(org.pbskids.video.VideoEvent.CAPTIONS_STATE_CHANGE,dn)}}var n={success:true,id:$(h).prop("id"),ref:h,player:b,message:""};if(typeof St.onPlayerComplete==="function")St.onPlayerComplete.call(this,n);if(!t){n.eventType=org.pbskids.video.PlayerEvent.PLAYER_READY;org.pbskids.video.PlayerEvent.dispatchEvent(n)}$("#"+e).resize(yn);yn();if(St.debugMode){console.log("----------------------------------------");console.log("supportsFullScreen: "+et);console.log("browserPrefix: "+nt);console.log("fullScreenEvent: "+tt);console.log("----------------------------------------");console.log("isFlashPlayer: "+k);console.log("videoType: "+p);console.log("playerType: "+d);console.log("----------------------------------------");console.log("IS_IE: "+st);console.log("IS_SAFARI: "+ot);console.log("----------------------------------------");console.log("IS_GOOGLE_TV: "+ut);console.log("IS_ANDROID: "+at);console.log("IS_KINDLE_FIRE: "+ft);console.log("IS_iDEVICE: "+ct);console.log("IS_iPOCKET: "+ht);console.log("IS_iPAD: "+pt);console.log("IS_TOUCH_PAD: "+dt);console.log("HAS_TOUCH: "+mt);console.log("HAS_POINTER: "+vt);console.log("----------------------------------------");console.log("UA-String: "+navigator.appVersion)}}function Mt(){var t={success:false,id:e,ref:null,player:null,message:'To watch videos from your favorite PBS KIDS shows, please install <a href="http://get.adobe.com/flashplayer/">Adobe Flash</a>, or watch on an iPad, iPhone, or iPod Touch.'};if(typeof St.onPlayerComplete==="function")St.onPlayerComplete.call(this,t)}function _t(e,t,n,r,i){if(!e){var s="Comscore Error: Missing Mandatory Tag: Client ID (c2 tag)";if(console&&console.error)console.error(s);return}else if(!e.toString().match(/^\d{7}$/)){var s="Comscore Error: Invalid Mandatory Tag: Client ID (c2 tag) must be a 7-digit unique client ID";if(console&&console.error)console.error(s);return}if(!t){var s="Comscore Error: Missing Mandatory Tag: Video Type (c5 tag)";if(console&&console.error)console.error(s);return}else if(!t.toString().match(/^(0[1-6|9]|1[0-3])$/)){var s="Comscore Error: Invalid Mandatory Tag: Video Type (c5 tag) must be a 2-digit content type (video type) identifier {01-06, 09-13}";if(console&&console.error)console.error(s);return}var o=(new Array((document.location.protocol=="https:"?"https://sb":"http://b")+".scorecardresearch.com/p?","?c1=",1,"&c2=",escape(e),"&c5=",escape(t),"&c3=",escape(n||""),"&c4=",escape(r||""),"&c6=",escape(i||""),"&c7=",escape(document.location.href),"&c8=",escape(document.title),"&c9=","","&c10=","","&rn=",Math.random(),"&cv=","2.0")).join("");if(!it)it=$("<img/>").prop("id","pbskids-comscore-video-beacon").appendTo($("body"));it.prop("src",o)}function Dt(e,t,n,r){e=v+" - "+e;t=(m?m+" - ":"")+t;if(St.debugMode)console.log("_trackEvent: "+e+" : "+t+" : "+n+" : "+r);if(window.GA_obj)if(GA_obj.trackEvent)GA_obj.trackEvent(e,t,n,r)}function Pt(e,t){Dt("Controls",e,t)}function Ht(e,t){if(!t)return;var n=(t.series_title||"No-Series-Title")+"/"+(t.title||"No-Title");var r=e/t.duration*100;var i;if(r==0||isNaN(r))i="0%";else if(r<5)i="0-5%";else if(r<10)i="5-10%";else if(r<20)i="10-20%";else if(r<30)i="20-30%";else if(r<40)i="30-40%";else if(r<50)i="40-50%";else if(r<60)i="50-60%";else if(r<70)i="60-70%";else if(r<80)i="70-80%";else if(r<90)i="80-90%";else if(r<95)i="90-95%";else i="95-100%";Dt("Duration Viewed",n,i,Math.round(e))}function Bt(e,t){if(!t)return;switch(e.toLowerCase()){case"mediaload":e="MediaLoad";break;case"mediacomplete":e="MediaComplete";break;case"mediastart":e="MediaStart";var n;switch((t.type||"").toLowerCase()){case"episode":n="03";break;case"clip":n="02";break;case"ad":n="09";break;default:n="00";break}_t(3005420,n,3005420,7197992,"");break;default:return}var r=(t.series_title||"No-Series-Title")+"/"+(t.title||"No-Title");Dt("Playback",e,r)}function jt(){for(var e in Z){if(!(ct&&Z[e]=="volumechange")){h.bind(Z[e],nn);if(St.debugMode)console.log('Bound to media event, "'+Z[e]+'"')}}}function Ft(){for(var e in Z){if(!(ct&&Z[e]=="volumechange")){h.unbind(Z[e],nn);if(St.debugMode)console.log('Unbound to media event, "'+Z[e]+'"')}}}function It(){if(et){if(ct){$(h).on("webkitbeginfullscreen",mn);$(h).on("webkitendfullscreen",mn);tt="webkitbeginfullscreen && webkitendfullscreen"}else{tt=nt+"fullscreenchange";if(nt=="moz")$(document).on(tt,mn);else $(h).on(tt,mn)}}else if(lt){et=true;tt="";nt="legacy-webkit"}}function qt(e,t,n,r){if(e){if(typeof n=="function")e.each(function(){$(this).off(yt);$(this).on(yt,n)});if(typeof t=="function")e.each(function(){$(this).off("click");$(this).on("click",t)});e.removeClass("disabled-control").addClass("enabled-control").css(r||{})}}function Rt(e,t,n,r){if(e){e.addClass("disabled-control").removeClass("enabled-control").css(r||{});if(typeof n=="function")e.each(function(){$(this).off(yt,n)});if(typeof t=="function")e.each(function(){$(this).off("click",t)})}}function Ut(){if(at&&!et||ft){zt();return}if(K){qt(K.scrubber,null,Jt);qt(K.track);qt(K.thumb)}}function zt(){if(K){Rt(K.scrubber,null,Jt);Rt(K.track);Rt(K.thumb,null,null,{left:"0"});Gt(null)}}function Wt(){if(Y&&!C){qt(Y.scrubber,null,Kt);qt(Y.track);qt(Y.thumb);C=true}}function Xt(){$t(Y);pn({volume:b.muted()==true?0:b.volume()})}function Vt(){$t(K);K.scrubTo(H/F)}function $t(e){e.bounds=null;if(e.scrubber.css("display").toLowerCase()=="none")e.scrubber.css("display","block");if(e&&e.track.width()+e.track.height()>0){var t=e.track.offset();var n=-t.top,r=-t.left,i=e.track.width(),s=e.track.height(),o=e.thumb.outerWidth();thumbHeight=e.thumb.outerHeight();e.scrubber.css("display","");e.bounds={top:n,left:r,width:i,height:s};e.scrubTo=function(t,n){n=false;if(e.vertical===true){var r=n?.5*thumbHeight/s:0;t=1-Math.min(1-r,Math.max(r,t||r));scrubPosition=(s-(n?0:thumbHeight))*t;e.thumb.css("top",scrubPosition-(n?thumbHeight/2:0))}else{var r=n?.5*o/i:0;t=Math.min(1-r,Math.max(r,t||r));scrubPosition=(i-(n?0:o))*t;e.thumb.css("left",scrubPosition-(n?o/2:0))}}}}function Jt(e){Q=true;Kt(e)}function Kt(e){if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation();e.cancelBubble=true;$(document).on(bt,Qt);$(document).on(wt,Gt);if(mt)$(document).on(Et,Gt);Qt(e)}function Qt(e){if(e.preventDefault)e.preventDefault();var t=NaN;var n=mt?e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]:vt?e.originalEvent:e;var r=Q?K:Y;if(n&&r)if(r.bounds){if(r.vertical===true){t=Math.min(1,Math.max(0,r.bounds.height-(n.pageY+r.bounds.top))/r.bounds.height)}else{t=Math.min(1,Math.max(0,n.pageX+r.bounds.left)/r.bounds.width)}r.scrubTo(t,true)}return t}function Gt(e){$(document).off(bt,Qt);$(document).off(wt,Gt);if(mt)$(document).off(Et,Gt);if(e){if(!Q)b.volume(Qt(e));else b.seekToPercent(Qt(e))}}function Yt(){if(b.showingCaptions()){Pt("toggleCaptions","Off");b.hideCaptions()}else{Pt("toggleCaptions","On");b.showCaptions()}}function Zt(){if(b.paused()){Pt("togglePause","Unpause");if(x)x.hide();if(T)T.show();b.unpause()}else{Pt("togglePause","Pause");b.pause()}}function en(){if(b.muted()){Pt("toggleMute","Unmute");b.unmute()}else{Pt("toggleMute","Mute");b.mute()}}function tn(){if(b.isFullscreen()){Pt("toggleScreen","Normal");b.exitFullscreen()}else{Pt("toggleScreen","Fullscreen");b.enterFullscreen()}}function nn(e){var t={};var n=St.debugMode&&e.type!="timeupdate";if(n)console.log("Video Event: "+e.type);switch(e.type){case"ended":var r=h.prop("currentTime");if(r>F+2)return;t.eventType=org.pbskids.video.VideoEvent.VIDEO_END;break;case"loadstart":if(!_){t.eventType=org.pbskids.video.VideoEvent.CAN_PLAY_STATE_CHANGE;t.canPlay=true;org.pbskids.video.VideoEvent.dispatchEvent(t);t={}};case"waiting":t.eventType=org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE;t.loadState="loading";break;case"loadeddata":t.eventType=org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE;t.loadState="ready";if(lt)A=true;break;case"playing":var i=h.prop("duration");if(i!=F&&!isNaN(i)){t.eventType=org.pbskids.video.VideoEvent.DURATION_CHANGE;t.duration=i;org.pbskids.video.VideoEvent.dispatchEvent(t);t={}}t.eventType=org.pbskids.video.VideoEvent.CAN_SEEK_STATE_CHANGE;t.canSeek=b.canSeek();org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.PLAY_STATE_CHANGE;t.playState="playing";if(A){org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE;t.loadState="loading";A=false}break;case"stalled":case"suspend":case"pause":var r=h.prop("currentTime");if(!isNaN(r))if(r>0&&r<=F){t.eventType=org.pbskids.video.VideoEvent.CURRENT_TIME_CHANGE;t.time=r;t.percent=Math.min(1,Math.max(0,h.prop("currentTime")/(F||1)));org.pbskids.video.VideoEvent.dispatchEvent(t);t={}}t.eventType=org.pbskids.video.VideoEvent.PLAY_STATE_CHANGE;t.playState="paused";break;case"timeupdate":t.eventType=org.pbskids.video.VideoEvent.CURRENT_TIME_CHANGE;t.time=h.prop("currentTime")||0;t.percent=Math.min(1,Math.max(0,h.prop("currentTime")/(F||1)));break;case"durationchange":if(L){t.eventType=org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE;t.loadState="ready";org.pbskids.video.VideoEvent.dispatchEvent(t);t={}}t.eventType=org.pbskids.video.VideoEvent.DURATION_CHANGE;t.duration=h.prop("duration");break;case"seeking":t.eventType=org.pbskids.video.VideoEvent.SEEKING_CHANGE;t.time=h.prop("currentTime")||0;t.percent=Math.min(1,Math.max(0,h.prop("currentTime")/(b.duration()||1)));t.seeking=true;break;case"seeked":t.eventType=org.pbskids.video.VideoEvent.SEEKING_CHANGE;t.time=h.prop("currentTime")||0;t.percent=Math.min(1,Math.max(0,h.prop("currentTime")/(b.duration()||1)));t.seeking=false;break;case"emptied":t.eventType=org.pbskids.video.VideoEvent.PLAY_STATE_CHANGE;t.playState="paused";org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.CAN_PLAY_STATE_CHANGE;t.canPlay=false;org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.CAN_SEEK_STATE_CHANGE;t.canSeek=false;org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE;t.loadState="unloading";org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.LOAD_STATE_CHANGE;t.loadState="uninitialized";break;case"canplay":t.eventType=org.pbskids.video.VideoEvent.CAN_PLAY_STATE_CHANGE;t.canPlay=true;org.pbskids.video.VideoEvent.dispatchEvent(t);t={};t.eventType=org.pbskids.video.VideoEvent.CAN_SEEK_STATE_CHANGE;t.canSeek=b.canSeek();break;case"volumechange":t.eventType=org.pbskids.video.VideoEvent.VOLUME_CHANGE;t.volume=h.prop("volume");org.pbskids.video.VideoEvent.dispatchEvent(t);break;default:if(St.debugMode){console.log('The video event, "'+e.type+'", does not have a handler');console.log("--------")}return}org.pbskids.video.VideoEvent.dispatchEvent(t);if(n)console.log("--------")}function rn(e){if(at&&!et||ft||ct&&!_){L=false;if(S)S.hide();if(x)x.show();if(T)T.hide()}else{L=e.loadState=="loading";if(S)S.toggle(L);if(x)x.toggle(b.paused());if(T)T.toggle(!b.paused())}}function sn(e){var t;var n=e.playState=="playing";if(n)_=true;n=n&&!(at&&!et)&&!ft;t=!n&&!L&&b.canPlay();if(U)U.toggleClass("playing",n).toggleClass("paused",!n);if(S&&n)S.hide();if(x)x.toggle(t);if(T)T.toggle(!t)}function on(e){O=e.canPlay;if(e)if(O){Bt("MediaStart",D);qt(U,Zt);qt(z,Yt);if(R&&!N){qt(R,en);N=true}Wt();e.volume=b.muted()?0:b.volume();pn(e);return}Rt(U,Zt);Rt(z,Yt);if(x)x.hide()}function un(e){if(e.canSeek)Ut();else zt()}function an(e){H=e.time;B=F-H;if(V)V.html(b.formatTime(H));if(X)X.html(b.formatTime(B));Q=false}function fn(e){if(!isNaN(e.time))if(e.time>=0&&e.time<Infinity){I+=e.time-H;H=e.time;B=F-H;if(V)V.html(b.formatTime(H));if(X)X.html(b.formatTime(B));if(K&&!Q)K.scrubTo(e.percent)}}function ln(e){if(!isNaN(e.duration))if(e.duration>=0&&e.duration<Infinity){F=e.duration;if(J)J.html(b.formatTime(F))}}function cn(e){if(S)S.hide();if(x)x.show();if(T)T.hide();Bt("MediaComplete",D);if(I>=0)Ht(I,D);I=0;H=0}function hn(e){if(R){if(e.muted)R.addClass("muted");else R.removeClass("muted")}e.volume=e.muted===true?0:b.volume();pn(e)}function pn(e){if(G)G.html(Math.round(e.volume*100)+"%");if(Y)if(Y.scrubTo)Y.scrubTo(e.volume)}function dn(e){if(z){if(e.captionsState=="showing")z.addClass("captions-on");else z.removeClass("captions-on")}}function vn(e){switch(St.onVideoClick){case"toggle-fullscreen":tn();break;case"toggle-pause":Zt();break;default:}}function mn(e){gn()}function gn(){if(Y)Xt();if(K)Vt()}function yn(){if(!h)return;var t=$("#"+e);var n=Math.round(t.width()/St.aspectRatio)+"px";t.css("height",n);if(w)w.css({"margin-top":"-"+n,height:n,"line-height":n});P="originalres_"+(St.aspectRatio>1.55?"16x9":"4x3")}function bn(){$.ajax({type:"GET",url:f+"getVideos/",dataType:"jsonp",data:{endindex:1,status:"available"},success:function(e){$.ajax({type:"GET",url:e.items[0].videos["ipad"].url,dataType:"jsonp",data:{format:"jsonp"},success:function(e){if(e.status=="ok"){if(!ct&&!at&&!ft)Ct();else kt();return}var t={message:e.message};switch(e.http_code){case 403:t.eventType=org.pbskids.video.VideoErrorEvent.GEO_RESTRICTED;break;case 404:t.eventType=org.pbskids.video.VideoErrorEvent.VIDEO_NOT_FOUND;break;case 410:t.eventType=org.pbskids.video.VideoErrorEvent.VIDEO_EXPIRED;break;default:return}org.pbskids.video.VideoErrorEvent.dispatchEvent(t)}})}})}function wn(e,t){e.style["-ms-touch-action"]=t;var n=e.childNodes;for(var r in n){if(n[r].style){n[r].style["-ms-touch-action"]=t}}}var n,r=[/^http:\/\/(www|dipsy)?(-tc)?\.?pbs\.org/,/^http:\/\/(www|soup|ernie)?(-tc)?\.?pbskids\.org/,/^http:\/\/jsfiddle\.net/];if(window.top!=window){var i=false;n=document.referrer;for(var s in r){if(n.match(r[s])!==null){i=true;if(n.match(/\.org\/producerplayer/)!==null)n=window.top.location.href;break}}if(!i)throw new Error("This site does not have permission to frame this PBS KIDS video player")}else{n=window.location.href}var o=n.indexOf("ernie.pbskids.org/")!=-1?"http://ernie.pbskids.org/":n.indexOf("soup.pbskids.org/")!=-1?"http://soup.pbskids.org/":"http://www-tc.pbskids.org/";var u=o+"pbsk/video/swf/"+(t&&t.testing===true?"org/pbskids/video/":"")+"VideoPlayer.swf",a=o+"pbsk/swf/expressInstall.swf",f="http://pbskids.org/pbsk/video/api/",l="10.1.0",c="org.pbskids.video.Player";var h,p,d,v,m,g,y,b=this;var w=null,E=null,S=null,x=null,T=null;var N=false,C=false,k=false,L=false,A=false,O=false,M=false,_=false;var D,P;var H=0,B=0,F=0,I=0,q=100;var R=null,U=null,z=null,W=null;var X=null,V=null,J=null;var K=null,Q=false;var G=null,Y=null;var Z=new Array("loadstart","waiting","loadeddata","emptied","canplay","playing","seeking","seeked","ended","durationchange","timeupdate","pause","volumechange");var et=false,tt="",nt="",rt="webkit moz o ms khtml".split(" ");var it;var st=false,ot=/safari/gi.test(navigator.appVersion)&&/apple/gi.test(navigator.vendor);var ut=/googletv/gi.test(navigator.appVersion),at=/android/gi.test(navigator.appVersion),ft=/silk|kindlefire/gi.test(navigator.appVersion),lt=/android [4-9]\.[0-9]/gi.test(navigator.appVersion),ct=/iphone|ipad|ipod/gi.test(navigator.appVersion),ht=/iphone|ipod/gi.test(navigator.appVersion),pt=/ipad/gi.test(navigator.appVersion),dt=/hp-tablet/gi.test(navigator.appVersion),vt=window.navigator.msPointerEnabled,mt="ontouchstart"in window&&!dt;var gt=!"onorientationchange"in window?"resize":"orientationchange",yt=vt?"MSPointerDown":!mt?"mousedown":"touchstart",bt=vt?"MSPointerMove":!mt?"mousemove":"touchmove",wt=vt?"MSPointerUp":!mt?"mouseup":"touchend",Et=vt?"MSPointerOut":!mt?"mouseout":"touchcancel";var St={debugMode:false,aspectRatio:16/9,onPlayerComplete:null,onVideoClick:"",muteToggleControl:"",pauseToggleControl:"",captionsToggleControl:"",scrubber:"",timerRemaining:"",timerCurrent:"",timerDuration:"",volumeDisplay:"",volumeSlider:"",verticalVolumeSlider:"",loadingOverlay:{url:o+"pbsk/video/img/arrowspin.gif",swf:o+"pbsk/video/swf/arrowspin.swf",width:"50px",height:"50px",color:"white",opacity:90},playIconOverlay:{url:o+"pbsk/video/img/button_overlay_play.png",width:"",height:"",color:"black",opacity:50},onHoverOverlay:{url:"",width:"",height:"",fs_url:"",fs_width:"",fs_height:""}};if(typeof e!="string"){var xt="org.pbskids.video.Player requires "+(arguments.length>0?"the first":"one")+" parameter of type String";throw new Error(xt);return}e=e.substr(e.indexOf("#")+1);if(!document.getElementById(e)){var xt='An html element with the id, "'+e+'",  could not be found';throw new Error(xt);return}this.enterFullscreen=function(){if(h&&!k&&et){if(nt==="")h.get(0).requestFullScreen();else if(nt.match("webkit"))h.get(0).webkitEnterFullscreen();else h.get(0)[nt+"RequestFullScreen"]()}};this.exitFullscreen=function(){if(h&&!k&&et){if(nt==="")document.cancelFullScreen();else if(nt.match("webkit"))document.webkitExitFullscreen();else document[nt+"CancelFullScreen"]()}};this.videoType=function(){return p};this.aspectRatio=function(){return St.aspectRatio};this.isFlashPlayer=function(){return k};this.commonName=function(){return v};this.affiliateId=function(){return m};this.siteProgram=function(){return g};this.siteCategory=function(){return y};this.paused=function(){if(!h)return false;return k?h.paused?h.paused():false:h.prop("paused")};this.muted=function(){if(!h)return false;return k?h.muted?h.muted():false:h.prop("muted")};this.canSeek=function(){if(!h)return false;return k?h.canSeek?h.canSeek():false:h.prop("seekable")};this.canPlay=function(){if(!h)return false;return k?h.canPlay?h.canPlay():false:O};this.isFullscreen=function(){if(!h)return false;if(k)return h.displayingFullscreen?h.displayingFullscreen():false;if(et){switch(nt){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[nt+"FullScreen"]}}};this.pause=function(){if(!h)return;if(k)h.pause();else h.get(0).pause()};this.unpause=function(){if(!h)return;if(k)h.unpause();else h.get(0).play()};this.playVideo=function(){if(!h)return;if(k)h.playVideo();else h.get(0).play()};this.togglePause=function(){if(this.paused())this.unpause();else this.pause()};this.seekToTime=function(e){if(!h||isNaN(e))return;e=Math.max(0,Math.min(e,F));if(k)h.seekToTime(e);else h.prop("currentTime",e)};this.seekToPercent=function(e){if(!h||isNaN(e))return;e=Math.max(0,Math.min(e,1));if(k)h.seekToPercent(e);else h.prop("currentTime",b.duration()*e)};this.currentTime=function(){return H};this.remainingTime=function(){return B};this.duration=function(){return F};this.loadAndPlay=function(e){if(mt&&!_){this.loadAndStop(e)}else if(h){if(typeof e!="object"){if(typeof e=="string"){var t={guid:e,status:"available"};if(g)t.program=g;if(y)t.category=y;$.ajax({type:"GET",url:f+"getVideos/",dataType:"jsonp",data:t,success:function(t){if(t.matched>0){console.log("Found Release:");console.log(t.items[0]);b.loadAndPlay(t.items[0])}else{var n="Could not find a published and available video for this site with the guid: "+e;if(console&&console.warn)console.warn(n)}}})}else{var n="No ReleaseObject or guid was provided. Exiting .loadAndPlay().";if(console&&console.warn)console.warn(n)}return}var r=e.videos[p].url?e.videos[p].url:e.videos[p];var i=e.images[P]?e.images[P].url||"":"";if(I>=0)Ht(I,D);I=0;H=0;Bt("MediaLoad",e);if(k)h.loadAndPlay(r);else{if(E)E.hide();if(at||ft){h.removeAttr("src").removeAttr("poster");if(E)E.hide();h.attr({src:r,autoplay:"autoplay",poster:i}).get(0).load();this.playVideo()}else{this.unload();if(E)E.hide();h.attr({src:r,autoplay:"autoplay",poster:i}).get(0).play()}}this.captionsURL(e.captions.sami?e.captions.sami.url||"":e.captions.dfxp?e.captions.dfxp.url||"":"");D=e}};this.loadAndStop=function(e){if(h){if(typeof e!="object"){if(typeof e=="string"){var t={guid:e,status:"available"};if(g)t.program=g;if(y)t.category=y;$.ajax({type:"GET",url:f+"getVideos/",dataType:"jsonp",data:t,success:function(t){if(t.matched>0){console.log("Found Release:");console.log(t.items[0]);b.loadAndStop(t.items[0])}else{var n="Could not find a published and available video for this site with the guid: "+e;if(console&&console.warn)console.warn(n)}}})}else{var n="No ReleaseObject or guid was provided. Exiting .loadAndPlay().";if(console&&console.warn)console.warn(n)}return}var r=e.videos[p].url?e.videos[p].url:e.videos[p];var i=e.images[P]?e.images[P].url||"":"";if(I>=0)Ht(I,D);I=0;H=0;Bt("MediaLoad",e);if(k)h.loadAndStop(r);else{this.unload();if(E)E.hide();h.attr({src:r,poster:i}).removeAttr("autoplay").get(0).load()}this.captionsURL(e.captions.sami?e.captions.sami.url||"":e.captions.dfxp?e.captions.dfxp.url||"":"");D=e}};this.loadAndPause=this.loadAndStop;this.unload=function(){if(h){if(k&&h.unload)h.unload();else{this.pause();Ft();var e=h.removeAttr("src").removeAttr("poster").removeAttr("autoplay").clone().insertBefore(h);h.remove();h=e;h.resize(yn);It();jt();if(E)E.show();h.trigger("emptied")}}};this.showingCaptions=function(){return k&&h?h.showingCaptions():false};this.captionsURL=function(e){if(k&&h)h.captionsURL(e)};this.captionsXML=function(e){if(k&&h)h.captionsXML(e)};this.showCaptions=function(){if(k&&h)h.showCaptions()};this.hideCaptions=function(){if(k&&h)h.hideCaptions()};this.formatTime=function(e){if(isNaN(e))return"--:--";if(e<=0||e>Infinity)return"--:--";var t=Math.floor(e/60),n=Math.floor(e%60);return t+":"+(n<10?"0":"")+n};this.unmute=function(){if(!h)return;if(k){if(h.unmute)h.unmute()}else{h.prop("volume",Math.max(q,.2))}};this.mute=function(){if(!h)return;if(k){if(h.mute)h.mute()}else{q=h.prop("volume");h.prop("volume",0)}};this.volume=function(e){if(!h)return 0;e=!isNaN(e)?Math.max(0,Math.min(1,e)):NaN;if(e===0){this.mute();return 0}if(k){if(h.unmute)h.unmute();return h.volume?h.volume(e):0}else{if(!isNaN(e))h.prop("volume",e);return h.prop("volume")}};this.registerControl=function(e,t){if(St.debugMode&&t)console.log("registerControl() : "+"type: "+e+" , selector: "+t);var n=$(t);if(n.length==0){if(t){var r='Html element(s) could not be found using the selector, "'+t+'"';if(console&&console.warn)console.warn(r)}return}switch(e){case"timerRemaining":X=n;break;case"timerCurrent":V=n;break;case"timerDuration":J=n;break;case"volumeDisplay":G=n;break;case"muteToggleControl":if(!mt){R=n;if(b.canPlay())qt(R,en);else Rt(R,en)}else n.hide();break;case"captionsToggleControl":if(k){z=n;if(b.canPlay())qt(z,Yt);else Rt(z,Yt)}else n.hide();break;case"pauseToggleControl":U=n;if(b.canPlay())qt(U,Zt);else Rt(U,Zt);break;case"volumeSlider":case"verticalVolumeSlider":var i=$(".scrubber-track",n).first();var s=$(".scrubber-thumb",n).first();if(i.length>0&&s.length>0){if(!mt){Y={};Y.vertical=e=="verticalVolumeSlider";Y.scrubber=n.first();Y.track=i;Y.thumb=s;Y.thumb.css({position:"relative"});if(vt)wn(Y.scrubber.get(0),"none");$t(Y);Y.track.resize(Xt);if(b.canPlay())Wt();else{Rt(Y.scrubber);Rt(Y.track);Rt(Y.thumb)}}else{n.hide()}}else{var r='The html element defined by the selector, "'+t+'", must have a child with the class, "scrubber-track", AND a child with the class, "scrubber-thumb"';if(console&&console.error)console.error(r)}break;case"scrubber":var i=$(".scrubber-track",n).first();var s=$(".scrubber-thumb",n).first();if(i.length>0&&s.length>0){K={};K.scrubber=n.first();K.track=i;K.thumb=s;K.thumb.css({position:"relative"});if(vt)wn(K.scrubber.get(0),"none");$t(K);K.track.resize(Vt);if(b.canSeek())Ut();else zt()}else{var r='The html element defined by the selector, "'+t+'", must have a child with the class, "scrubber-track", AND a child with the class, "scrubber-thumb"';if(console&&console.error)console.error(r)}break;default:var r='The control-type, "'+e+'" is not a recognize control-type in '+c+".registerControl()";if(console&&console.error)console.error(r)}};for(s in t){switch(s){case"onHoverOverlay":case"playIconOverlay":case"loadingOverlay":for(j in t[s])St[s][j]=t[s][j];break;default:St[s]=t[s]}}Tt()};org.pbskids.video.PlayerEvent=function(){var e="org_pbskids_video_PlayerEvent";return{debugMode:false,PLAYER_READY:e+"_PlayerReady",dispatchEvent:function(t){var n,r={};t.eventType=(t.eventType||"").replace(/\./g,"_");switch(t.eventType){case this.PLAYER_READY:r.success=t.success||false;r.id=t.id||"";r.ref=t.ref||undefined;r.player=t.player||undefined;break;default:if(this.debugMode){console.log("eventType, "+t.eventType+", is not defined in "+e,"warn");if(t)console.log(t)}return}n=$.Event(t.eventType);for(var i in r)n[i]=r[i];$(t.caller||document).trigger(n)}}}();org.pbskids.video.VideoEvent=function(){var e="org_pbskids_video_VideoEvent";return{debugMode:false,CAN_PLAY_STATE_CHANGE:e+"_CanPlayStateChange",CAN_SEEK_STATE_CHANGE:e+"_CanSeekStateChange",CAPTIONS_STATE_CHANGE:e+"_CaptionsStateChange",CURRENT_TIME_CHANGE:e+"_CurrentTimeChange",DURATION_CHANGE:e+"_DurationChange",LOAD_STATE_CHANGE:e+"_LoadStateChange",MUTE_CHANGE:e+"_MuteChange",PLAY_STATE_CHANGE:e+"_PlayStateChange",SEEKING_CHANGE:e+"_SeekingChange",VIDEO_END:e+"_VideoEnd",VOLUME_CHANGE:e+"_VolumeChange",dispatchEvent:function(t){if(this.debugMode)if((t.eventType||"").replace(/\./g,"_")!=this.CURRENT_TIME_CHANGE)console.log(t);var n,r={};t.eventType=(t.eventType||"").replace(/\./g,"_");switch(t.eventType){case this.LOAD_STATE_CHANGE:r.loadState=t.loadState||"";break;case this.CAN_PLAY_STATE_CHANGE:r.canPlay=t.canPlay||false;break;case this.PLAY_STATE_CHANGE:r.playState=t.playState||"";break;case this.CURRENT_TIME_CHANGE:r.time=t.time||0;r.percent=t.percent||0;break;case this.DURATION_CHANGE:r.duration=t.duration||0;break;case this.VIDEO_END:break;case this.MUTE_CHANGE:r.muted=t.muted||false;break;case this.VOLUME_CHANGE:r.muted=t.muted||false;r.volume=!isNaN(t.volume)?t.volume:NaN;break;case this.CAPTIONS_STATE_CHANGE:r.captionsState=t.captionsState||"";break;case this.CAN_SEEK_STATE_CHANGE:r.canSeek=t.canSeek||false;break;case this.SEEKING_CHANGE:r.time=t.time||0;r.percent=t.percent||0;r.seeking=t.seeking||false;break;default:if(this.debugMode){console.warn("eventType, "+t.eventType+", is not defined in "+e);if(t)console.log(t)}return}n=$.Event(t.eventType);for(var i in r)n[i]=r[i];$(t.caller||document).trigger(n)}}}();org.pbskids.video.VideoErrorEvent=function(){var e="org_pbskids_video_VideoErrorEvent";return{debugMode:false,GEO_RESTRICTED:e+"_GeoRestricted",VIDEO_NOT_FOUND:e+"_VideoNotFound",VIDEO_EXPIRED:e+"_VideoExpired",NO_RESPONSE:e+"_NoResponse",dispatchEvent:function(t){if(this.debugMode)console.log(t);var n,r={};t.eventType=(t.eventType||"").replace(/\./g,"_");switch(t.eventType){case this.GEO_RESTRICTED:case this.VIDEO_NOT_FOUND:case this.VIDEO_EXPIRED:case this.NO_RESPONSE:r.message=(t.message||"").replace("Redirect","Video").replace("redirect","video");break;default:if(this.debugMode){console.warn("eventType, "+t.eventType+", is not defined in "+e);if(t)console.log(t)}return}n=$.Event(t.eventType);for(var i in r)n[i]=r[i];$(t.caller||document).trigger(n)}}}();org.pbskids.video.PlayList=function(e,t,n,r){function et(){for(i in r){if(typeof Y[i]=="object"&&typeof r[i]=="object")for(j in r[i])Y[i][j]=r[i][j];else Y[i]=r[i]}a=$("#"+e);o=a.get(0);_releaseClass=" ."+t;d=$(_releaseClass,a).first();f=n;l=f.commonName();c=f.affiliateId();h=f.siteProgram();p=f.siteCategory();org.pbskids.video.PlaylistEvent.debugMode=Y.debugMode;if(Y.iScrollOpts!="NO_ISCROLL"){y=e+"-iScrollContainer";$("<div/>").prop("id",y).addClass(Y.iScrollOpts.containerClass).css({position:"relative",overflow:"hidden"}).insertBefore(a).append(a);if(Y.loadingIndicator){$("<img/>").prop("src",Y.loadingIndicator).addClass(Y.loadingIndicatorClass).appendTo($("#"+y));w=$("<li/>").addClass("appendingIndicator-container").append($("<img/>").prop("src",Y.loadingIndicator).addClass(Y.appendingIndicatorClass)).append($("<span/>").html(Y.appendingVideosMessage))}if(Y.loadMoreButtonClass)E=$("<li/>").addClass(Y.loadMoreButtonClass).append($("<span/>").html(Y.loadMoreVideosMessage)).css({cursor:"pointer"}).click(function(){s.appendMore()});b=Y.iScrollOpts.onRefresh;Y.iScrollOpts.onRefresh=ct;s.iScroll=new org.pbskids.iScrollMOD(y,Y.iScrollOpts)}s.registerControl("nextVideoControl",Y["nextVideoControl"]||"");s.registerControl("previousVideoControl",Y["previousVideoControl"]||"");$(document).on(org.pbskids.video.VideoEvent.VIDEO_END,ft);s.purge()}function tt(e,t,n){if(e.videos)if(e.videos[f.videoType()]){var r=d.clone();n=n||-1;rt(r,"video-title",e.title);rt(r,"video-description",e.description);rt(r,"video-duration",f.formatTime(e.videos[f.videoType()].length/1e3));rt(r,"series-title",e.series_title);for(i in e.images)nt(r,i,e.images[i]);switch((e.type||"").toLowerCase()){case"episode":r.addClass("episode");break;case"clip":r.addClass("clip");break}if(e.airdate){var s=e.airdate.match(/(\d+)/g);if(s){var o=new Date(s[0],s[1]-1,s[2],s[3],s[4]);var u=new Date;var l=(u-o)/864e5;if(l<=7)r.addClass("new-video");rt(r,"video-airdate",s[1]+"-"+s[2]+"-"+s[0])}}if(e.expirationdate){var s=e.expirationdate.match(/(\d+)/g);if(s){var c=new Date(s[0],s[1]-1,s[2],s[3],s[4]);var u=new Date;var h=(c-u)/864e5;if(h<=7)rt(r,"video-expiration","Expires in "+(h<1?Math.round(h*24)+" hours":Math.round(h)+" days"))}}r.addClass("guid_"+e.guid).prop("data-item-guid",e.guid).prop("data-item-index",t).click(function(t){lt(t,e)});if(t%2==1)r.addClass("alternate");if(n==e.guid)r.addClass("selected");if(Y.reverseOrder)r.prependTo(a);else r.appendTo(a);return r}return null}function nt(e,t,n){if(n)if(n.url){$("img."+t,e).prop("src",n.url).prop("data-original-width",n.width+"px").prop("data-original-height",n.height+"px")}}function rt(e,t,n){if(n){$("."+t,e).html(n);e.prop("data-"+t,n)}}function it(e,t){if(e){e.removeClass("disabled-control").addClass("enabled-control");if(typeof t=="function")e.each(function(){$(this).off("click");$(this).on("click",t)})}}function st(e,t){if(e){e.addClass("disabled-control").removeClass("enabled-control");if(typeof t=="function")e.each(function(){$(this).off("click",t)})}}function ot(e){if(s.iScroll)s.iScroll.scrollToElement(e,100)}function ut(e,t,n,r){e=l+" - "+e;t=(c?c+" - ":"")+t;if(Y.debugMode)console.log("_trackEvent: "+e+" : "+t+" : "+n+" : "+r);if(window.GA_obj)if(GA_obj.trackEvent)GA_obj.trackEvent(e,t,n,r)}function at(e,t){ut("Controls",e,t)}function ft(){if(s.autoPlayNext())s.next()}function lt(e,t){s.setFocusTo(e.currentTarget);f.loadAndPlay(t);var n={};t.duration=t.videos[f.videoType()].length/1e3;for(i in t)n[i]=t[i];delete n.videos;org.pbskids.video.PlaylistEvent.dispatchEvent({eventType:org.pbskids.video.PlaylistEvent.RELEASE_SELECTED,release:n,playlist:s,caller:o})}function ct(){if(s.iScroll)if(s.iScroll["vScrollbarWrapper"])$(s.iScroll["vScrollbarWrapper"]).css({position:"absolute",top:"0px",right:"0px"});if(b)if(typeof b=="function")b.call(s.iScroll)}function ht(e,t,n,r,i){var u=T.length;m=false;if(r!==O){if(Y.debugMode)console.log(a.prop("id")+": rejected: "+(n.category||n.group||n.program));return}if(Y.debugMode)console.log(a.prop("id")+": received: "+(n.category||n.group||n.program));M=n;N=n.category||"";C=n.program||"";L=n.group||"";A=t||e.length;g=A>n.endindex&&!n.group;T=T.concat(e);for(k in e){tt(e[k],u,n.selectedID);u++}if(Y.debugMode)console.log("items received: "+e.length+"; items requested: "+(n.endindex-n.startindex+1)+"; can load more: "+g);it(_,s.next);it(D,s.previous);v=true;if(Y.loadingIndicator)$("."+Y.loadingIndicatorClass,"#"+y).css("display","none");if(w)w.detach();if(E&&g)E.appendTo(a);if(s.iScroll)s.iScroll.refresh();var f=s.autoPlay();org.pbskids.video.PlaylistEvent.dispatchEvent({eventType:org.pbskids.video.PlaylistEvent[(i||"REFRESH")+"_COMPLETE"],category:N||L||C,playlist:e,totalCount:A,caller:o});if(f){if(n.selectedID)$(_releaseClass+".guid_"+n.selectedID,a).triggerHandler("click");else s.next()}else if(n.selectedID&&i!="APPEND"){s.setFocusTo($(_releaseClass+".guid_"+n.selectedID,a))}}var s=this,o,u="org.pbskids.video.PlayList",a,f,l,c,h,p,d;var v=false,m=false,g=true,y,b,w,E,S;var x="http://pbskids.org/pbsk/video/api/",T=[],N="",C="",L="",A=0,O="",M={};var _=null,D=null;var P=false,H=/safari/gi.test(navigator.appVersion);var B=/googletv/gi.test(navigator.appVersion),F=/android/gi.test(navigator.appVersion),I=/silk|kindlefire/gi.test(navigator.appVersion),q=/iphone|ipad|ipod/gi.test(navigator.appVersion),R=/iphone|ipod/gi.test(navigator.appVersion),U=/ipad/gi.test(navigator.appVersion),z=/hp-tablet/gi.test(navigator.appVersion),W=window.navigator.msPointerEnabled,X="ontouchstart"in window&&!z;var V=!"onorientationchange"in window?"resize":"orientationchange",J=W?"MSPointerDown":!X?"mousedown":"touchstart",K=W?"MSPointerMove":!X?"mousemove":"touchmove",Q=W?"MSPointerUp":!X?"mouseup":"touchend",G=W?"MSPointerOut":!X?"mouseout":"touchcancel";var Y={autoPlay:true,autoPlayNext:true,nextVideoControl:"",previousVideoControl:"",loadingIndicator:"",loadingIndicatorClass:"loading-indicator",appendingIndicatorClass:"appending-indicator",appendingVideosMessage:"Loading More Videos...",loadMoreButtonClass:"",loadMoreVideosMessage:"Load More Videos",reverseOrder:false,debugMode:false,iScrollOpts:{hScroll:false,containerClass:"iScrollContainer",dragScrollBars:!(X||W),minBarHeight:X||W?8:36,scrollbarClass:(X||W?"touch ":"")+"scrollbar"}};if(typeof e!="string"){var Z=u+" requires that the first parameter be of type String. This should be the id attribute of the html element to contain the playlist";if(X)if(Y.debugMode)console.error(Z);new Error(Z);return}e=e.substr(e.indexOf("#")+1);if(!document.getElementById(e)){var Z='An html element with the id, "'+e+'",  could not be found';console.error(Z);return}if(typeof t!="string"){var Z=u+" requires a class name of type String for the sample html element to be used as a model for building playlist items (releases)";console.error(Z);return}t=t.substr(t.indexOf(".")+1);if($("#"+e+" ."+t).length==0){var Z='An html element with the class, "'+t+'",  could not be found within #'+e;console.error(Z);return}if(!n){var Z=u+" requires that an instance of org.pbskids.video.Player to serve videos to";console.error(Z);return}this.addEventListener=function(e,t){$(o).off(e,t);$(o).on(e,t)};this.removeEventListener=function(e,t){$(o).off(e,t)};this.iScroll;this.scrollToSelectedItem=function(){ot(_releaseClass+".selected")};this.getContainerID=function(){return y};this.getListData=function(){return T};this.getCategory=function(){return N};this.getProgram=function(){return C};this.getGroup=function(){return L};this.getTotalCount=function(){return A};this.getQueryOptions=function(){return M};this.autoPlayNext=function(e){if(typeof e==="boolean")Y.autoPlayNext=e;return Y.autoPlayNext};this.autoPlay=function(e){if(typeof e==="boolean")Y.autoPlay=e;return Y.autoPlay};this.hasPlaylist=function(){return v};this.loading=function(){return m};this.canLoadMore=function(){return g&&!m};this.length=function(){return T.length};this.selectedIndex=function(e){e=parseInt(e);if(!isNaN(e)){S=Math.max(0,e%T.length);$(_releaseClass+".guid_"+T[S].guid,a).triggerHandler("click")}return S||0};this.selectItem=function(e){var t=/^[0-9a-z]{8}\-[0-9a-z]{4}\-[0-9a-z]{4}\-[0-9a-z]{4}\-[0-9a-z]{12}$/;if(t.test(e)){$(_releaseClass+".guid_"+e,a).triggerHandler("click")}else if(!isNaN(parseInt(e))){selectedIndex(e)}};this.setFocusTo=function(e){var t=e;if(typeof t!="object")t=$(""+e,a);if(t.length==0){t=$(_releaseClass+".guid_"+e,a);if(t.length==0)return}$(_releaseClass+".selected",a).removeClass("selected");$(t).addClass("selected");S=$(t).prop("data-item-index");s.scrollToSelectedItem()};this.refresh=function(e){m=true;var t={startindex:1,endindex:20,program:"",category:"",group:"",selectedID:"",status:"available",player:f.videoType(),flash:f.isFlashPlayer(),"return":""};if(typeof e=="object"&&e!==null)for(var n in e)t[n]=e[n];if(h)t.program=h;if(p)t.category=p;org.pbskids.video.PlaylistEvent.dispatchEvent({eventType:org.pbskids.video.PlaylistEvent.REFRESH_START,category:t.category||t.group||t.program,caller:o});this.purge();var r=new Date;var i=r.getMinutes()+"_"+r.getSeconds()+"_"+r.getMilliseconds();O=i;if(Y.debugMode)console.log(a.prop("id")+": fetch: "+(t.category||t.group||t.program));$.ajax({type:"GET",url:x+"getVideos/",dataType:"jsonp",data:t,success:function(e){ht(e.items,e.matched,t,i)}});if(w)w.detach();if(Y.loadingIndicator)$("."+Y.loadingIndicatorClass,"#"+y).css("display","block");if(s.iScroll)$(s.iScroll["vScrollbarWrapper"]).css("display","none")};this.appendMore=function(e){if(!this.canLoadMore())return;m=true;var t=M;t.startindex=T.length+1;t.endindex=T.length+(e||20);t.status="available";org.pbskids.video.PlaylistEvent.dispatchEvent({eventType:org.pbskids.video.PlaylistEvent.APPEND_START,category:t.category||t.group||t.program,caller:o});var n=new Date;var r=n.getMinutes()+"_"+n.getSeconds()+"_"+n.getMilliseconds();O=r;if(Y.debugMode)console.log(a.prop("id")+": fetch to append: "+(t.category||t.group||t.program));$.ajax({type:"GET",url:x+"getVideos/",dataType:"jsonp",data:t,success:function(e){ht(e.items,e.matched,t,r,"APPEND")}});if(E)E.detach();if(w){w.detach();w.appendTo(a);if(s.iScroll){s.iScroll.refresh();setTimeout(function(){ot(".appendingIndicator-container")},"250")}}};this.appendItem=function(e){if(typeof e=="object"&&e!==null){return tt(e,T.push(e)-1)}return null};this.copyFromPlaylist=function(e,t){if(e)if(e.getListData)this.copyPlaylistData(e.getListData(),e.getQueryOptions(),t,e.getTotalCount())};this.copyPlaylistData=function(e,t,n,r){if(e){m=true;var i=t||{};i.startindex=1;i.endindex=e.length;i.status="available";if(n)i.selectedID=n;org.pbskids.video.PlaylistEvent.dispatchEvent({eventType:org.pbskids.video.PlaylistEvent.COPY_START,category:i.category||i.group||i.program,caller:o});this.purge();var s=new Date;var u=s.getMinutes()+"_"+s.getSeconds()+"_"+s.getMilliseconds();O=u;if(w)w.detach();if(Y.debugMode)console.log(a.prop("id")+": copy: "+(i.category||i.group||i.program));ht(e,r||e.length,i,u,"COPY")}};this.abortLoad=function(){if(Y.debugMode)console.log(a.prop("id")+": aborting loading");O="undefined"};this.purge=function(){st(_,s.next);st(D,s.previous);S=0;T=[];v=false;m=false;g=false;if(Y.loadingIndicator)$("."+Y.loadingIndicatorClass,"#"+y).css("display","none");if(w)w.detach();if(E)E.detach();if(s.iScroll)$(s.iScroll["vScrollbarWrapper"]).css("display","none");a.empty();if(s.iScroll)s.iScroll.refresh()};this.previous=function(e){if(f.currentTime()/f.duration()>.1){if(e)at("Skip Buttons","Rewind");f.seekToTime(0)}else{if(e)at("Skip Buttons","Play Previous");var t=$(_releaseClass+".selected",a).first().prev();if(t.length==0)t=$(_releaseClass,a).last();$(t).triggerHandler("click")}};this.next=function(e){if(e)at("Skip Buttons","Play Next");var t=$(_releaseClass+".selected",a).last().next();if(t.length==0)t=$(_releaseClass,a).first();$(t).triggerHandler("click")};this.registerControl=function(e,t){if(Y.debugMode&&t)console.log("registerControl() : "+"type: "+e+" , selector: "+t);var n=$(t);if(n.length==0){if(t){var r='Html element(s) could not be found using the selector, "'+t+'"';if(console&&console.warn)console.warn(r)}return}switch(e){case"nextVideoControl":_=n;if(s.hasPlaylist())it(_,s.next);else st(_,s.next);break;case"previousVideoControl":D=n;if(s.hasPlaylist())it(D,s.previous);else st(D,s.previous);break;default:if(console&&console.warn)console.warn('The control-type, "'+e+'" is not a recognize control-type in '+u+".registerControl()")}};et()};org.pbskids.video.PlaylistEvent=function(){var e="org_pbskids_video_PlaylistEvent";return{debugMode:false,REFRESH_START:e+"_RefreshStart",REFRESH_COMPLETE:e+"_RefreshComplete",APPEND_START:e+"_AppendStart",APPEND_COMPLETE:e+"_AppendComplete",COPY_START:e+"_CopyStart",COPY_COMPLETE:e+"_CopyComplete",RELEASE_SELECTED:e+"_ReleaseSelected",dispatchEvent:function(t){var n,r={};t.eventType=(t.eventType||"").replace(/\./g,"_");switch(t.eventType){case this.REFRESH_START:r.category=t.category||"New Videos";break;case this.REFRESH_COMPLETE:r.category=t.category||"New Videos";r.playlist=t.playlist||[];r.totalCount=t.totalCount||0;break;case this.APPEND_START:r.category=t.category||"New Videos";break;case this.APPEND_COMPLETE:r.category=t.category||"New Videos";r.playlist=t.playlist||[];r.totalCount=t.totalCount||0;break;case this.COPY_START:r.category=t.category||"New Videos";break;case this.COPY_COMPLETE:r.category=t.category||"New Videos";r.playlist=t.playlist||[];r.totalCount=t.totalCount||0;break;case this.RELEASE_SELECTED:r.release=t.release||{};r.playlist=t.playlist||{};break;default:if(this.debugMode){console.warn("eventType, "+t.eventType+", is not defined in "+e);if(t)console.log(t)}return}n=$.Event(t.eventType);for(var i in r)n[i]=r[i];$(t.caller||document).trigger(n)}}}();org.pbskids.swfobject2_2=function(){function C(){if(b){return}try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=true;var n=c.length;for(var r=0;r<n;r++){c[r]()}}function k(e){if(b){e()}else{c[c.length]=e}}function L(t){if(typeof u.addEventListener!=e){u.addEventListener("load",t,false)}else{if(typeof a.addEventListener!=e){a.addEventListener("load",t,false)}else{if(typeof u.attachEvent!=e){z(u,"onload",t)}else{if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n();t()}}else{u.onload=t}}}}}function A(){if(l){O()}else{M()}}function O(){var n=a.getElementsByTagName("body")[0];var r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else{if(o<10){o++;setTimeout(arguments.callee,10);return}}n.removeChild(r);s=null;M()})()}else{M()}}function M(){var t=h.length;if(t>0){for(var n=0;n<t;n++){var r=h[n].id;var i=h[n].callbackFn;var s={success:false,id:r};if(T.pv[0]>0){var o=R(r);if(o){if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312)){V(r,true);if(i){s.success=true;s.ref=_(r);i(s)}}else{if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";if(o.getAttribute("class")){u.styleclass=o.getAttribute("class")}if(o.getAttribute("align")){u.align=o.getAttribute("align")}var a={};var f=o.getElementsByTagName("param");var l=f.length;for(var c=0;c<l;c++){if(f[c].getAttribute("name").toLowerCase()!="movie"){a[f[c].getAttribute("name")]=f[c].getAttribute("value")}}P(u,a,r,i)}else{H(o);if(i){i(s)}}}}}else{V(r,true);if(i){var p=_(r);if(p&&typeof p.SetVariable!=e){s.success=true;s.ref=p}i(s)}}}}}function _(n){var r=null;var i=R(n);if(i&&i.nodeName=="OBJECT"){if(typeof i.SetVariable!=e){r=i}else{var s=i.getElementsByTagName(t)[0];if(s){r=s}}}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=true;g=i||null;y={success:false,id:r};var o=R(r);if(o){if(o.nodeName=="OBJECT"){v=B(o);m=null}else{v=o;m=r}t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310){t.width="310"}if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137){t.height="137"}a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;if(typeof n.flashvars!=e){n.flashvars+="&"+l}else{n.flashvars=l}if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew";c.setAttribute("id",r);o.parentNode.insertBefore(c,o);o.style.display="none";(function(){if(o.readyState==4){o.parentNode.removeChild(o)}else{setTimeout(arguments.callee,10)}})()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(B(e),t);e.style.display="none";(function(){if(e.readyState==4){e.parentNode.removeChild(e)}else{setTimeout(arguments.callee,10)}})()}else{e.parentNode.replaceChild(B(e),e)}}function B(e){var n=U("div");if(T.win&&T.ie){n.innerHTML=e.innerHTML}else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++){if(!(i[o].nodeType==1&&i[o].nodeName=="PARAM")&&!(i[o].nodeType==8)){n.appendChild(i[o].cloneNode(true))}}}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312){return o}if(u){if(typeof n.id==e){n.id=s}if(T.ie&&T.win){var a="";for(var f in n){if(n[f]!=Object.prototype[f]){if(f.toLowerCase()=="data"){r.movie=n[f]}else{if(f.toLowerCase()=="styleclass"){a+=' class="'+n[f]+'"'}else{if(f.toLowerCase()!="classid"){a+=" "+f+'="'+n[f]+'"'}}}}}var l="";for(var c in r){if(r[c]!=Object.prototype[c]){l+='<param name="'+c+'" value="'+r[c]+'" />'}}u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";p[p.length]=n.id;o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n){if(n[d]!=Object.prototype[d]){if(d.toLowerCase()=="styleclass"){h.setAttribute("class",n[d])}else{if(d.toLowerCase()!="classid"){h.setAttribute(d,n[d])}}}}for(var v in r){if(r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"){F(h,v,r[v])}}u.parentNode.replaceChild(h,u);o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function I(e){var t=R(e);if(t&&t.nodeName=="OBJECT"){if(T.ie&&T.win){t.style.display="none";(function(){if(t.readyState==4){q(e)}else{setTimeout(arguments.callee,10)}})()}else{t.parentNode.removeChild(t)}}}function q(e){var t=R(e);if(t){for(var n in t){if(typeof t[n]=="function"){t[n]=null}}t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n);d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?true:false}function X(n,r,i,s){if(T.ie&&T.mac){return}var o=a.getElementsByTagName("head")[0];if(!o){return}var u=i&&typeof i=="string"?i:"screen";if(s){E=null;S=null}if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css");f.setAttribute("media",u);E=o.appendChild(f);if(T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0){E=a.styleSheets[a.styleSheets.length-1]}S=u}if(T.ie&&T.win){if(E&&typeof E.addRule==t){E.addRule(n,r)}}else{if(E&&typeof a.createTextNode!=e){E.appendChild(a.createTextNode(n+" {"+r+"}"))}}}function V(e,t){if(!x){return}var n=t?"visible":"hidden";if(b&&R(e)){R(e).style.visibility=n}else{X("#"+e,"visibility:"+n)}}function $(t){var n=/[\\\"<>\.;]/;var r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=false,c=[A],h=[],p=[],d=[],v,m,g,y,b=false,w=false,E,S,x=true,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,v=!+"1",m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t){g=f.plugins[n].description;if(g&&!(typeof f.mimeTypes!=e&&f.mimeTypes[i]&&!f.mimeTypes[i].enabledPlugin)){l=true;v=false;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof u.ActiveXObject!=e){try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=true;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}}}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3){return}if(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body)){C()}if(!b){if(typeof a.addEventListener!=e){a.addEventListener("DOMContentLoaded",C,false)}if(T.ie&&T.win){a.attachEvent(o,function(){if(a.readyState=="complete"){a.detachEvent(o,arguments.callee);C()}});if(u==top){(function(){if(b){return}try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()})()}}if(T.wk){(function(){if(b){return}if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()})()}L(C)}}();var J=function(){if(T.ie&&T.win){window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++){d[t][0].detachEvent(d[t][1],d[t][2])}var n=p.length;for(var r=0;r<n;r++){I(p[r])}for(var i in T){T[i]=null}T=null;for(var s in org.pbskids.swfobject2_2){org.pbskids.swfobject2_2[s]=null}org.pbskids.swfobject2_2=null})}}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;h[h.length]=i;V(e,false)}else{if(r){r({success:false,id:e})}}},getObjectById:function(e){if(T.w3){return _(e)}},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:false,id:r};if(T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o){V(r,false);k(function(){i+="";s+="";var p={};if(l&&typeof l===t){for(var d in l){p[d]=l[d]}}p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t){for(var m in f){v[m]=f[m]}}if(a&&typeof a===t){for(var g in a){if(typeof v.flashvars!=e){v.flashvars+="&"+g+"="+a[g]}else{v.flashvars=g+"="+a[g]}}}if(W(o)){var y=j(p,v,r);if(p.id==r){V(r,true)}h.success=true;h.ref=y}else{if(u&&D()){p.data=u;P(p,v,r,c);return}else{V(r,true)}}if(c){c(h)}})}else{if(c){c(h)}}},switchOffAutoHideShow:function(){x=false},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){if(T.w3){return j(e,t,n)}else{return undefined}},showExpressInstall:function(e,t,n,r){if(T.w3&&D()){P(e,t,n,r)}},removeSWF:function(e){if(T.w3){I(e)}},createCSS:function(e,t,n,r){if(T.w3){X(e,t,n,r)}},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){if(/\?/.test(t)){t=t.split("?")[1]}if(e==null){return $(t)}var n=t.split("&");for(var r=0;r<n.length;r++){if(n[r].substring(0,n[r].indexOf("="))==e){return $(n[r].substring(n[r].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(w){var e=R(s);if(e&&v){e.parentNode.replaceChild(v,e);if(m){V(m,true);if(T.ie&&T.win){v.style.display="block"}}if(g){g(y)}}w=false}}}}();(function(e,t,n){function c(){s=t[o](function(){r.each(function(){var t=e(this),n=t.width(),r=t.height(),i=e.data(this,a);if(n!==i.w||r!==i.h){t.trigger(u,[i.w=n,i.h=r])}});c()},i[f])}var r=e([]),i=e.resize=e.extend(e.resize,{}),s,o="setTimeout",u="resize",a=u+"-special-event",f="delay",l="throttleWindow";i[f]=250;i[l]=true;e.event.special[u]={setup:function(){if(!i[l]&&this[o]){return false}var t=e(this);r=r.add(t);e.data(this,a,{w:t.width(),h:t.height()});if(r.length===1){c()}},teardown:function(){if(!i[l]&&this[o]){return false}var t=e(this);r=r.not(t);t.removeData(a);if(!r.length){clearTimeout(s)}},add:function(t){function s(t,i,s){var o=e(this),u=e.data(this,a);u.w=i!==n?i:o.width();u.h=s!==n?s:o.height();r.apply(this,arguments)}if(!i[l]&&this[o]){return false}var r;if(e.isFunction(t)){r=t;return s}else{r=t.handler;t.handler=s}}}})(jQuery,this);(function(e,t){function n(e){if(s==="")return e;e=e.charAt(0).toUpperCase()+e.substr(1);return s+e}var r=Math,i=t.createElement("div").style,s=function(){var e="t,webkitT,MozT,msT,OT".split(","),t,n=0,r=e.length;for(;n<r;n++){t=e[n]+"ransform";if(t in i){return e[n].substr(0,e[n].length-1)}}return false}(),o=s?"-"+s.toLowerCase()+"-":"",u=n("transform"),a=n("transitionProperty"),f=n("transitionDuration"),l=n("transformOrigin"),c=n("transitionTimingFunction"),h=n("transitionDelay"),p=/android/gi.test(navigator.appVersion),d=/iphone|ipad/gi.test(navigator.appVersion),v=/hp-tablet/gi.test(navigator.appVersion),m=n("perspective")in i,g=e.navigator.msPointerEnabled,y="ontouchstart"in e&&!v,b=!!s,w=n("transition")in i,E="onorientationchange"in e?"orientationchange":"resize",S=g?"MSPointerDown":y?"touchstart":"mousedown",x=g?"MSPointerMove":y?"touchmove":"mousemove",T=g?"MSPointerUp":y?"touchend":"mouseup",N=g?"MSPointerOut":y?"touchcancel":"mouseout";MOUSEOUT_EV=document.attachEvent?"mouseleave":"mouseout",WHEEL_EV=s=="Moz"?"DOMMouseScroll":"mousewheel",TRNEND_EV=function(){if(s===false)return false;var e={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"};return e[s]}(),nextFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){return setTimeout(e,1)}}(),cancelFrame=function(){return e.cancelRequestAnimationFrame||e.webkitCancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),translateZ=m?" translateZ(0)":"",iScroll=function(n,r){var i=this,s;i.wrapper=typeof n=="object"?n:t.getElementById(n);i.wrapper.style.overflow="hidden";i.wrapper.style.position="relative";i.scroller=i.wrapper.children[0];i.options={hScroll:true,vScroll:true,x:0,y:0,bounce:true,bounceLock:false,momentum:true,lockDirection:true,useTransform:true,useTransition:false,topOffset:0,checkDOMChanges:false,handleClick:true,dragScrollerWithMouse:true,scrollBarsOnTouchDevice:true,dragScrollBars:false,minBarWidth:8,minBarHeight:8,hScrollbar:true,vScrollbar:true,fixedScrollbar:p,hideScrollbar:d,fadeScrollbar:d&&m,scrollbarClass:"",zoom:false,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:false,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault?e.preventDefault():e.returnValue=false},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null,onAnimationEnd:null};for(s in r)i.options[s]=r[s];i.x=i.options.x;i.y=i.options.y;i.options.useTransform=b&&i.options.useTransform;i.options.hScrollbar=i.options.hScroll&&i.options.hScrollbar;i.options.vScrollbar=i.options.vScroll&&i.options.vScrollbar;i.options.zoom=i.options.useTransform&&i.options.zoom;i.options.useTransition=w&&i.options.useTransition;if(i.options.zoom&&p){translateZ=""}i.scroller.style[a]=i.options.useTransform?o+"transform":"top left";i.scroller.style[f]="0";i.scroller.style[l]="0 0";if(i.options.useTransition)i.scroller.style[c]="cubic-bezier(0.33,0.66,0.66,1)";if(i.options.useTransform){i.scroller.style[u]="translate("+i.x+"px,"+i.y+"px)"+translateZ}else{i.scroller.style.position="relative";i.scroller.style.top=i.y+"px";i.scroller.style.left=i.x+"px"}if(i.options.useTransition)i.options.fixedScrollbar=true;i.refresh();i._bind(E,e);i._bind(S);if(!y){i._bind(MOUSEOUT_EV,i.wrapper);if(i.options.wheelAction!="none")i._bind(WHEEL_EV)}if(i.options.checkDOMChanges)i.checkDOMTime=setInterval(function(){i._checkDOMChanges()},500);if(!Date.now){Date.now=function(){return(new Date).valueOf()}}};iScroll.prototype={enabled:true,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var t=this;e.target=e.srcElement||e.target;switch(e.type){case S:if(t.draggingScrollbar===true)return;switch(e.target){case t.vScrollbarIndicator:case t.hScrollbarIndicator:case t.vScrollbarWrapper:case t.hScrollbarWrapper:t._dragBarStart(e);break;default:if(!y&&e.button!==0)return;t._start(e)}break;case x:if(t.draggingScrollbar===true)t._dragBar(e);else t._move(e);break;case N:if(g)return;case T:if(t.draggingScrollbar===true)t._dragBarEnd(e);else t._end(e);break;case E:t._resize();break;case WHEEL_EV:t._wheel(e);break;case MOUSEOUT_EV:t._mouseout(e);break;case TRNEND_EV:t._transitionEnd(e);break}},events:{},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(e){var n=this,i;if(n.draggingScrollbar){n._unbind(x,document);n._unbind(T,document);n._unbind(N,document);n.scrollingDirection=null;n.draggingScrollbar=false}if(!n[e+"Scrollbar"]||!n.options.dragScrollBars){if(n.dragScrollBars){n._unbind(S,n[e+"ScrollbarIndicator"]);n._unbind(S,n[e+"ScrollbarWrapper"])}}n.dragScrollBars=n.options.dragScrollBars;if(!n[e+"Scrollbar"]){if(n[e+"ScrollbarWrapper"]){if(b)n[e+"ScrollbarIndicator"].style[u]="";n[e+"ScrollbarWrapper"].parentNode.removeChild(n[e+"ScrollbarWrapper"]);n[e+"ScrollbarWrapper"]=null;n[e+"ScrollbarIndicator"]=null}return}if(!n[e+"ScrollbarWrapper"]){i=t.createElement("div");if(n.options.scrollbarClass)i.className=n.options.scrollbarClass+e.toUpperCase();else{i.style.position="relative";i.style.zIndex="100";if(e=="h"){i.style.height="7px";i.style.bottom="1px";i.style.left="2px";i.style.right=(n.vScrollbar?"7":"2")+"px"}else{i.style.width="7px";i.style.bottom=(n.hScrollbar?"7":"2")+"px";i.style.top="2px";i.style.right="1px"}}i.style.overflow="hidden";n._addCSSText(i,"opacity:"+(n.options.hideScrollbar?"0":"1"));n._addCSSText(i,o+"transition-property:opacity");n._addCSSText(i,o+"transition-duration:"+(n.options.fadeScrollbar?"350ms":"0"));if(n.options.dragScrollBars===false)n._addCSSText(i,"pointer-events:none");n.wrapper.appendChild(i);n[e+"ScrollbarWrapper"]=i;i=t.createElement("div");if(!n.options.scrollbarClass){i.style.zIndex="100";n._addCSSText(i,"background:rgba(0,0,0,0.5)");n._addCSSText(i,"border:1px solid rgba(255,255,255,0.9)");n._addCSSText(i,o+"background-clip:padding-box");n._addCSSText(i,o+"box-sizing:border-box");n._addCSSText(i,e=="h"?"height:100%":"width:100%");n._addCSSText(i,o+"border-radius:3px");n._addCSSText(i,"border-radius:3px")}if(n.options.dragScrollBars===false)n._addCSSText(i,"pointer-events:none");i.style.position="relative";n._addCSSText(i,o+"transition-property:"+o+"transform");n._addCSSText(i,o+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");n._addCSSText(i,o+"transition-duration:0");n._addCSSText(i,o+"transform: translate(0,0)"+translateZ);if(n.options.useTransition)n._addCSSText(i,o+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");n[e+"ScrollbarWrapper"].appendChild(i);n[e+"ScrollbarIndicator"]=i}if(e=="h"){n.hScrollbarSize=n.hScrollbarWrapper.clientWidth;n.hScrollbarIndicatorSize=r.max(r.round(n.hScrollbarSize*n.hScrollbarSize/n.scrollerW),n.options.minBarWidth||8);n.hScrollbarIndicator.style.width=n.hScrollbarIndicatorSize+"px";n.hScrollbarMaxScroll=n.hScrollbarSize-n.vScrollbarIndicator.offsetWidth;n.hScrollbarProp=n.hScrollbarMaxScroll/n.maxScrollX;n.hScrollbarOffset=null}else{n.vScrollbarSize=n.vScrollbarWrapper.clientHeight;n.vScrollbarIndicatorSize=r.max(r.round(n.vScrollbarSize*n.vScrollbarSize/n.scrollerH),n.options.minBarHeight||8);n.vScrollbarIndicator.style.height=n.vScrollbarIndicatorSize+"px";n.vScrollbarMaxScroll=n.vScrollbarSize-n.vScrollbarIndicator.offsetHeight;n.vScrollbarProp=n.vScrollbarMaxScroll/n.maxScrollY;n.vScrollbarOffset=null}if(n.options.dragScrollBars){n._bind(S,n[e+"ScrollbarIndicator"]);n._bind(S,n[e+"ScrollbarWrapper"])}n._scrollbarPos(e,true)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},p?200:0)},_dragBarStart:function(e){e.preventDefault?e.preventDefault():e.returnValue=false;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();var t=this,n=t.hScrollbarIndicator==e.target||t.hScrollbarWrapper==e.target?"h":"v";if(!t[n+"ScrollbarOffset"])t[n+"ScrollbarOffset"]=t._offset(t[n+"ScrollbarWrapper"])[n=="h"?"left":"top"];t.scrollingDirection=n;t._bind(x,document);t._bind(T,document);t._bind(N,document);t.draggingScrollbar=true;t._dragBar(e)},_dragBar:function(e){var t=this,n=t.scrollingDirection=="h"?["h","X","Width"]:["v","Y","Height"],i=document.body,s=document.documentElement,o={X:t.x,Y:t.y};o[n[1]]=r.max(0,r.min(t[n[0]+"ScrollbarMaxScroll"],(e["page"+n[1]]||e["client"+n[1]]+i.scrollTop+s.scrollTop)+t[n[0]+"ScrollbarOffset"]-t[n[0]+"ScrollbarIndicator"]["offset"+n[2]]/2))/t[n[0]+"ScrollbarProp"];t._pos(o.X,o.Y)},_dragBarEnd:function(e){var t=this;t.draggingScrollbar=false;t.scrollingDirection=null;t._unbind(x,document);t._unbind(T,document);t._unbind(N,document);if(t.options.onScrollEnd)t.options.onScrollEnd.call(t)},_pos:function(e,t){if(this.zoomed)return;e=this.hScroll?e?e:0:0;t=this.vScroll?t?t:0:0;if(this.options.useTransform){this.scroller.style[u]="translate("+e+"px,"+t+"px) scale("+this.scale+")"+translateZ}else{e=r.round(e);t=r.round(t);this.scroller.style.left=e+"px";this.scroller.style.top=t+"px"}this.x=e;this.y=t;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(e,t){var n=this,i=e=="h"?n.x:n.y,s;if(!n[e+"Scrollbar"])return;i=n[e+"ScrollbarProp"]*i;if(i<0){if(!n.options.fixedScrollbar){s=n[e+"ScrollbarIndicatorSize"]+r.round(i*3);if(s<8)s=8;n[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=s+"px"}i=0}else if(i>n[e+"ScrollbarMaxScroll"]){if(!n.options.fixedScrollbar){s=n[e+"ScrollbarIndicatorSize"]-r.round((i-n[e+"ScrollbarMaxScroll"])*3);if(s<8)s=8;n[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=s+"px";i=n[e+"ScrollbarMaxScroll"]+(n[e+"ScrollbarIndicatorSize"]-s)}else{i=n[e+"ScrollbarMaxScroll"]}}n[e+"ScrollbarWrapper"].style[h]="0";n[e+"ScrollbarWrapper"].style.opacity=t&&n.options.hideScrollbar?"0":"1";if(n.options.useTransform){n[e+"ScrollbarIndicator"].style[u]="translate("+(e=="h"?i+"px,0)":"0,"+i+"px)")+translateZ}else{n[e+"ScrollbarIndicator"].style[e=="h"?"left":"top"]=i+"px"}},_start:function(e){var t=this,n=y?e.touches[0]:e,i,s,o,a,f;if(!t.enabled||!t.options.dragScrollerWithMouse&&!(y||g))return;if(t.options.onBeforeScrollStart)t.options.onBeforeScrollStart.call(t,e);if(t.options.useTransition||t.options.zoom)t._transitionTime(0);t.moved=false;t.animating=false;t.zoomed=false;t.distX=0;t.distY=0;t.absDistX=0;t.absDistY=0;t.dirX=0;t.dirY=0;if(t.options.zoom&&y&&e.touches.length>1){a=r.abs(e.touches[0].pageX-e.touches[1].pageX);f=r.abs(e.touches[0].pageY-e.touches[1].pageY);t.touchesDistStart=r.sqrt(a*a+f*f);t.originX=r.abs(e.touches[0].pageX+e.touches[1].pageX-t.wrapperOffsetLeft*2)/2-t.x;t.originY=r.abs(e.touches[0].pageY+e.touches[1].pageY-t.wrapperOffsetTop*2)/2-t.y;if(t.options.onZoomStart)t.options.onZoomStart.call(t,e)}if(t.options.momentum){if(t.options.useTransform){i=getComputedStyle(t.scroller,null)[u].replace(/[^0-9\-.,]/g,"").split(",");s=i[4]*1;o=i[5]*1}else{s=getComputedStyle(t.scroller,null).left.replace(/[^0-9-]/g,"")*1;o=getComputedStyle(t.scroller,null).top.replace(/[^0-9-]/g,"")*1}if(s!=t.x||o!=t.y){if(t.options.useTransition)t._unbind(TRNEND_EV);else cancelFrame(t.aniTime);t.steps=[];t._pos(s,o)}}t.absStartX=t.x;t.absStartY=t.y;t.startX=t.x;t.startY=t.y;t.pointX=n.pageX;t.pointY=n.pageY;t.startTime=e.timeStamp||Date.now();if(t.options.onScrollStart)t.options.onScrollStart.call(t,e);t._bind(x);t._bind(T);t._bind(N)},_move:function(e){var t=this,n=y?e.touches[0]:e,i=n.pageX-t.pointX,s=n.pageY-t.pointY,o=t.x+i,a=t.y+s,f,l,c,h=e.timeStamp||Date.now();if(t.options.onBeforeScrollMove)t.options.onBeforeScrollMove.call(t,e);if(t.options.zoom&&y&&e.touches.length>1){f=r.abs(e.touches[0].pageX-e.touches[1].pageX);l=r.abs(e.touches[0].pageY-e.touches[1].pageY);t.touchesDist=r.sqrt(f*f+l*l);t.zoomed=true;c=1/t.touchesDistStart*t.touchesDist*this.scale;if(c<t.options.zoomMin)c=.5*t.options.zoomMin*Math.pow(2,c/t.options.zoomMin);else if(c>t.options.zoomMax)c=2*t.options.zoomMax*Math.pow(.5,t.options.zoomMax/c);t.lastScale=c/this.scale;o=this.originX-this.originX*t.lastScale+this.x,a=this.originY-this.originY*t.lastScale+this.y;this.scroller.style[u]="translate("+o+"px,"+a+"px) scale("+c+")"+translateZ;if(t.options.onZoom)t.options.onZoom.call(t,e);return}t.pointX=n.pageX;t.pointY=n.pageY;if(o>0||o<t.maxScrollX){o=t.options.bounce?t.x+i/2:o>=0||t.maxScrollX>=0?0:t.maxScrollX}if(a>t.minScrollY||a<t.maxScrollY){a=t.options.bounce?t.y+s/2:a>=t.minScrollY||t.maxScrollY>=0?t.minScrollY:t.maxScrollY}t.distX+=i;t.distY+=s;t.absDistX=r.abs(t.distX);t.absDistY=r.abs(t.distY);if(t.absDistX<6&&t.absDistY<6){return}if(t.options.lockDirection){if(t.absDistX>t.absDistY+5){a=t.y;s=0}else if(t.absDistY>t.absDistX+5){o=t.x;i=0}}t.moved=true;t._pos(o,a);t.dirX=i>0?-1:i<0?1:0;t.dirY=s>0?-1:s<0?1:0;if(h-t.startTime>300){t.startTime=h;t.startX=t.x;t.startY=t.y}if(t.options.onScrollMove)t.options.onScrollMove.call(t,e)},_end:function(e){if(y&&e.touches.length!==0)return;var n=this,i=y?e.changedTouches[0]:e,s,o,a={dist:0,time:0},l={dist:0,time:0},c=(e.timeStamp||Date.now())-n.startTime,h=n.x,p=n.y,d,v,m,g,b;n._unbind(x);n._unbind(T);n._unbind(N);if(n.options.onBeforeScrollEnd)n.options.onBeforeScrollEnd.call(n,e);if(n.zoomed){b=n.scale*n.lastScale;b=Math.max(n.options.zoomMin,b);b=Math.min(n.options.zoomMax,b);n.lastScale=b/n.scale;n.scale=b;n.x=n.originX-n.originX*n.lastScale+n.x;n.y=n.originY-n.originY*n.lastScale+n.y;n.scroller.style[f]="200ms";n.scroller.style[u]="translate("+n.x+"px,"+n.y+"px) scale("+n.scale+")"+translateZ;n.zoomed=false;n.refresh();if(n.options.onZoomEnd)n.options.onZoomEnd.call(n,e);return}if(!n.moved){if(y){if(n.doubleTapTimer&&n.options.zoom){clearTimeout(n.doubleTapTimer);n.doubleTapTimer=null;if(n.options.onZoomStart)n.options.onZoomStart.call(n,e);n.zoom(n.pointX,n.pointY,n.scale==1?n.options.doubleTapZoom:1);if(n.options.onZoomEnd){setTimeout(function(){n.options.onZoomEnd.call(n,e)},200)}}else if(this.options.handleClick){n.doubleTapTimer=setTimeout(function(){n.doubleTapTimer=null;s=i.target;while(s.nodeType!=1)s=s.parentNode;if(s.tagName!="SELECT"&&s.tagName!="INPUT"&&s.tagName!="TEXTAREA"){o=t.createEvent("MouseEvents");o.initMouseEvent("click",true,true,e.view,1,i.screenX,i.screenY,i.clientX,i.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);o._fake=true;s.dispatchEvent(o)}},n.options.zoom?250:0)}}n._resetPos(200);if(n.options.onTouchEnd)n.options.onTouchEnd.call(n,e);return}if(c<300&&n.options.momentum){a=h?n._momentum(h-n.startX,c,-n.x,n.scrollerW-n.wrapperW+n.x,n.options.bounce?n.wrapperW:0):a;l=p?n._momentum(p-n.startY,c,-n.y,n.maxScrollY<0?n.scrollerH-n.wrapperH+n.y-n.minScrollY:0,n.options.bounce?n.wrapperH:0):l;h=n.x+a.dist;p=n.y+l.dist;if(n.x>0&&h>0||n.x<n.maxScrollX&&h<n.maxScrollX)a={dist:0,time:0};if(n.y>n.minScrollY&&p>n.minScrollY||n.y<n.maxScrollY&&p<n.maxScrollY)l={dist:0,time:0}}if(a.dist||l.dist){m=r.max(r.max(a.time,l.time),10);if(n.options.snap){d=h-n.absStartX;v=p-n.absStartY;if(r.abs(d)<n.options.snapThreshold&&r.abs(v)<n.options.snapThreshold){n.scrollTo(n.absStartX,n.absStartY,200)}else{g=n._snap(h,p);h=g.x;p=g.y;m=r.max(g.time,m)}}n.scrollTo(r.round(h),r.round(p),m);if(n.options.onTouchEnd)n.options.onTouchEnd.call(n,e);return}if(n.options.snap){d=h-n.absStartX;v=p-n.absStartY;if(r.abs(d)<n.options.snapThreshold&&r.abs(v)<n.options.snapThreshold)n.scrollTo(n.absStartX,n.absStartY,200);else{g=n._snap(n.x,n.y);if(g.x!=n.x||g.y!=n.y)n.scrollTo(g.x,g.y,g.time)}if(n.options.onTouchEnd)n.options.onTouchEnd.call(n,e);return}n._resetPos(200);if(n.options.onTouchEnd)n.options.onTouchEnd.call(n,e)},_resetPos:function(e){var t=this,n=t.x>=0?0:t.x<t.maxScrollX?t.maxScrollX:t.x,r=t.y>=t.minScrollY||t.maxScrollY>0?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(n==t.x&&r==t.y){if(t.moved){t.moved=false;if(t.options.onScrollEnd)t.options.onScrollEnd.call(t)}if(t.hScrollbar&&t.options.hideScrollbar){if(s=="webkit")t.hScrollbarWrapper.style[h]="300ms";t.hScrollbarWrapper.style.opacity="0"}if(t.vScrollbar&&t.options.hideScrollbar){if(s=="webkit")t.vScrollbarWrapper.style[h]="300ms";t.vScrollbarWrapper.style.opacity="0"}return}t.scrollTo(n,r,e||0)},_wheel:function(e){e.preventDefault?e.preventDefault():e.returnValue=false;var t=this,n,r,i,s,o;if("wheelDeltaX"in e){n=e.wheelDeltaX/12;r=e.wheelDeltaY/12}else if("wheelDelta"in e){n=r=e.wheelDelta/12}else if("detail"in e){n=r=-e.detail*3}else{return}if(t.options.wheelAction=="zoom"){o=t.scale*Math.pow(2,1/3*(r?r/Math.abs(r):0));if(o<t.options.zoomMin)o=t.options.zoomMin;if(o>t.options.zoomMax)o=t.options.zoomMax;if(o!=t.scale){if(!t.wheelZoomCount&&t.options.onZoomStart)t.options.onZoomStart.call(t,e);t.wheelZoomCount++;t.zoom(e.pageX,e.pageY,o,400);setTimeout(function(){t.wheelZoomCount--;if(!t.wheelZoomCount&&t.options.onZoomEnd)t.options.onZoomEnd.call(t,e)},400)}return}i=t.x+n;s=t.y+r;if(i>0)i=0;else if(i<t.maxScrollX)i=t.maxScrollX;if(s>t.minScrollY)s=t.minScrollY;else if(s<t.maxScrollY)s=t.maxScrollY;if(t.maxScrollY<0){t.scrollTo(i,s,0)}},_mouseout:function(e){var t=e.relatedTarget;if(!t){this._end(e);return}while(t=t.parentNode)if(t==this.wrapper)return;this._end(e)},_transitionEnd:function(e){var t=this;if(e.target!=t.scroller)return;t._unbind(TRNEND_EV);t._startAni()},_startAni:function(){var e=this,t=e.x,n=e.y,i,s,o,u=Date.now();if(e.animating)return;if(!e.steps.length){e._resetPos(400);return}i=e.steps.shift();if(i.x==t&&i.y==n)i.time=0;e.animating=true;e.moved=true;if(e.options.useTransition){e._transitionTime(i.time);e._pos(i.x,i.y);e.animating=false;if(i.time)e._bind(TRNEND_EV);else e._resetPos(0);return}o=function(){var a=Date.now(),f,l;if(a>=u+i.time){e._pos(i.x,i.y);e.animating=false;if(e.options.onAnimationEnd)e.options.onAnimationEnd.call(e);e._startAni();return}a=(a-u)/i.time-1;s=r.sqrt(1-a*a);f=(i.x-t)*s+t;l=(i.y-n)*s+n;e._pos(f,l);if(e.animating)e.aniTime=nextFrame(o)};o()},_transitionTime:function(e){e+="ms";this.scroller.style[f]=e;if(this.hScrollbar)this.hScrollbarIndicator.style[f]=e;if(this.vScrollbar)this.vScrollbarIndicator.style[f]=e},_momentum:function(e,t,n,i,s){var o=6e-4,u=r.abs(e)/t,a=u*u/(2*o),f=0,l=0;if(e>0&&a>n){l=s/(6/(a/u*o));n=n+l;u=u*n/a;a=n}else if(e<0&&a>i){l=s/(6/(a/u*o));i=i+l;u=u*i/a;a=i}a=a*(e<0?-1:1);f=u/o;return{dist:a,time:r.round(f)}},_offset:function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent){t-=e.offsetLeft;n-=e.offsetTop}if(e!=this.wrapper){t*=this.scale;n*=this.scale}return{left:t,top:n}},_snap:function(e,t){var n=this,i,s,o,u,a,f;o=n.pagesX.length-1;for(i=0,s=n.pagesX.length;i<s;i++){if(e>=n.pagesX[i]){o=i;break}}if(o==n.currPageX&&o>0&&n.dirX<0)o--;e=n.pagesX[o];a=r.abs(e-n.pagesX[n.currPageX]);a=a?r.abs(n.x-e)/a*500:0;n.currPageX=o;o=n.pagesY.length-1;for(i=0;i<o;i++){if(t>=n.pagesY[i]){o=i;break}}if(o==n.currPageY&&o>0&&n.dirY<0)o--;t=n.pagesY[o];f=r.abs(t-n.pagesY[n.currPageY]);f=f?r.abs(n.y-t)/f*500:0;n.currPageY=o;u=r.round(r.max(a,f))||200;return{x:e,y:t,time:u}},_bind:function(e,t,n,r){var i=this;if((t||this.scroller).addEventListener){(t||this.scroller).addEventListener(e,r||this,!!n)}else{this.events[e]=function(e){i.handleEvent.call(i,e)};(t||this.scroller).attachEvent("on"+e,this.events[e])}},_unbind:function(e,t,n,r){if((t||this.scroller).removeEventListener){(t||this.scroller).removeEventListener(e,r||this,!!n)}else if(this.events){if(this.events[e])(t||this.scroller).detachEvent("on"+e,this.events[e])}},_hasClass:function(e,t){return(new RegExp("(\\s|^)"+t+"(\\s|$)")).test(e.className)},_addClass:function(e,t){var n=this;if(!n._hasClass(e,t))e.className+=" "+t},_removeClass:function(e,t){var n=this;if(n._hasClass(e,t)){e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," ").replace(/\s+/g," ").replace(/^\s|\s$/,"")}},_toggleClass:function(e,t,n){var r=this;if(n===undefined)n=!r._hasClass(e,t);if(Boolean(n))r._addClass(e,t);else r._removeClass(e,t)},_hasCSSText:function(e,t){return(new RegExp("(;|^)"+t+"(;|$)")).test(e.style.cssText)},_addCSSText:function(e,t){var n=this;if(!n._hasCSSText(e,t))e.style.cssText=n._cleanCSSText(e.style.cssText+";"+t)},_removeCSSText:function(e,t){var n=this;if(n._hasClass(e,t))e.style.cssText=n._cleanCSSText(e.style.cssText.replace(new RegExp("(;|^)"+t+"(;|$)"),";"))},_toggleCSSText:function(e,t,n){var r=this;if(n===undefined)n=!r._hasCSSText(e,t);if(Boolean(n))r._addCSSText(e,t);else r._removeCSSText(e,t)},_cleanCSSText:function(e){return e.replace(/\s+/g," ").replace(/\s;|;\s/g,";").replace(/;;/g,";").replace(/^\s|\s$/,"").replace(/^;/,"")},_set_MS_Touch:function(e){var t=this;t.wrapper.style["-ms-touch-action"]=e;var n=t.wrapper.childNodes;for(var r in n){if(n[r].style){n[r].style["-ms-touch-action"]=e}}},destroy:function(){var t=this;t.scroller.style[u]="";if(g)t._set_MS_Touch("auto");t.hScrollbar=false;t.vScrollbar=false;t._scrollbar("h");t._scrollbar("v");t._unbind(E,e);t._unbind(S);t._unbind(x);t._unbind(T);t._unbind(N);if(!y){t._unbind(MOUSEOUT_EV,t.wrapper);t._unbind(WHEEL_EV)}if(t.options.useTransition)t._unbind(TRNEND_EV);if(t.options.checkDOMChanges)clearInterval(t.checkDOMTime);if(t.options.onDestroy)t.options.onDestroy.call(t)},refresh:function(){var n=this,i,s,o,u,a=0,l=0;if(n.scale<n.options.zoomMin)n.scale=n.options.zoomMin;n.wrapperW=n.wrapper.clientWidth||1;n.wrapperH=n.wrapper.clientHeight||1;n.minScrollY=-n.options.topOffset||0;n.scrollerW=r.round(n.scroller.offsetWidth*n.scale);n.scrollerH=r.round((n.scroller.offsetHeight+n.minScrollY)*n.scale);n.maxScrollX=n.wrapperW-n.scrollerW;n.maxScrollY=n.wrapperH-n.scrollerH+n.minScrollY;n.dirX=0;n.dirY=0;n.hScroll=n.options.hScroll&&n.maxScrollX<0;n.vScroll=n.options.vScroll&&(!n.options.bounceLock&&!n.hScroll||n.scrollerH>n.wrapperH);n.hScrollbar=n.hScroll&&n.options.hScrollbar&&(n.options.scrollBarsOnTouchDevice||!y);n.vScrollbar=n.vScroll&&n.options.vScrollbar&&n.scrollerH>n.wrapperH&&(n.options.scrollBarsOnTouchDevice||!y);i=n._offset(n.wrapper);n.wrapperOffsetLeft=-i.left;n.wrapperOffsetTop=-i.top;var c="iscroll_ie7_querySelector_class";if(!n.scroller.querySelector){n.scroller.querySelector=function(r){var i=t.documentElement.firstChild;var s=t.createElement("STYLE");i.appendChild(s);t.__qsResult=[];n._addClass(n.scroller,c);s.styleSheet.cssText="."+c+" "+r+"{x:expression(document.__qsResult.push(this))}";e.scrollBy(0,0);result=t.__qsResult[0]||null;i.removeChild(s);n._removeClass(n.scroller,c);return result}}if(!n.scroller.querySelectorAll){n.scroller.querySelectorAll=function(r){var i=t.documentElement.firstChild;var s=t.createElement("STYLE");var o=[];i.appendChild(s);t.__qsaels=[];n._addClass(n.scroller,c);s.styleSheet.cssText="."+c+" "+r+"{x:expression(document.__qsaels.push(this))}";e.scrollBy(0,0);for(var u in t.__qsaels)o.push(t.__qsaels[u]);i.removeChild(s);n._removeClass(n.scroller,c);return o}}if(typeof n.options.snap=="string"){n.pagesX=[];n.pagesY=[];u=n.scroller.querySelectorAll(n.options.snap);for(s=0,o=u.length;s<o;s++){a=n._offset(u[s]);a.left+=n.wrapperOffsetLeft;a.top+=n.wrapperOffsetTop;n.pagesX[s]=a.left<n.maxScrollX?n.maxScrollX:a.left*n.scale;n.pagesY[s]=a.top<n.maxScrollY?n.maxScrollY:a.top*n.scale}}else if(n.options.snap){n.pagesX=[];while(a>=n.maxScrollX){n.pagesX[l]=a;a=a-n.wrapperW;l++}if(n.maxScrollX%n.wrapperW)n.pagesX[n.pagesX.length]=n.maxScrollX-n.pagesX[n.pagesX.length-1]+n.pagesX[n.pagesX.length-1];a=0;l=0;n.pagesY=[];while(a>=n.maxScrollY){n.pagesY[l]=a;a=a-n.wrapperH;l++}if(n.maxScrollY%n.wrapperH)n.pagesY[n.pagesY.length]=n.maxScrollY-n.pagesY[n.pagesY.length-1]+n.pagesY[n.pagesY.length-1]}n._scrollbar("h");n._scrollbar("v");if(!n.zoomed){n.scroller.style[f]="0";n._resetPos(200)}n._toggleClass(n.scroller,"noHScrollBar",n.maxScrollX>=0);n._toggleClass(n.scroller,"noVScrollBar",n.maxScrollY>=0);n._toggleClass(n.scroller,"noScrollBars",n.maxScrollX>=0&&n.maxScrollY>=0);if(g)n._set_MS_Touch(n.enabled?"none":"auto");if(n.options.onRefresh)n.options.onRefresh.call(n)},scrollTo:function(e,t,n,r){var i=this,s=e,o,u;i.stop();if(!s.length)s=[{x:e,y:t,time:n,relative:r}];for(o=0,u=s.length;o<u;o++){if(s[o].relative){s[o].x=i.x-s[o].x;s[o].y=i.y-s[o].y}i.steps.push({x:s[o].x,y:s[o].y,time:s[o].time||0})}i._startAni()},scrollToElement:function(e,t){var n=this,i;e=e.nodeType?e:n.scroller.querySelector(e);if(!e)return;i=n._offset(e);i.left+=n.wrapperOffsetLeft;i.top+=n.wrapperOffsetTop;off=n._offset(n.scroller);i.left-=n.wrapperOffsetLeft+off.left;i.top-=n.wrapperOffsetTop+off.top;i.left=i.left>0?0:i.left<n.maxScrollX?n.maxScrollX:i.left;i.top=i.top>n.minScrollY?n.minScrollY:i.top<n.maxScrollY?n.maxScrollY:i.top;t=t===undefined?r.max(r.abs(i.left)*2,r.abs(i.top)*2):t;n.scrollTo(i.left,i.top,t)},scrollToPage:function(e,t,n){var r=this,i,s;n=n===undefined?400:n;if(r.options.onScrollStart)r.options.onScrollStart.call(r);if(r.options.snap){e=e=="next"?r.currPageX+1:e=="prev"?r.currPageX-1:e;t=t=="next"?r.currPageY+1:t=="prev"?r.currPageY-1:t;e=e<0?0:e>r.pagesX.length-1?r.pagesX.length-1:e;t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t;r.currPageX=e;r.currPageY=t;i=r.pagesX[e];s=r.pagesY[t]}else{i=-r.wrapperW*e;s=-r.wrapperH*t;if(i<r.maxScrollX)i=r.maxScrollX;if(s<r.maxScrollY)s=r.maxScrollY}r.scrollTo(i,s,n)},disable:function(){this.stop();this._resetPos(0);this.enabled=false;if(g)this._set_MS_Touch("auto");this._unbind(x);this._unbind(T);this._unbind(N);if(this.draggingScrollbar){this._unbind(x,document);this._unbind(T,document);this._unbind(N,document);this.scrollingDirection=null;this.draggingScrollbar=false}},enable:function(){this.enabled=true;if(g)this._set_MS_Touch("none")},stop:function(){if(this.options.useTransition)this._unbind(TRNEND_EV);else cancelFrame(this.aniTime);this.steps=[];this.moved=false;this.animating=false},zoom:function(e,t,n,r){var i=this,s=n/i.scale;if(!i.options.useTransform)return;i.zoomed=true;r=r===undefined?200:r;e=e-i.wrapperOffsetLeft-i.x;t=t-i.wrapperOffsetTop-i.y;i.x=e-e*s+i.x;i.y=t-t*s+i.y;i.scale=n;i.refresh();i.x=i.x>0?0:i.x<i.maxScrollX?i.maxScrollX:i.x;i.y=i.y>i.minScrollY?i.minScrollY:i.y<i.maxScrollY?i.maxScrollY:i.y;i.scroller.style[f]=r+"ms";i.scroller.style[u]="translate("+i.x+"px,"+i.y+"px) scale("+n+")"+translateZ;i.zoomed=false},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};i=null;var C=typeof exports!=="undefined"?exports:e;if(!C.org)C.org={};if(!C.org.pbskids)C.org.pbskids={};if(!C.org.pbskids.iScrollMOD)C.org.pbskids.iScrollMOD=iScroll})(window,document)