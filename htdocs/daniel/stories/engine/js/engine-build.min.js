var PBS;if(!PBS){PBS={}}if(!PBS.KIDS){PBS.KIDS={}}PBS.KIDS.storybook=(function(a){var b={};b.log=function(c){if(a.console){a.console.log(c)}},b.error=function(c){if(a.console){a.console.log("ERROR: "+c)}};b.debug=function(c){if(a.console){a.console.log("DEBUG: "+c)}};b.createCanvas=function(d,e){var c=a.document.createElement("canvas");if(e.id){c.id=e.id}if(e.className){c.className=e.className}if(e.width){c.width=e.width}if(e.height){c.height=e.height}if(d){d.appendChild(c)}return c.getContext("2d")};b.getElementPosition=function(d){var c,e={x:d.offsetLeft,y:d.offsetTop};if(d.offsetParent){c=b.getElementPosition(d.offsetParent);e.x+=c.x;e.y+=c.y}return e};b.distance=function(f,e){var d=f.x-e.x,c=f.y-e.y;return Math.sqrt(d*d+c*c)};b.getNumberFromString=function(c){if(c===undefined){return}else{if(typeof c!=="string"){c=c.toString()}}return c.replace(/[^-\d\.]/g,"")};b.isInPixelUnits=function(c){return(c.toString().toUpperCase().indexOf("PX")!==-1)};b.isInPercentageUnits=function(c){return(c.toString().indexOf("%")!==-1)};b.removeAllChildren=function(d){var c,e=d.childNodes.length;for(c=0;c<e;c+=1){d.removeChild(d.childNodes[d.childNodes.length-1])}};return b}(window));PBS.KIDS.storybook.eventDispatcher=function(){var a={},b={};a.addEventListener=function(c,d){if(b[c]===undefined){b[c]=[]}b[c].push(d)};a.removeEventListener=function(c,e){var d;if(b[c]){for(d=0;d<b[c].length;d+=1){if(b[c][d]===e){b[c].splice(d,1)}}}};a.removeAllEventListeners=function(){var c;for(var c in b){if(b.hasOwnProperty(c)){delete b[c]}}};a.dispatchEvent=function(c,d){var e;if(b[c]!==undefined){for(e=0;e<b[c].length;e+=1){b[c][e](d)}}};return a};PBS.KIDS.storybook.interactionObject=function(b,a,c){return a.KIDS.storybook.makeInteractionObject(b,a,a.KIDS.storybook.view(a,c))};PBS.KIDS.storybook.makeInteractionObject=function(h,i,f){var b=false,c=f.getElement(),a,d=function(m){var n={},l=i.KIDS.storybook.getElementPosition(c),k=m.changedTouches?m.changedTouches[0]:m;n.x=k.clientX-l.x;n.y=k.clientY-l.y;b=true;a={x:n.x,y:n.y};f.dispatchEvent("PRESS",{x:n.x,y:n.y});m.preventDefault()},e=function(m){var n={},l=i.KIDS.storybook.getElementPosition(c),k=m.changedTouches?m.changedTouches[0]:m;n.x=k.clientX-l.x;n.y=k.clientY-l.y;if(b){f.dispatchEvent("DRAG",{x:n.x,y:n.y,startX:a.x,startY:a.y,distanceX:h.Math.abs(n.x-a.x),distanceY:h.Math.abs(n.y-a.y),distance:i.KIDS.storybook.distance({x:n.x,y:n.y},{x:a.x,y:a.y})})}},g=function(k){b=false;f.dispatchEvent("RELEASE")},j=function(k){b=false;f.dispatchEvent("CANCEL")};f.cancelInteraction=function(){j()};c.addEventListener("mousedown",d);c.addEventListener("mousemove",e);c.addEventListener("mouseup",g);c.addEventListener("mouseout",j);c.addEventListener("touchstart",d);c.addEventListener("touchmove",e);c.addEventListener("touchend",g);c.addEventListener("touchcancel",j);return f};PBS.KIDS.storybook.resourceLoader=function(h,i){var g=i.KIDS.storybook.eventDispatcher(),b={},e=[],a=0,c=false,d=function(){a+=1;g.dispatchEvent("QUEUE_UPDATE",{progress:a,total:e.length});if(a===e.length){g.dispatchEvent("QUEUE_LOADED");document.body.className+=" resources-ready"}},f=function(){i.KIDS.storybook.error("Resource load error.")};g.addToQueue=function(j){if(b[j]===undefined){b[j]={image:new Image(),url:j,loaded:false};e.push(b[j])}return b[j]};g.loadQueue=function(){var j;if(!c){c=true;for(j in b){if(b.hasOwnProperty(j)){b[j].image.addEventListener("load",d)}}for(j in b){if(b.hasOwnProperty(j)){b[j].image.src=b[j].url}}}};g.getProgress=function(){return a};g.getTotal=function(){return e.length};return g};PBS.KIDS.storybook.book=function(Q,A,G,Z){var C=A.KIDS.storybook,Y=C.eventDispatcher(),n=C.resourceLoader(Q,A),m,ap=false,w=false,aq=false,x=false,s=0,M,ab,j,ag=Z.book,r,p,E,an,aa,u,ad,q,ac=false,W,f=[],v,S=Z.book.margin!==undefined?Z.book.margin:2,X=false,P=false,V=false,I,e,i,b,N,T,a,D,ae,o,l,z,g=function(){if(!aq){if(!ap){if(M===ab){if(M===-1){W.update()}else{if(f[r]){f[r].update()}if(f[p]){f[p].update()}}}}Q.requestAnimationFrame(g);if(!ap){R()}}},R=function(){if(M===-1){W.render()}else{if(f[r]){f[r].render()}if(f[p]){f[p].render()}}},U=function(ar){if(ar===f[p]||ar===W){Y.nextPage()}else{if(j==="SINGLE-PAGE"){Y.nextPage()}}},ai=function(ar){if(ar===f[r]){Y.previousPage()}else{if(j==="SINGLE-PAGE"){Y.previousPage()}}},t=function(){m.removeEventListener("PLAY_COMPLETE",t);if(f[p].pageSound){y();m.play(f[p].pageSound);m.addEventListener("PLAY_COMPLETE",ak)}else{k()}},ak=function(){m.removeEventListener("PLAY_COMPLETE",ak);k()},ah=function(){Q.document.body.style.height="200%";Q.scrollTo(0,1);Q.document.body.style.height=Q.innerHeight+"px"},al=function(ar){if(j==="SINGLE-PAGE"){if(M!==-1){ar*=1.8}}v=ar*(S/100);e.style.width=Q.parseInt(ar-v*2,10)+"px";i.style.width=Q.parseInt(ar-v*2,10)+"px";E=N.offsetWidth;an=E/ag.pageWidth*ag.pageHeight;e.style.margin=v+"px";e.style.height=Q.parseInt(an)+"px";i.style.height=Q.parseInt(an)+"px";ae.style.width=Q.parseInt(E,10)+1+"px";ae.style.height=Q.parseInt(an,10)+"px"},K=function(ar){v=ar*(S/100);i.style.height=(ar-v*2)+"px";e.style.height=(ar-v*2)+"px";an=N.offsetHeight;E=i.offsetHeight/ag.pageHeight*ag.pageWidth;if(M===-1){i.style.width=Q.parseInt(E,10)+"px";e.style.width=Q.parseInt(E,10)+"px"}else{i.style.width=Q.parseInt(E*2,10)+"px";e.style.width=Q.parseInt(E*2,10)+"px"}ae.style.width=Q.parseInt(E,10)+1+"px";ae.style.height=an+"px"},y=function(){i.className=i.className.replace(" loud","");i.className=i.className.replace(" silent","");i.className+=" loud"},k=function(){i.className=i.className.replace(" loud","");i.className=i.className.replace(" silent","");i.className+=" silent"},F=function(){var ar;ah();ar=(G.clientHeight>G.clientWidth)?"SINGLE-PAGE":"TWO-PAGE";if(j!==ar){Y.dispatchEvent("LAYOUT_CHANGE",ar);j=ar}al(G.offsetWidth);if(e.offsetHeight>G.offsetHeight*(1-(S/100)*2)){K(G.offsetHeight)}G.style.fontSize=(E/ag.pageWidth)+"px";B()},B=function(){var ar=G.offsetWidth;e.style.marginTop=(G.offsetHeight-e.offsetHeight)/2+"px";if(M===-1){e.style.transition="";e.style["-webkit-transition"]="";e.style["-moz-transition"]="";e.style["-ms-transition"]="";e.style["-o-transition"]="";e.style.marginLeft=(ar-i.offsetWidth)/2+"px";document.body.className=document.body.className.replace(" on-internal","");document.body.className=document.body.className.replace(" on-cover","");document.body.className+=" on-cover"}else{if(j==="SINGLE-PAGE"){e.style.transition="margin-left "+q/1000+"s linear";e.style["-webkit-transition"]="margin-left "+q/1000+"s linear";e.style["-moz-transition"]="margin-left "+q/1000+"s linear";e.style["-ms-transition"]="margin-left "+q/1000+"s linear";e.style["-o-transition"]="margin-left "+q/1000+"s linear";if(M%2){e.style.marginLeft=-(v+E*2-ar)+"px"}else{e.style.marginLeft=v+"px"}}else{e.className="";e.style.marginLeft=(ar-i.offsetWidth)/2+"px"}document.body.className=document.body.className.replace(" on-cover","");document.body.className=document.body.className.replace(" on-internal","");document.body.className+=" on-internal"}},O=function(){var ar=G.offsetWidth;e.style.marginTop=(G.offsetHeight-e.offsetHeight)/2+"px";if(M===-1){e.style.transition="";e.style["-webkit-transition"]="";e.style["-moz-transition"]="";e.style["-ms-transition"]="";e.style["-o-transition"]="";e.style.marginLeft=(ar-i.offsetWidth)/2+"px"}else{if(j==="SINGLE-PAGE"){e.style.transition="margin-left "+ad/1000+"s linear";e.style["-webkit-transition"]="margin-left "+ad/1000+"s linear";e.style["-moz-transition"]="margin-left "+ad/1000+"s linear";e.style["-ms-transition"]="margin-left "+ad/1000+"s linear";e.style["-o-transition"]="margin-left "+ad/1000+"s linear";if(ab%2){e.style.marginLeft=-(v+E*2-ar)+"px"}else{e.style.marginLeft=v+"px"}}else{e.className="";e.style.marginLeft=(ar-i.offsetWidth)/2+"px"}}},h=function(){if(ab!==M){if(ab>M){i.style.marginLeft="0";i.style.width="100%";b.style.display="block";N.style.width="50%";C.removeAllChildren(b);b.appendChild(f[r].getElement());C.removeAllChildren(N);N.appendChild(f[p].getElement())}else{C.removeAllChildren(N);if(ab===-1){i.style.marginLeft="0";i.style.width="50%";b.style.display="none";N.style.width="100%";N.appendChild(W.getElement())}else{N.appendChild(f[p].getElement())}}}C.removeAllChildren(ae);ae.style.display="none";M=ab;F();if(ab===-1){W.navigationToComplete();if(W.pageSound){m.play(W.pageSound)}}else{f[r].navigationToComplete();f[p].navigationToComplete();if(j==="SINGLE-PAGE"){if(r===M){if(f[r].pageSound){m.play(f[r].pageSound)}}else{if(f[p].pageSound){m.play(f[p].pageSound)}}}else{if(f[r].pageSound){y();m.play(f[r].pageSound);m.addEventListener("PLAY_COMPLETE",t)}else{if(f[p].pageSound){y();m.play(f[r].pageSound);m.addEventListener("PLAY_COMPLETE",ak)}}}}if(ab===-1){if(a){a.style.display="none"}if(D){D.style.display="block"}}else{if(j==="SINGLE-PAGE"){if(a){a.style.display=(ab===-1)?"none":"block"}if(D){D.style.display=(ab===f.length-1)?"none":"block";document.body.className=document.body.className.replace(" on-last-page","");if(ab===f.length-1){document.body.className+=" on-last-page"}}}else{if(a){a.style.display=(r===-1)?"none":"block"}if(D){D.style.display=(p===f.length-1)?"none":"block";document.body.className=document.body.className.replace(" on-last-page","");if(p===f.length-1){document.body.className+=" on-last-page"}}}}Y.dispatchEvent("PAGE_CHANGE");ac=false},H=function(){var ar,at;C.removeAllChildren(ae);if(ab>M){ar=Q.document.createElement("div");ar.className="pbsPageTurnPageContainer";ae.appendChild(ar);if(M===-1){ae.style.marginLeft=-E/2+"px"}else{ae.style.marginLeft="0"}ar.appendChild(f[r].getElement());at=Q.document.createElement("div");at.className="pbsLeftPageTurnGradient";ae.appendChild(at);ae.style.transformOrigin="right top";ae.style.webkitTransformOrigin="right top";ae.style.mozTransformOrigin="right top";ae.style.msTransformOrigin="right top";ae.style.oTransformOrigin="right top"}else{ar=Q.document.createElement("div");ar.className="pbsPageTurnPageContainer";ae.appendChild(ar);if(ab===-1){ae.style.marginLeft=E+"px";ar.appendChild(W.getElement());W.update();W.render()}else{ae.style.marginLeft=E+"px";ar.appendChild(f[p].getElement())}at=Q.document.createElement("div");at.className="pbsRightPageTurnGradient";ae.appendChild(at);ae.style.transformOrigin="left top";ae.style.webkitTransformOrigin="left top";ae.style.mozTransformOrigin="left top";ae.style.msTransformOrigin="left top";ae.style.oTransformOrigin="left top"}at.style.opacity=1;at.style.transition="opacity "+ad/2/1000+"s linear";at.style["-webkit-transition"]="opacity "+ad/2/1000+"s linear";at.style["-moz-transition"]="opacity "+ad/2/1000+"s linear";at.style["-ms-transition"]="opacity "+ad/2/1000+"s linear";at.style["-o-transition"]="opacity "+ad/2/1000+"s linear";Q.setTimeout(function(){at.style.opacity=0;ae.style.transform="scale(1, 1)";ae.style["-webkit-transform"]="scale(1, 1)";ae.style["-moz-transform"]="scale(1, 1)";ae.style["-ms-transform"]="scale(1, 1)";ae.style["-o-transform"]="scale(1, 1)"},0);Q.setTimeout(h,ad/2)},L=function(at,ar){var au=r,ax=p,aw,ay,av;if(ac){return}C.log("Navigate to page "+(at+1));if(au===undefined||ax===undefined||ad===0){ar=true}ab=at;if(m){m.stop()}C.removeAllChildren(ae);if(ab%2){r=ab-1;p=ab}else{r=ab;p=ab+1}if(a){a.style.display="none"}if(D){D.style.display="none"}if(ab===M){if(M===-1){N.appendChild(W.getElement())}else{C.removeAllChildren(b);b.appendChild(f[r].getElement());C.removeAllChildren(N);N.appendChild(f[p].getElement())}}else{if(ab>M){if(!ar){C.removeAllChildren(b);if(M!==-1){b.appendChild(f[au].getElement())}}C.removeAllChildren(N);N.appendChild(f[p].getElement())}else{C.removeAllChildren(b);if(ab!==-1){b.appendChild(f[r].getElement())}if(!ar){C.removeAllChildren(N);N.appendChild(f[ax].getElement())}}}if(f[r]){f[r].navigationToBegin()}if(f[p]){f[p].navigationToBegin()}if(ar){if(ab===-1){i.style.width="50%";b.style.display="none";N.style.width="100%"}else{b.style.display="block";N.style.display="block";b.style.width="50%";N.style.width="50%"}h()}else{if(ab>M){if(j==="TWO-PAGE"||M%2){aw=Q.document.createElement("div");aw.className="pbsPageTurnPageContainer";ae.appendChild(aw);if(M===-1){ae.style.marginLeft=E/2+"px";i.style.marginLeft=E/2+"px";i.style.width=E+"px";b.style.display="none";N.style.width=E+"px";aw.appendChild(W.getElement());C.removeAllChildren(b);b.appendChild(f[r].getElement());C.removeAllChildren(N);N.appendChild(f[p].getElement())}else{ae.style.marginLeft=E+"px";aw.appendChild(f[ax].getElement())}ay=Q.document.createElement("div");ay.className="pbsRightPageTurnGradient";ae.appendChild(ay);ay.style.opacity=0;ay.style.transition="opacity "+ad/2/1000+"s linear";ay.style["-webkit-transition"]="opacity "+ad/2/1000+"s linear";ay.style["-moz-transition"]="opacity "+ad/2/1000+"s linear";ay.style["-ms-transition"]="opacity "+ad/2/1000+"s linear";ay.style["-o-transition"]="opacity "+ad/2/1000+"s linear";ae.style.transformOrigin="left top";ae.style.webkitTransformOrigin="left top";ae.style.mozTransformOrigin="left top";ae.style.msTransformOrigin="left top";ae.style.oTransformOrigin="left top";Q.setTimeout(function(){ae.style.transform="scale(0, 1)";ae.style["-webkit-transform"]="scale(0, 1)";ae.style["-moz-transform"]="scale(0, 1)";ae.style["-ms-transform"]="scale(0, 1)";ae.style["-o-transform"]="scale(0, 1)";ay.style.opacity=1},0);ae.style.display="block";Q.setTimeout(O,500);ac=true;Q.setTimeout(H,ad/2)}else{h()}}else{if(j==="TWO-PAGE"||M%2===0){aw=Q.document.createElement("div");aw.className="pbsPageTurnPageContainer";ae.appendChild(aw);aw.appendChild(f[au].getElement());ae.style.marginLeft=0;if(ab===-1){i.style.marginLeft=E+"px";i.style.width=E+"px";b.style.display="none";N.style.width=E+"px"}ay=Q.document.createElement("div");ay.className="pbsLeftPageTurnGradient";ae.appendChild(ay);ay.style.opacity=0;ay.style.transition="opacity "+ad/2/1000+"s linear";ay.style["-webkit-transition"]="opacity "+ad/2/1000+"s linear";ay.style["-moz-transition"]="opacity "+ad/2/1000+"s linear";ay.style["-ms-transition"]="opacity "+ad/2/1000+"s linear";ay.style["-o-transition"]="opacity "+ad/2/1000+"s linear";ae.style.transformOrigin="right top";ae.style.webkitTransformOrigin="right top";ae.style.mozTransformOrigin="right top";ae.style.msTransformOrigin="right top";ae.style.oTransformOrigin="right top";Q.setTimeout(function(){ae.style.transform="scale(0, 1)";ae.style["-webkit-transform"]="scale(0, 1)";ae.style["-moz-transform"]="scale(0, 1)";ae.style["-ms-transform"]="scale(0, 1)";ae.style["-o-transform"]="scale(0, 1)";ay.style.opacity=1},0);ae.style.display="block";Q.setTimeout(O,500);ac=true;Q.setTimeout(H,ad/2)}else{h()}}}},J=function(){var ar;for(ar=0;ar<f.length;ar+=1){W.render();f[ar].render()}G.innerHTML="";G.appendChild(I);G.appendChild(T);Q.onorientationchange=Y.onOrientationChange;Q.addEventListener("resize",F);F();M=(ag.startOnPage!==undefined)?(ag.startOnPage-1):-1;document.body.className="book-loaded";Y.dispatchEvent("BOOK-LOADED");L(M,true);F();G.addEventListener("touchmove",function(at){at.preventDefault()});if(aa){aa.update();aa.render();aa.addEventListener("PRESS",Y.previousPage)}if(u){u.update();u.render();u.addEventListener("PRESS",Y.nextPage)}Y.dispatchEvent("STARTED");g()},ao=function(){var av,at,ar,au,aw;for(au in ag.pageBackground){if(ag.pageBackground.hasOwnProperty(au)){if(au==="url"){ag.pageBackground.resource=n.addToQueue(ag.pageBackground.url)}}}for(au in ag.oddPageBackground){if(ag.oddPageBackground.hasOwnProperty(au)){if(au==="url"){ag.oddPageBackground.resource=n.addToQueue(ag.oddPageBackground.url)}}}for(au in ag.evenPageBackground){if(ag.evenPageBackground.hasOwnProperty(au)){if(au==="url"){ag.evenPageBackground.resource=n.addToQueue(ag.evenPageBackground.url)}}}for(au in Z.cover.background){if(Z.cover.background.hasOwnProperty(au)){if(au==="url"){Z.cover.background.resource=n.addToQueue(Z.cover.background.url)}}}for(at=0;at<Z.cover.content.length;at+=1){for(au in Z.cover.content[at]){if(au==="url"){Z.cover.content[at].resource=n.addToQueue(Z.cover.content[at].url)}else{if(au==="content"){for(ar=0;ar<Z.cover.content[at].content.length;ar+=1){for(aw in Z.cover.content[at].content[ar]){if(aw==="url"){Z.cover.content[at].content[ar].resource=n.addToQueue(Z.cover.content[at].content[ar].url)}}}}}}}for(av=0;av<Z.pages.length;av+=1){for(au in Z.pages[av].background){if(Z.pages[av].background.hasOwnProperty(au)){if(au==="url"){Z.pages[av].background.resource=n.addToQueue(Z.pages[av].background.url)}}}for(at=0;at<Z.pages[av].content.length;at+=1){for(au in Z.pages[av].content[at]){if(au==="url"){Z.pages[av].content[at].resource=n.addToQueue(Z.pages[av].content[at].url)}else{if(au==="content"){for(ar=0;ar<Z.pages[av].content[at].content.length;ar+=1){for(aw in Z.pages[av].content[at].content[ar]){if(aw==="url"){Z.pages[av].content[at].content[ar].resource=n.addToQueue(Z.pages[av].content[at].content[ar].url)}}}}}}if(Z.pages[av].content[at].type.toUpperCase()==="DRAWINGPAD"){if(Z.pages[av].content[at].overlayUrl){Z.pages[av].content[at].overlayResource=n.addToQueue(Z.pages[av].content[at].overlayUrl)}if(Z.pages[av].content[at].textureUrl){Z.pages[av].content[at].textureResource=n.addToQueue(Z.pages[av].content[at].textureUrl)}for(au in Z.pages[av].content[at]){if(au==="colorButtons"){for(ar=0;ar<Z.pages[av].content[at].colorButtons.length;ar+=1){for(aw in Z.pages[av].content[at].colorButtons[ar]){if(aw==="url"){Z.pages[av].content[at].colorButtons[ar].resource=n.addToQueue(Z.pages[av].content[at].colorButtons[ar].url)}}}}else{if(au==="clearButtons"){for(ar=0;ar<Z.pages[av].content[at].clearButtons.length;ar+=1){for(aw in Z.pages[av].content[at].clearButtons[ar]){if(aw==="url"){Z.pages[av].content[at].clearButtons[ar].resource=n.addToQueue(Z.pages[av].content[at].clearButtons[ar].url)}}}}else{if(au==="eraserButtons"){for(ar=0;ar<Z.pages[av].content[at].eraserButtons.length;ar+=1){for(aw in Z.pages[av].content[at].eraserButtons[ar]){if(aw==="url"){Z.pages[av].content[at].eraserButtons[ar].resource=n.addToQueue(Z.pages[av].content[at].eraserButtons[ar].url)}}}}}}}}}}},d=function(ar){if(ar){z=ar}else{z={};z.progress=n.getProgress();z.total=n.getTotal()}if(m){if(X){if(P){o.innerHTML='<p id="loadingText">Loading '+(z.progress+1)+" of "+(z.total)+"</p>"}else{o.innerHTML='<p id="loadingText">Loading '+z.progress+" of "+(z.total+1)+"</p>"}}else{o.innerHTML='<p id="loadingText">Loading '+z.progress+" of "+(z.total+1)+"<br />Press to load sound.</p>"}}else{o.innerHTML='<p id="loadingText">Loading '+z.progress+" of "+z.total+"</p>"}},aj=function(){if(!P){G.removeEventListener("LOAD_STARTED",aj);P=true;if(V){J()}}},c=function(){V=true;Y.dispatchEvent("LOADED");if(!m||P===true){J()}},af=function(){G.removeEventListener("PRESS",af);m.addEventListener("LOAD_STARTED",aj);m.load();X=true;d()},am=function(){var ar,au,at;if(!x){x=true;I=Q.document.createElement("div");I.id="pbsBookWrapper";if(Z.background&&Z.background.color){I.style.backgroundColor=Z.background.color}if(Z.background&&Z.background.url){I.style.backgroundImage="url("+Z.background.url+")"}e=Q.document.createElement("div");e.id="pbsBookContainer";I.appendChild(e);i=Q.document.createElement("div");i.className="pbsPagesContainer";e.appendChild(i);b=Q.document.createElement("div");b.className="pbsPageContainer";b.id="pbsLeftPage";b.style.width="50%";i.appendChild(b);N=Q.document.createElement("div");N.className="pbsPageContainer";N.id="pbsRightPage";i.appendChild(N);ae=Q.document.createElement("div");ae.className="pbsPageTurnContainer";e.appendChild(ae);T=Q.document.createElement("nav");T.className="pbsStorybookNav";if(ag.previousPageButton){a=Q.document.createElement("div");a.id="pbsPrevPageButton";a.className="pbsPageButton";ag.previousPageButton.parentElement=a;ag.previousPageButton.resource=n.addToQueue(ag.previousPageButton.url);aa=C.sprite(Q,A,ag.previousPageButton);aa=C.makeInteractionObject(Q,A,aa);T.appendChild(a)}if(ag.nextPageButton){D=Q.document.createElement("div");D.id="pbsNextPageButton";D.className="pbsPageButton";ag.nextPageButton.parentElement=D;ag.nextPageButton.resource=n.addToQueue(ag.nextPageButton.url);u=C.sprite(Q,A,ag.nextPageButton);u=C.makeInteractionObject(Q,A,u);T.appendChild(D)}ao();ad=(ag&&ag.pageTurnDuration!==undefined)?ag.pageTurnDuration:1000;q=(ag&&ag.pageSlideDuration!==undefined)?ag.pageSlideDuration:250;ae.style.transition="transform "+ad/2/1000+"s linear";ae.style["-webkit-transition"]="-webkit-transform "+ad/2/1000+"s linear";ae.style["-moz-transition"]="-moz-transform "+ad/2/1000+"s linear";ae.style["-ms-transition"]="-ms-transform "+ad/2/1000+"s linear";ae.style["-o-transition"]="-o-transform "+ad/2/1000+"s linear";if(Z.audio&&Z.audio&&Z.audio.name&&Z.audio.enabled!==false){m=C.audioPlayer(Q,A,Z.audio.path+Z.audio.name)}W=C.page(Q,A,Z.cover,0,{bookConfig:ag,audioPlayer:m});W.addEventListener("DRAG_LEFT",U);W.addEventListener("DRAG_RIGHT",ai);for(ar=0;ar<Z.pages.length;ar+=1){f[ar]=C.page(Q,A,Z.pages[ar],ar+1,{bookConfig:ag,audioPlayer:m});f[ar].update();f[ar].render()}if(Z.pages.length%2){f[Z.pages.length]=C.page(Q,A,{},Z.pages.length+1,{bookConfig:ag,audioPlayer:m})}for(ar=0;ar<f.length;ar+=1){f[ar].addEventListener("DRAG_LEFT",U);f[ar].addEventListener("DRAG_RIGHT",ai)}F()}else{C.error("Cannot initialize storybook more than once.")}};Y.pause=function(){if(!ap){ap=true}};Y.unpause=function(){if(ap){ap=false}};Y.onOrientationChange=function(){F()};Y.getSprite=function(at,ar){return f[at].getSprite(ar)};Y.getDrawingPad=function(at,ar){return f[at].getDrawingPad(ar)};Y.destroy=function(){var ar;if(!aq){aq=true;G.innerHTML="";for(ar=0;ar<f.length;ar+=1){f[ar].destroy()}W.destroy();Y=null}};Y.nextPage=function(){var ar;if(j==="SINGLE-PAGE"){ar=M+1}else{if(M%2){ar=M+1}else{ar=M+2}}if(ar<f.length){L(ar)}if(document.body.id==="daniel-book-1"&&ar===12){book.getSprite(13,0).setCurFrame(1);book.getSprite(12,0).setCurFrame(0)}};Y.previousPage=function(){var ar;if(j==="SINGLE-PAGE"){ar=M-1}else{if(M%2){ar=M-2}else{ar=M-1}}if(ar>=-1){L(ar)}if(ar===-1){document.body.className+=" transitioning";document.body.className+=" to-cover"}if(document.body.id==="daniel-book-1"&&ar===13){book.getSprite(13,0).setCurFrame(1);book.getSprite(12,0).setCurFrame(0);console.log("hey mig")}};Y.gotoPage=function(ar){if(M-1<-1||M+1>f.length){return}L(ar)};Y.load=function(){if(!w){w=true;G.innerHTML="";o=Q.document.createElement("section");o.className="loadingContainer";G.appendChild(o);if(m){l=C.interactionObject(Q,A,o);l.addEventListener("PRESS",af)}n.addEventListener("QUEUE_UPDATE",d);n.addEventListener("QUEUE_LOADED",c);n.loadQueue();document.body.className="loading-screen"}};(function(){var at=0;var au=["ms","moz","webkit","o"];for(var ar=0;ar<au.length&&!window.requestAnimationFrame;ar+=1){window.requestAnimationFrame=window[au[ar]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[au[ar]+"CancelAnimationFrame"]||window[au[ar]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(az,aw){var av=new Date().getTime();var ax=Math.max(0,16-(av-at));var ay=window.setTimeout(function(){az(av+ax)},ax);at=av+ax;return ay}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(av){clearTimeout(av)}}}());am();return Y};PBS.KIDS.storybook.page=function(o,u,s,q,f){var b=u.KIDS.storybook,k=b.eventDispatcher(),m=f.bookConfig.pageWidth||768,l=f.bookConfig.pageHeight||1024,d=f.audioPlayer,c,n,e,r=[],a=[],g=[],j=[],h=[],i=true,p,t=function(){numResourcesLoaded+=1;if(numResourcesLoaded===totalResources&&!loaded){loaded=true;k.dispatchEvent("LOAD_COMPLETE")}};k.pageSound;k.init=function(){var w,y,A,x,B,v,z;if(s===undefined){b.error("Configuration missing for page "+q);return}if(q===undefined){b.error("Missing page number parameter");return}e=o.document.createElement("section");e.id="pbsPage"+q;e.className="pbsPage";p=b.interactionObject(o,u,e);p.addEventListener("DRAG",function(C){if(C.distanceX>m/20){p.cancelInteraction();if(C.x>C.startX){k.dispatchEvent("DRAG_RIGHT",k)}else{k.dispatchEvent("DRAG_LEFT",k)}}});if(s.background===undefined){s.background={}}s.background.parentElement=e;s.background.className="pbsPageCanvas";if(s.background.resource||s.background.color){}else{if(f.bookConfig.oddPageBackground&&q%2&&f.bookConfig.oddPageBackground.resource){s.background.resource=f.bookConfig.oddPageBackground.resource}else{if(f.bookConfig.oddPageBackground&&q%2&&f.bookConfig.oddPageBackground.color){s.background.color=f.bookConfig.oddPageBackground.color}else{if(f.bookConfig.evenPageBackground&&q%2===0&&f.bookConfig.evenPageBackground.resource){s.background.resource=f.bookConfig.evenPageBackground.resource}else{if(f.bookConfig.evenPageBackground&&q%2===0&&f.bookConfig.evenPageBackground.color){s.background.color=f.bookConfig.evenPageBackground.color}else{if(f.bookConfig.pageBackground&&f.bookConfig.pageBackground.resource){s.background.resource=f.bookConfig.pageBackground.resource}else{if(f.bookConfig.pageBackground&&f.bookConfig.pageBackground.color){s.background.color=f.bookConfig.pageBackground.color}}}}}}}c=b.sprite(o,u,s.background);c.addEventListener("LOAD_COMPLETE",t);c=b.makeInteractionObject(o,u,c);z=(s&&s.sound&&s.sound.persist!==undefined)?s.sound.persist:true;if(d&&s&&s.sound){k.pageSound=b.sound(s.sound.startTime,s.sound.endTime,{loop:s.sound.loop,persist:z})}if(s&&s.content){for(y=0;y<s.content.length;y+=1){switch(s.content[y].type){case"TextArea":s.content[y].parentElement=e;s.content[y].parentWidth=m;s.content[y].parentHeight=l;s.content[y].className="pbsPage"+q+"TextArea"+(r.length+1);A=b.textArea(o,u,s.content[y]);if(s.content[y].sound){A=b.makeInteractionObject(o,u,A);A=b.makeAudible(o,u,d,A,s.content[y].sound)}r.push(A);h.push(A);break;case"Sprite":s.content[y].parentElement=e;s.content[y].parentWidth=m;s.content[y].parentHeight=l;s.content[y].className="pbsPage"+q+"Sprite"+(a.length+1);x=b.sprite(o,u,s.content[y]);x=b.makeInteractionObject(o,u,x);if(s.content[y].sound){x=b.makeAudible(o,u,d,x,s.content[y].sound)}a.push(x);h.push(x);if(s.content[y].playAfterDelay>0){x.playAfterDelay=s.content[y].playAfterDelay}break;case"Cycler":s.content[y].parentElement=e;s.content[y].parentWidth=m;s.content[y].parentHeight=l;s.content[y].className="pbsPage"+q+"Cycler"+(g.length+1);B=b.cycler(o,u,s.content[y]);if(s.content[y].sound){B=b.makeAudible(o,u,d,B,s.content[y].sound)}h.push(B);g.push(B);if(s.content[y].playAfterDelay>0){B.playAfterDelay=s.content[y].playAfterDelay}break;case"DrawingPad":s.content[y].parentElement=e;s.content[y].parentWidth=m;s.content[y].parentHeight=l;s.content[y].className="pbsPage"+q+"DrawingPad"+(g.length+1);v=b.drawingPad(o,u,s.content[y]);v=b.makeInteractionObject(o,u,v);if(s.content[y].sound){v=b.makeAudible(o,u,d,v,s.content[y].sound)}j.push(v);h.push(v);break;default:b.error("Object Type Unknown: "+s.content[y].type);break}}}};k.getElement=function(){return e};k.navigationToBegin=function(){var v;document.body.className=document.body.className.replace(" transitioning","");document.body.className+=" transitioning";for(v=0;v<g.length;v+=1){g[v].reset()}};k.navigationToComplete=function(){var v;document.body.className=document.body.className.replace(" transitioning","");document.body.className=document.body.className.replace(" to-cover","");if(c){c.play()}for(v=0;v<a.length;v+=1){if(a[v].autoStart===true){a[v].play()}else{a[v].reset()}if(a[v].playAfterDelay>0){o.setTimeout(a[v].play,o.parseInt(a[v].playAfterDelay,10)*1000)}}for(v=0;v<g.length;v+=1){if(g[v].autoStart===true){g[v].play()}else{g[v].reset()}if(g[v].playAfterDelay>0){o.setTimeout(g[v].play,o.parseInt(g[v].playAfterDelay,10)*1000)}}};k.destroy=function(){var v;if(c){c.destroy()}for(v=0;v<h.length;v+=1){h[v].destroy()}k=null};k.update=function(){var v;if(c){c.update()}for(v=0;v<h.length;v+=1){h[v].update()}};k.render=function(){var v;if(c){c.render()}for(v=0;v<h.length;v+=1){h[v].render()}};k.getSprite=function(v){return a[v]};k.getDrawingPad=function(v){return j[v]};k.quiet=function(){e.className=e.className.replace(" loud","");e.className=e.className.replace(" quiet","");e.className+=" quiet"};k.loud=function(){e.className=e.className.replace(" loud","");e.className=e.className.replace(" quiet","");e.className+=" loud"};k.init();return k};PBS.KIDS.storybook.textArea=function(i,j,n){var e,d,c=false,l=n&&n.parentElement,f=[],k=[],b=true,h,g=function(t,o,u,s){var q,p,r;p="<"+o;if(s){p+="(.*?)"}p+=">(.*?)</"+o+">";q=new RegExp(p,"gi");if(s){r="["+u+"$1]$2[/"+u+"]"}else{r="["+u+"]$1[/"+u+"]"}return t.replace(q,r)},a=function(p){var o;o=i.document.createElement("div");o.innerHTML=p;return o.textContent||o.innerText||""},m=function(){var o;if(!c){c=true;e.initView();d.className="pbsTextArea";if(n.className){d.className+=" "+n.className}d.style.textAlign=(n.align!==undefined)?n.align:"center";d.style.fontFamily=(n.font!==undefined)?n.font:"";d.style.fontSize=(n.size!==undefined)?n.size+"em":"1em";d.style.lineHeight="120%";if(n.color!==undefined){d.style.color=n.color}for(o=0;o<h.length;o+=1){f[o]=h[o];if(n.cleanTags!=="false"){f[o]=g(f[o],"b","bold");f[o]=g(f[o],"i","italic");f[o]=g(f[o],"em","emphasis");f[o]=g(f[o],"color","color",true);f[o]=g(f[o],"size","size",true);f[o]=g(f[o],"font","font",true);f[o]=a(f[o])}f[o]=f[o].replace(/\[bold\](.*?)\[\/bold\]/gi,"<b>$1</b>");f[o]=f[o].replace(/\[italic\](.*?)\[\/italic\]/gi,"<i>$1</i>");f[o]=f[o].replace(/\[emphasis\](.*?)\[\/emphasis\]/gi,"<em>$1</em>");f[o]=f[o].replace(/\[color=(.*?)\](.*)\[\/color\]/gi,'<span style="color:$1">$2</span>');f[o]=f[o].replace(/\[size=(.*?)\](.*?)\[\/size\]/gi,'<span style="font-size:$1em">$2</span>');f[o]=f[o].replace(/\[font=(.*?)\](.*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>');if(h.length===1){d.innerHTML=f[o]}else{k[o]=i.document.createElement("p");if(e.paragraphSpacing!==null){k[o].style.marginBottom=(e.paragraphSpacing.toString().toUpperCase().indexOf("PX")!==-1)?e.paragraphSpacing:e.paragraphSpacing+"%"}d.appendChild(k[o]);k[o].innerHTML=f[o]}}e.addEventListener("PRESS",e.press)}};if(typeof n.text==="string"){h=[n.text]}else{h=n.text}d=(h.length===1)?i.document.createElement("p"):i.document.createElement("div");e=j.KIDS.storybook.view(j,d);if(l){l.appendChild(d)}e.x=n&&(n.x!==undefined)?n.x:0;e.y=n&&(n.y!==undefined)?n.y:0;e.width=n&&(n.width!==undefined)?n.width:100;e.horizontalAlign=(n&&n.horizontalAlign!==undefined)?n.horizontalAlign.toUpperCase():"LEFT";e.verticalAlign=(n&&n.verticalAlign!==undefined)?n.verticalAlign.toUpperCase():"TOP";e.parentWidth=n.parentWidth;e.parentHeight=n.parentHeight;e.paragraphSpacing=(n.paragraphSpacing!==undefined)?n.paragraphSpacing:null;e.update=function(){};e.render=function(){if(e.dirty){e.dirty=false}};e.press=function(o){console.log("PRESS")};m();return e};PBS.KIDS.storybook.view=function(a,b){var c=a.KIDS.storybook.eventDispatcher(),d=a.KIDS.storybook,b;c.parentWidth;c.parentHeight;c.x;c.y;c.width;c.height;c.horizontalAlign;c.verticalAlign;c.dirty=false;c.getElement=function(){return b};c.initView=function(){if(c.horizontalAlign==="RIGHT"){if(d.isInPixelUnits(c.x)){if(c.parentWidth){b.style.right=(d.getNumberFromString(c.x)/c.parentWidth)*100+"%"}else{b.style.right=c.x}}else{b.style.right=d.getNumberFromString(c.x)+"%"}}else{if(d.isInPixelUnits(c.x)){if(c.parentWidth){b.style.left=(d.getNumberFromString(c.x)/c.parentWidth)*100+"%"}else{b.style.left=c.x}}else{b.style.left=d.getNumberFromString(c.x)+"%"}}if(c.verticalAlign==="BOTTOM"){if(d.isInPixelUnits(c.y)){if(c.parentHeight){b.style.bottom=(d.getNumberFromString(c.y)/c.parentHeight)*100+"%"}else{b.style.bottom=c.y}}else{b.style.bottom=d.getNumberFromString(c.y)+"%"}}else{if(d.isInPixelUnits(c.y)){if(c.parentHeight){b.style.top=(d.getNumberFromString(c.y)/c.parentHeight)*100+"%"}else{b.style.top=c.y}}else{b.style.top=d.getNumberFromString(c.y)+"%"}}if(c.width){if(d.isInPixelUnits(c.width)){if(c.parentWidth){b.style.width=(d.getNumberFromString(c.width)/c.parentWidth)*100+"%"}else{b.style.width=c.width}}else{b.style.width=d.getNumberFromString(c.width)+"%"}}if(c.height){if(d.isInPixelUnits(c.height)){if(c.parentHeight){b.style.height=(d.getNumberFromString(c.height)/c.parentHeight)*100+"%"}else{b.style.height=c.height}}else{b.style.height=d.getNumberFromString(c.height)+"%"}}};c.destroy=function(){b=null;c.removeAllEventListeners();c=null};return c};PBS.KIDS.storybook.sprite=function(u,A,e){var k,c,b=(e&&e.resource!==undefined)?e.resource:undefined,s,m=false,g=false,j={},n=0,r=0,f=0,x=0,v,l,a=e.frameDelay||1,z=e.loop,i=e&&e.parentElement,y=false,p=1,o=1,h=e.color,t=e.numFrames,w=function(){if(!g){g=true;k.initView();if(b&&b.image){k.width=b.image.width;k.height=b.image.height}else{k.width=100;k.height=100}v=t?(k.width/t):k.width;l=k.height;c.width=v;c.height=l;if(e.width){if(e.width.toString().indexOf("px")!==-1){c.style.width=e.width}else{c.style.width=e.width+"%"}}else{if(k.parentWidth){p=(c.width/k.parentWidth);c.style.width=(p*100)+"%"}}if(e.height){if(e.height.toString().indexOf("px")!==-1){c.style.height=e.height}else{c.style.height=e.height+"%"}}else{if(k.parentHeight){o=(c.height/k.parentHeight);c.style.height=(o*100)+"%"}}k.addEventListener("PRESS",k.press);if(k.autoStart===false){y=true}k.dirty=true}},q=function(){w()},d=function(C,B,D){var E;if(e.easing&&e.easing.toUpperCase()==="EASEIN"){E=D*(1-u.Math.cos(C/B*u.Math.PI/2))}else{if(e.easing&&e.easing.toUpperCase()==="EASEOUT"){E=D*(u.Math.sin(C/B*u.Math.PI/2))}else{E=D*C/B}}return u.Math.floor(E)};j.width=99+"px";j.height=99+"px";j.className="pbsCanvas pbsSprite";if(e&&e.className){j.className+=" "+e.className}s=A.KIDS.storybook.createCanvas(i,j);k=A.KIDS.storybook.view(A,s.canvas);c=k.getElement();k.x=e&&(e.x!==undefined)?e.x:0;k.y=e&&(e.y!==undefined)?e.y:0;k.width=e&&(e.width!==undefined)?e.width:0;k.height=e&&(e.height!==undefined)?e.height:0;k.parentWidth=e.parentWidth;k.parentHeight=e.parentHeight;k.horizontalAlign=(e&&e.horizontalAlign!==undefined)?e.horizontalAlign.toUpperCase():"LEFT",k.verticalAlign=(e&&e.verticalAlign!==undefined)?e.verticalAlign.toUpperCase():"TOP",k.visible=true;k.alpha;k.destroyed=false;k.url=e&&e.url;k.autoStart=e&&(e.autoStart!==undefined)?e.autoStart:true;k.autoReset=e&&(e.autoReset!==undefined)?e.autoReset:false;k.resetDelay=e&&e.resetDelay?e.resetDelay*60:0;k.update=function(){if(t&&!y){if(f+1>=t*a){if(z){r=0;x=0;f=0}else{if(k.autoReset){if(k.resetDelay&&x<k.resetDelay){x+=1}else{r=0;x=0;f=0;k.stop()}}}if(k.autoReset===false){k.stop()}}else{f+=1;r=d(f,t*a,t)}if(n!==r){k.dirty=true;n=r}}};k.render=function(){var C,B;if(g){if(k.dirty){if(k.visible){C=s.globalAlpha;s.globalAlpha=k.alpha;if(h){s.fillStyle=h;s.fillRect(0,0,v,l)}if(b&&b.image){if(t){s.canvas.width=s.canvas.width;s.drawImage(b.image,u.Math.floor(r*v),0,v,l,0,0,v,l)}else{s.drawImage(b.image,0,0,v,l)}s.globalAlpha=C}}else{s.clearRect(0,0,v,l)}k.dirty=false}}};k.getElement=function(){return c};k.getCurFrame=function(){return r};k.setCurFrame=function(B){return r=B,x=B,f=B,k.dirty=true};k.play=function(){k.reset();y=false};k.isAnimation=function(){return(t>1)};k.resume=function(){y=false;k.dirty=true};k.stop=function(){y=true;k.dispatchEvent("ANIMATION-COMPLETE")};k.reset=function(){if(r!==0){r=0;x=0;f=0;k.dirty=true;k.stop()}};k.press=function(){if(e.playOnPress){k.play()}else{if(e.stopOnPress){k.stop()}else{if(e.toggleOnPress){if(y){k.resume()}else{k.stop()}}else{if(e.customHatPress){if(r==0){r=1;x=1;f=1;k.dirty=true;k.dispatchEvent("ANIMATION-COMPLETE")}else{}}}}}};if(b&&b.image){b.image.addEventListener("load",q)}else{q()}return k};PBS.KIDS.storybook.cycler=function(g,h,k){var e=h.KIDS.storybook.eventDispatcher(),b=false,a=[],f=false,j=0,i=function(){var m,n,l;if(!b){b=true;if(k&&k.content){for(m=0;m<k.content.length;m+=1){l=k.content[m];l.parentElement=k.parentElement;l.parentWidth=k.parentWidth;l.parentHeight=k.parentHeight;if(k.className){l.className=k.className+"Sprite"+(m+1)}n=h.KIDS.storybook.sprite(g,h,l);n=h.KIDS.storybook.makeInteractionObject(g,h,n);n.addEventListener("PRESS",function(o){e.dispatchEvent("PRESS",{x:o.x,y:o.y});if(f||!a[0].isAnimation()||e.autoStart){e.cycle()}d();c();f=true});a.push(n)}}else{h.KIDS.storybook.error("Cycler missing content array.")}}},c=function(){var l;for(l=0;l<a.length;l+=1){a[l].visible=(l===j);a[l].dirty=true;a[l].render()}},d=function(){var l;for(l=0;l<a.length;l+=1){if(l===j){a[l].play()}else{a[l].reset()}}};e.x=k&&(k.x!==undefined)?k.x:0;e.y=k&&(k.y!==undefined)?k.y:0;e.width=k&&(k.width!==undefined)?k.width:0;e.height=k&&(k.height!==undefined)?k.height:0;e.autoStart=k&&(k.autoStart!==undefined)?k.autoStart:true;e.autoReset=k&&(k.autoReset!==undefined)?k.autoReset:false;e.cycle=function(){var l;if(j<a.length-1){j+=1}else{j=0}d();c()};e.play=function(){a[j].play()};e.resume=function(){a[j].resume()};e.stop=function(){a[j].stop()};e.reset=function(){f=false;j=0;a[j].reset();c()};e.update=function(){a[j].update()};e.render=function(){a[j].render()};e.destroy=function(){var l;for(l=0;l<a.length;l+=1){a[l].destroy()}a=null;e=null};i();return e};PBS.KIDS.storybook.drawingPad=function(k,l,q){var g,i=l.KIDS.storybook,d,c=false,n=q&&q.parentElement,b,j=[],h=[],m=[],f=function(){g.dirty=true},a=function(r){b.setTool("MARKER");b.setColor(r)},p=function(){b.clear()},e=function(){b.setTool("ERASER")},o=function(){var t,v,r,s,u;if(!c){c=true;g.initView();d.className="pbsDrawingPad";if(q.className){d.className+=" "+q.className}if(i.isInPixelUnits(g.width)){v=i.getNumberFromString(g.width)}else{if(i.isInPercentageUnits(g.width)){v=i.getNumberFromString(g.width)*g.parentWidth/100}else{v=g.width*g.parentWidth/100}}if(i.isInPixelUnits(g.height)){r=i.getNumberFromString(g.height)}else{if(i.isInPercentageUnits(g.height)){r=i.getNumberFromString(g.height)*g.parentHeight/100}else{r=g.height*g.parentHeight/100}}b=WM.drawingCanvas(d,{width:v,height:r,defaultColor:q.defaultColor,radius:q.radius,overlayUrl:q.overlayUrl,textureUrl:q.textureUrl});for(s in q){if(s==="colorButtons"){for(t=0;t<q.colorButtons.length;t+=1){for(u in q.colorButtons[t]){if(u==="url"){if(t===0){a(q.colorButtons[t].paintColor)}q.colorButtons[t].parentElement=n;q.colorButtons[t].parentWidth=g.parentWidth;q.colorButtons[t].parentHeight=g.parentHeight;if(q.className){q.colorButtons[t].className=q.className+"ColorButton"+(t+1)}q.colorButtons[t].resource.image.addEventListener("load",f);j.push(i.sprite(k,l,q.colorButtons[t]));j[j.length-1]=i.makeInteractionObject(k,l,j[j.length-1]);j[j.length-1].addEventListener("PRESS",(function(w){return function(){a(w)}}(q.colorButtons[t].paintColor)))}}}}else{if(s==="clearButtons"){for(t=0;t<q.clearButtons.length;t+=1){for(u in q.clearButtons[t]){if(u==="url"){q.clearButtons[t].parentElement=n;q.clearButtons[t].parentWidth=g.parentWidth;q.clearButtons[t].parentHeight=g.parentHeight;if(q.className){q.clearButtons[t].className=q.className+"ClearButton"+(t+1)}q.clearButtons[t].resource.image.addEventListener("load",f);h.push(i.sprite(k,l,q.clearButtons[t]));h[h.length-1]=i.makeInteractionObject(k,l,h[h.length-1]);h[h.length-1].addEventListener("PRESS",p)}}}}else{if(s==="eraserButtons"){for(t=0;t<q.eraserButtons.length;t+=1){for(u in q.eraserButtons[t]){if(u==="url"){q.eraserButtons[t].parentElement=n;q.eraserButtons[t].parentWidth=g.parentWidth;q.eraserButtons[t].parentHeight=g.parentHeight;if(q.className){q.eraserButtons[t].className=q.className+"EraserButton"+(t+1)}q.eraserButtons[t].resource.image.addEventListener("load",f);m.push(i.sprite(k,l,q.eraserButtons[t]));m[m.length-1]=i.makeInteractionObject(k,l,m[m.length-1]);m[m.length-1].addEventListener("PRESS",e)}}}}}}}}};d=k.document.createElement("div");g=l.KIDS.storybook.view(l,d);if(n){n.appendChild(d)}g.x=q&&(q.x!==undefined)?q.x:0;g.y=q&&(q.y!==undefined)?q.y:0;g.width=q&&(q.width!==undefined)?q.width:100-g.x+"%";g.height=q&&(q.height!==undefined)?q.height:100-g.y+"%";g.dirty=true;g.parentWidth=q&&(q.parentWidth!==undefined)?q.parentWidth:100;g.parentHeight=q&&(q.parentHeight!==undefined)?q.parentHeight:100;g.update=function(){};g.clearPad=function(){p()};g.render=function(){var r;if(g.dirty){g.dirty=false;for(r=0;r<j.length;r+=1){j[r].render()}for(r=0;r<m.length;r+=1){m[r].render()}for(r=0;r<h.length;r+=1){h[r].render()}}};o();return g};PBS.KIDS.storybook.audioPlayer=function(u,A,i,b){var k=A.KIDS.storybook.eventDispatcher(),c=false,z=false,s=false,e=false,g=0,p,f=null,n,t,o=function(){},y=function(){},w=function(){if(!e){e=true;k.dispatchEvent("LOAD_STARTED")}},d=function(){if(!e){e=true;k.dispatchEvent("LOAD_STARTED")}},m=function(){},q=function(){},a=function(){},x=function(){},r=function(){},h=function(C){A.KIDS.storybook.debug("audioPlayer.onError: "+C.message)},v=function(){if(!c){c=true;p=u.document.createElement("audio");p.addEventListener("pause",y);p.addEventListener("play",o);p.addEventListener("canplay",w);p.addEventListener("canplaythrough",d);p.addEventListener("loadeddata",m);p.addEventListener("loadedmetadata",q);p.addEventListener("progress",a);p.addEventListener("ended",x);p.addEventListener("stalled",r);p.addEventListener("error",h);if(p.canPlayType("audio/mpeg")){i+=".mp3"}else{if(p.canPlayType("audio/ogg")){i+=".ogg"}else{return false}}return true}},l=function(){n=u.setInterval(function(){var D,C;if(!p.buffered.length){return}D=p.buffered.end(p.buffered.length-1);C=D/p.duration*100;if(D&&!isNaN(C)&&g!==C){g=C;k.dispatchEvent("LOAD_PERCENTAGE_CHANGE")}if(u.Math.abs(D-p.duration)<0.1){u.clearInterval(n);k.dispatchEvent("LOAD_COMPLETE")}},1000);p.src=i;p.play();p.pause()},j=function(){u.clearInterval(t);t=null;f=null;p.pause()},B=function(){if(!f){u.clearInterval(t);return}if(p.currentTime>=f.endTime){if(f.loop===true){A.KIDS.storybook.log("Loop Sound");p.currentTime=f.startTime}else{j()}k.dispatchEvent("PLAY_COMPLETE")}};k.autoStart=b&&(b.autoStart!==undefined)?b.autoStart:true;k.autoReset=b&&(b.autoReset!==undefined)?b.autoReset:false;k.play=function(C){if(!C){A.KIDS.storybook.warning("Trying to play invalid sound.");return}if(C.startTime===undefined||C.startTime<0){A.KIDS.storybook.warning("Trying to play sound with invalid sound property. Start time invalid.");return}if(C.endTime===undefined||C.endTime<0){A.KIDS.storybook.warning("Trying to play sound with invalid sound property. End time invalid.");return}if(C.startTime>=C.endTime){A.KIDS.storybook.warning("Trying to play sound with invalid sound property. Duration is zero or negative.");return}if(f&&f.persist){return}f=C;p.currentTime=f.startTime;A.KIDS.storybook.log("Play Sound: "+f.startTime+" -> "+f.endTime+" (loop: "+f.loop+", audioElement.currentTime: "+p.currentTime);p.play();if(!t){t=u.setInterval(B,100)}};k.stop=function(){j()};k.load=function(){if(!z){z=true;l()}},k.destroy=function(){p=null};k.getElement=function(){return p};k.getLoadPercentage=function(){return g};k.getSound=function(){return f};if(v()){return k}else{return false}};PBS.KIDS.storybook.sound=function(c,a,b){var d={};d.loop=(b&&b.loop)?b.loop:false;d.name=(b&&b.name)?b.name:null;d.persist=(b&&b.persist)?b.persist:false;d.startTime=c;d.endTime=a;return d};PBS.KIDS.storybook.makeAudible=function(d,c,a,b,g){var h=c.KIDS.storybook,e=false,f=function(i){a.play(g)};b.silent=function(){a.stop()};b.addEventListener("PRESS",f);return b};