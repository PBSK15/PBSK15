!function(){var a=include("springroll.SoundGame"),b=springroll.ListTask,c=function(b){Object.merge(b,{name:"ColoringTool",captionsPath:null}),a.call(this,b),this.onAtlasLoaded=this.onAtlasLoaded.bind(this),this.once("configLoaded",e.bind(this)),this.once("soundReady",g.bind(this)),this.panel=null,this.display.visible=!1},d=c.prototype=Object.create(a.prototype),e=function(a,c){var d=a.manifests;c.addTask(new b("task",d.game,f)),c.addTask(new b("stickerSource",d.stickerSource,this.onAtlasLoaded)),c.addTask(new b("stickerPaper",d.stickerPaper,this.onAtlasLoaded))},f=function(a){window.images||(window.images={});for(var b in a)images[b]=a[b].content};d.onAtlasLoaded=function(a,b){this[b.id]=new createjs.TextureAtlas(a.image.content,a.data.content)};var g=function(){this.panel=new dt.ColoringPanel,this.display.stage.addChild(this.panel),this.display.visible=!0,this.display.enabled=!0,this.options.mute&&springroll.Sound.instance.setMuteAll(!0)};namespace("dt").ColoringTool=c}(),function(){function a(a,b){var c,e=images[a],g=e.height/b,h=e.width;switch(b){case 2:c={},c.image=e,c.priority=["disabled","down","over","up"],c.disabled=c.over=c.up={src:new f(0,0,h,g)},c.down={src:new f(0,g,h,g)};break;case 3:c=e;break;case 4:c={},c.image=e,c.priority=["disabled","down","selected","over","up"],c.disabled=c.up={src:new f(0,0,h,g)},c.over={src:new f(0,g,h,g)},c.down={src:new f(0,2*g,h,g)},c.selected={src:new f(0,3*g,h,g)}}return new d(c)}function b(a,b){var c=b.getFrame(a+"Up"),e=b.getFrame(a+"Down");imageSettings={},imageSettings.image=c.image,imageSettings.priority=["disabled","down","over","up"];var g=c.offset;return imageSettings.disabled=imageSettings.over=imageSettings.up={src:c.frame,trim:new f(g.x,g.y,c.width,c.height)},g=e.offset,imageSettings.down={src:e.frame,trim:new f(g.x,g.y,e.width,e.height)},new d(imageSettings)}var c=include("springroll.createjs.Button"),d=springroll.createjs.SoundButton,e=createjs.Container,f=createjs.Rectangle,g=springroll.Animator,h=springroll.Sound,i=springroll.Positioner,j=function(){e.call(this),this.onButton=this.onButton.bind(this),this.onStickerPress=this.onStickerPress.bind(this),this.onPaperAnimDone=this.onPaperAnimDone.bind(this),this.game=springroll.Application.instance,this.config=this.game.config,this.buttons=[],this.stickers=[],this.dragManager=new springroll.createjs.DragManager(this.game.display.stage,this.onDragStart.bind(this),this.onDragEnd.bind(this)),this.dragManager.multitouch=!0,this.setup(),this.scaling=new springroll.UIScaler(this,this.config.designedSettings,this.config.scaling,!1),this.scaling.addBackground(this.background),this.scaling.enabled=!0},k=j.prototype=Object.create(e.prototype);k.setup=function(){this.background=new createjs.Bitmap(images.background),this.addChild(this.background),this.drawingCanvas=new dt.DrawingCanvas,this.addChild(this.drawingCanvas),this.drawingCanvas.stroke=this.config.gameplay.strokeWidth,this.paperFold=new createjs.Bitmap(images.paperfold),this.addChild(this.paperFold);var d,f,g=this.config.gameplay.paint;for(d in g){var h=this[d]=a(g[d].buttonArt,4);this.addChild(h),h.paintMode=g[d].color,this.buttons.push(h),h.overAlias=null,h.clickAlias="PaintClick"}this.eraser=a("eraser",4),this.addChild(this.eraser),this.eraser.paintMode="erase",this.eraser.overAlias=null,this.eraser.clickAlias="EraserClick",this.buttons.push(this.eraser),this.trash=a("trash",2),this.addChild(this.trash),this.trash.paintMode="trash",this.trash.overAlias=null,this.trash.clickAlias=null,this.buttons.push(this.trash),this.paperAnim=new lib.PaperAnim,this.paperAnim.framerate=30,this.addChild(this.paperAnim),this.paperAnim.stop(),this.paperAnim.visible=!1,this.crumpleCanvas=document.createElement("canvas"),this.crumpleCanvas.width=this.drawingCanvas.localRect.width,this.crumpleCanvas.height=this.drawingCanvas.localRect.height,this.crumpleBitmap=new createjs.Bitmap(this.crumpleCanvas),this.paperAnim.paper.removeAllChildren(),this.paperAnim.paper.addChild(this.crumpleBitmap),this.stickerContainer=new e,this.addChild(this.stickerContainer);var j=this.config.gameplay.stickers;for(d in j){var k=b(d,this.game.stickerSource);this.stickerContainer.addChild(k),k.sticker=d,i.initItem(k,j[d]),k.overAlias=null,k.clickAlias=null,this.stickers.push(k)}for(f=0;f<this.buttons.length;++f)this.buttons[f].addEventListener(c.BUTTON_PRESS,this.onButton);for(f=0;f<this.stickers.length;++f)this.stickers[f].addEventListener("mousedown",this.onStickerPress)},k.deselectButtons=function(){for(var a=0;a<this.buttons.length;++a)this.buttons[a].selected=!1;this.drawingCanvas.drawingMode=null},k.onButton=function(a){var b=a.target;if(this.deselectButtons(),"trash"==b.paintMode){var c=this.crumpleCanvas.getContext("2d");c.clearRect(0,0,this.crumpleCanvas.width,this.crumpleCanvas.height),this.drawingCanvas.drawToCanvas(this.crumpleCanvas),this.paperAnim.visible=!0,g.play(this.paperAnim,"anim",{onComplete:this.onPaperAnimDone,soundData:"TrashClear"}),this.drawingCanvas.clear()}else this.drawingCanvas.drawingMode=b.paintMode,b.selected=!0},k.onPaperAnimDone=function(){this.paperAnim.visible=!1},k.onStickerPress=function(a){this.deselectButtons();var b=a.target,c=this.game.stickerSource.getFrame(b.sticker+"Up"),d=this.game.stickerPaper.getFrame(b.sticker+"Fill"),g=new e;g.addChild(createjs.BitmapUtils.bitmapFromTexture(d,1)),d=this.game.stickerPaper.getFrame(b.sticker+"Paper"),g.addChild(createjs.BitmapUtils.bitmapFromTexture(d,1)),this.stickerContainer.addChild(g),g.x=b.x+.5*c.width-.5*d.width+d.offset.x,g.y=b.y+.5*c.height-.5*d.height+d.offset.y,g.sticker=b.sticker;var h=new f,i=this.drawingCanvas.localRect;h.x=i.x,h.y=i.y,h.width=i.width,h.height=i.height-d.height,this.dragManager.addObject(g,h),g.enableDrag(),g.visible=!1,this.dragManager.startDrag(g,a)},k.onDragStart=function(a){h.instance.play("StickerPlacement"),a.visible=!0;for(var b=0;b<this.stickers.length;++b)this.stickers[b].sticker==this.draggingStickerId&&this.stickers[b]._onMouseUp()},k.onDragEnd=function(a){var b=a.x+.5*a.getChildAt(0).nominalBounds.width;if(b<this.config.gameplay.stickerSourceEdge){h.instance.play("StickerPlacement");var c=this.game.stickerPaper,d=c.getFrame(a.sticker+"Paper"),e=this.drawingCanvas.localRect;a.x>e.x+e.width-d.frame.width&&(a.x=e.x+e.width-d.frame.width);var f=this.stickerContainer.localToLocal(a.x,a.y,this.drawingCanvas.stickerBitmap);this.drawingCanvas.drawSticker(f,d,c.getFrame(a.sticker+"Fill"))}this.stickerContainer.removeChild(a),a.removeAllChildren(),this.dragManager.removeObject(a)},namespace("dt").ColoringPanel=j}(),function(){var a=createjs.Container,b=createjs.Bitmap,c=createjs.Rectangle,d=function(d,e,f){a.call(this);var g=springroll.Application.instance;this.theStage=g.display.stage,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.color="#000000",this.stroke=1;var h=g.config.gameplay.paperRect;h=new c(h.x,h.y,h.w,h.h),this.localRect=h,this.drawingShape=new createjs.Shape,this.startCallback=d,this.moveCallback=e,this.endCallback=f,this.paintCanvas=document.createElement("canvas"),this.paintCanvas.width=h.width,this.paintCanvas.height=h.height,this.paintContext=this.paintCanvas.getContext("2d"),this.paintBitmap=new b(this.paintCanvas),this.paintBitmap.x=this.localRect.x,this.paintBitmap.y=this.localRect.y,this.addChild(this.paintBitmap),this.stickerCanvas=document.createElement("canvas"),this.stickerCanvas.width=h.width,this.stickerCanvas.height=h.height,this.stickerContext=this.stickerCanvas.getContext("2d"),this.stickerBitmap=new b(this.stickerCanvas),this.stickerBitmap.x=this.localRect.x,this.stickerBitmap.y=this.localRect.y,this.addChild(this.stickerBitmap);var i=g.config.designedSettings;this.hitShape=new c(0,0,i.width,i.height),this.mouseChildren=!1,this.cacheScale=1,this.prevPointsById={},this.drawingMode=null},e=new createjs.Point,f=a.prototype,g=d.prototype=Object.create(f);Object.defineProperty(g,"drawingMode",{get:function(){return this._drawingMode},set:function(a){this._drawingMode=a=a||null,null===a?(this.removeEventListener("mousedown",this.onMouseDown),this.removeEventListener("pressmove",this.onMouseMove),this.removeEventListener("pressup",this.onMouseUp)):"erase"==a?(this.addEventListener("mousedown",this.onMouseDown),this.addEventListener("pressmove",this.onMouseMove),this.addEventListener("pressup",this.onMouseUp)):(this.addEventListener("mousedown",this.onMouseDown),this.addEventListener("pressmove",this.onMouseMove),this.addEventListener("pressup",this.onMouseUp),this.color=a)}}),g.clear=function(){this.stickerContext.clearRect(0,0,this.stickerCanvas.width,this.stickerCanvas.height),this.paintContext.clearRect(0,0,this.paintCanvas.width,this.paintCanvas.height)},g.onMouseDown=function(a){var b=this.paintBitmap.globalToLocal(a.stageX,a.stageY),c=a.pointerID;this.prevPointsById[c]=b,e.x=b.x+.001,e.y=b.y+.001,"erase"==this._drawingMode?this.erase(b,e):this.drawColor(b,e),this.startCallback&&this.startCallback(b.x,b.y,c)},g.drawColor=function(a,b){var c=this.paintContext,d=this.drawingShape,e=d.graphics;e.setStrokeStyle(this.stroke,"round","round").beginStroke(this.color).moveTo(a.x,a.y).lineTo(b.x,b.y).endStroke(),c.save(),d.updateContext(c),d.draw(c),c.restore(),e.clear()},g.erase=function(a,b){var c=this.paintContext,d=this.drawingShape,e=d.graphics;e.setStrokeStyle(this.stroke,"round","round").beginStroke("#000000").moveTo(a.x,a.y).lineTo(b.x,b.y).endStroke(),c.save(),d.updateContext(c),c.globalCompositeOperation="destination-out",d.draw(c),c.restore(),e.clear()},g.onMouseMove=function(a){var b=a.pointerID,c=this.prevPointsById[b];c&&(this.paintBitmap.globalToLocal(a.stageX,a.stageY,e),"erase"==this._drawingMode?this.erase(c,e):this.drawColor(c,e),c.x=e.x,c.y=e.y,this.moveCallback&&this.moveCallback(e.x,e.y,b))},g.onMouseUp=function(a){var b=a.pointerID;delete this.prevPointsById[b],this.endCallback&&this.endCallback(b)},g.drawSticker=function(a,b,c){var d=this.stickerContext;d.save(),d.globalCompositeOperation="destination-out",d.drawImage(c.image,c.frame.x,c.frame.y,c.frame.width,c.frame.height,a.x,a.y,c.frame.width,c.frame.height),d.globalCompositeOperation="source-over",d.drawImage(b.image,b.frame.x,b.frame.y,b.frame.width,b.frame.height,a.x,a.y,b.frame.width,b.frame.height),d.restore(),d=this.paintContext,d.save(),d.globalCompositeOperation="destination-out",d.drawImage(c.image,c.frame.x,c.frame.y,c.frame.width,c.frame.height,a.x,a.y,c.frame.width,c.frame.height),d.restore()},g.drawToCanvas=function(a){var b=a.getContext("2d");b.drawImage(this.paintCanvas,0,0),b.drawImage(this.stickerCanvas,0,0)},g.destroy=function(){this.drawingMode=null,this.theStage=null,this.onMouseMove=this.onMouseDown=this.onMouseUp=null,this.localRect=null,this.startCallback=this.moveCallback=this.endCallback=null,this.prevPointsById=null,this.paintCanvas=this.paintContext=this.paintBitmap=null,this.stickerCanvas=this.stickerContext=this.stickerBitmap=null,this.removeAllChildren()},namespace("dt").DrawingCanvas=d}(),function(){var a={fps:24,raf:!0,crossOrigin:!1,parseQueryString:!0,resizeElement:window,debug:!1,cacheBust:!1,canvasId:"stage",display:springroll.CreateJSDisplay,displayOptions:{clearView:!0}},b=document.getElementById("framerate");b.parentNode.removeChild(b),new dt.ColoringTool(a)}();