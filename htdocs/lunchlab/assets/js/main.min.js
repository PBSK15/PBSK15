!function(){var t=function(){this.isActive=!0,this._getCallback=this._getCallback.bind(this),this._postCallback=this._postCallback.bind(this),this._extCall=null},e=t.prototype,i=[];t.BASE_PATH="/lunchlab/",t.GATEWAY="/lunchlab/gateway/",e.get=function(e,i){if(this._extCall=i,arguments.length>2)for(var n=2;n<arguments.length;++n){var a=arguments[n];e+="/"+a}$.get(t.GATEWAY+e,null,this._getCallback,"json")},e._getCallback=function(t){var e=this._extCall;this._extCall=null,i.push(this),e&&e(t?t.result:null)},e.post=function(e,i,n){this._extCall=i;var a={async:!0,form:e};for(var s in n)a[s]=n[s];$.post(t.BASE_PATH,a,this._postCallback)},e._postCallback=function(t){if(t.ifError){Debug.error("Errors in service call post: ");for(var e=0;e<t.messages.length;++e)Debug.error(t.messages[e])}var n=this._extCall;this._extCall=null,i.push(this),n&&n(t?t.data:null)},t.create=function(){return i.length?i.pop():new t},namespace("LunchLab.utils").ServiceCall=t}(),function(t,e){var i={};i.clean=function(){e.flash||t(".requires-flash ").remove(),e.canvas&&e.audio||t(".requires-html ").remove(),e.webaudio||t(".requires-webaudio ").remove()},namespace("LunchLab.utils").SupportUtils=i}($,Modernizr),function(){var t=function(){if(i)throw"DialogManager is already initialized, use DialogManager.instance";this.dialogs=[],this.container=$("#notifications"),i=this,this.container.data("first-time-login")&&LunchLab.dialogs.MagnetDialog.firstTimeLogin()},e=t.prototype,i=null;t.TIMER=8e3,t.init=function(){new t},Object.defineProperty(t,"instance",{get:function(){return i}}),e.add=function(e){this.dialogs.push(e),e.open(),e.timerId=setTimeout(this.remove.bind(this,e),t.TIMER),this.container.append(e.content),e.content.slideToggle()},e.remove=function(t){clearTimeout(t.timerId),t.timerId=0;var e=this.dialogs.indexOf(t);e>-1&&this.dialogs.splice(e,1),t.content.slideToggle(400,this.removeDialog.bind(this,t))},e.removeDialog=function(t){t.content.remove(),t.close()},namespace("LunchLab.dialogs").DialogManager=t}(),function(){var t=LunchLab.dialogs.DialogManager,e=function(){this.content=null},i=e.prototype;i.timerId=0,i.open=function(){throw"Must override Dialog.open"},i.close=function(){throw"Must override Dialog.close"},i.manualClose=function(){t.instance.remove(this)},namespace("LunchLab.dialogs").Dialog=e}(),function(){var t=LunchLab.dialogs.Dialog,e=LunchLab.dialogs.DialogManager,i=function(t){this.earnResult=t},n=i.prototype=new t;i.anonymousPoints=[],i.awardKidPoints=function(t){var e=isAnonymousUser(),n="kid/award-kid-points";e&&(i.anonymousPoints.push(t),n="kid/no-award-kid-points"),Canteen.Site.instance.gateway.get(s,n,t)},i.onLogin=function(){var t,e,n=i.anonymousPoints.length;if(0!==n){for(e=0;n>e;e++)t=i.anonymousPoints[e],Canteen.Site.instance.gateway.get(a,"kid/award-kid-points",t);i.anonymousPoints=[]}};var a=function(t){t&&"error"!=t.type||Debug.error(t)},s=function(t){Modernizr.flash&&(t&&"error"!=t.type?t.result&&e.instance.add(new i(t.result)):Debug.error(t))};n.open=function(){this.content=$("#coinNotificationTemplate").html(),this.content=$(this.content),this.content.find(".coinValue").html(this.earnResult.coins),this.content.find(".closeButton").touch(this.manualClose.bind(this))},n.close=function(){this.content.find(".closeButton").untouch(),this.content=null,this.earnResult=null},namespace("LunchLab.dialogs").CoinDialog=i}(),function(){var t=LunchLab.dialogs.Dialog,e=LunchLab.dialogs.DialogManager,i=function(t){this.earnResult=t},n=i.prototype=new t;i.anonymousMagnets=[],i.firstTimeLogin=function(t){Canteen.Site.instance.gateway.get(s.bind(i,t),"magnet","first-time-login")};var a=function(t){return i.anonymousMagnets.indexOf(t)>-1};i.onLogin=function(){var t=null,e=0,n=i.anonymousMagnets.length,a=Canteen.Site.instance.gateway;if(0!==n){for(e=0;n>e;e++)t=i.anonymousMagnets[e],t.match(/^[0-9]+$/)?a.get(o,"magnet/earn-requirement",t):(t=t.split(":"),a.get(o,"magnet/earn-requirement",t[0],t[1]));i.anonymousPoints=[]}},i.earnRequirement=function(t,e){var n=isAnonymousUser(),o="magnet/earn-requirement",r=null;if(n){if(r=t,a(r))return;o="magnet/no-earn-requirement"}Canteen.Site.instance.gateway.get(s.bind(i,e,r),o,t)},i.earnRequirementByContent=function(t,e,n){var o=isAnonymousUser(),r="magnet/earn-requirement",h=null;if(o){if(h=t+":"+e,a(h))return;r="magnet/no-earn-requirement"}Canteen.Site.instance.gateway.get(s.bind(i,n,h),r,t,e)};var s=function(t,n,a){a?"error"==a.type?Debug.error(a.result):(n&&i.anonymousMagnets.push(n),a.result&&e.instance.add(new i(a.result)),t&&t(!!a.result)):Debug.error("No magnet response")},o=function(t){t?"error"==t.type&&Debug.error(t.result):Debug.error("No magnet response")};n.open=function(){this.content=$("#magnetNotificationTemplate").html(),this.content=$(this.content),this.content.find(".magnetName").html(this.earnResult.magnet.name),this.content.find(".title").html(this.earnResult.magnet.total==this.earnResult.numEarned?"You've unlocked:":"One step closer to:"),this.content.find(".icon img").attr("alt",this.earnResult.magnet.name),this.content.find("a.icon").attr("href",this.earnResult.magnet.stub).internalLink(Canteen.Site.instance);var t=this.earnResult.magnet.image,e=Math.floor(this.earnResult.magnet.total/this.earnResult.magnet.steps),i=this.earnResult.numEarned,n=i>=1&&0===Math.floor(i/e)?1:Math.floor(i/e);t=t.replace(".",n+"."),this.content.find(".icon img").attr("src",t),this.content.find(".closeButton").touch(this.manualClose.bind(this))},n.close=function(){this.earnResult=null,this.content.find(".closeButton").untouch(),this.content=null},namespace("LunchLab.dialogs").MagnetDialog=i}(),function(t){var e=org.pbskids.video.VideoEvent,i=org.pbskids.video.PlayList,n=org.pbskids.video.Player,a=function(t,e){this.onCompleted=null,this.onLoaded=null,this.onStart=null,this.player=null,this.playlist=null,this.options=null,this.ready=!1,this.hasPlaylist=!1,this.guid=null,this.autoPaused=-1,this.container=$("#videoPlayerContainer"),this.initialize(t,e)},s=a.prototype,o=Canteen.settings.cdnDomain+Canteen.settings.basePath+"assets/images/",r=Canteen.settings.cacheBust,h={playerId:"videoPlayer",playlistId:"videoPlaylist",videoPlaylistItemClass:"videoPlaylistItem",playlistOptions:{debugMode:Canteen.settings.debug,loadingIndicator:o+"arrowspin.gif"+r,loadMoreVideosMessage:"Show More Videos",loadMoreButtonClass:"showmoreVideos"},playerOptions:{onVideoClick:"toggle-fullscreen",debugMode:Canteen.settings.debug,onHoverOverlay:{url:o+"button_big.png"+r,width:"58px",height:"30px",fs_url:o+"button_small.png"+r,fs_width:"78px"},playIconOverlay:{url:o+"button_overlay_play.png"+r,width:"200px",height:"200px",color:"black",opacity:"50"}}},c=null,d=null;s.initialize=function(t,e){c=this._onVideoEnd.bind(this),d=this._onPlayState.bind(this),this.options=h,$.extend(this.options.playerOptions,t),$.extend(this.options.playlistOptions,e),this.options.playerOptions.onPlayerComplete=this._onPlayerComplete.bind(this),this.player=new n(this.options.playerId,this.options.playerOptions)},s.resize=function(){this.container.css("height",.5625*this.container.width())},s._onVideoEnd=function(){this.onCompleted&&this.onCompleted()},s._onPlayState=function(t){if(t.canPlay&&this.onStart&&this.hasPlaylist){var e=$("#"+this.options.playlistId+" li"),i=this.playlist.selectedIndex(),n=e.eq(i),a=n.attr("class");a&&(a=a.match(/\bguid_[a-zA-Z0-9\-\_]+\b/)[0].substr(5)),this.guid!=a&&(this.guid=a,this.onStart&&this.onStart(a))}},s._onPlayerComplete=function(t){t.success?($(document).off(e.VIDEO_END,c).off(e.CAN_PLAY_STATE_CHANGE,d).on(e.VIDEO_END,c).on(e.CAN_PLAY_STATE_CHANGE,d),this.hasPlaylist&&(this.playlist=new i(this.options.playlistId,this.options.videoPlaylistItemClass,this.player,this.options.playlistOptions)),this.ready=!0):Debug.error("Player error: "+t.message),this.onLoaded(t.success),this.onLoaded=null},s.play=function(e){if(!this.ready)throw"Player is not ready yet";if(this.player.unload(),this.hasPlaylist){var i=e!==t?{guid:e}:t;this.playlist.purge(),this.playlist.refresh(i)}else this.player.loadAndPlay(e)},s.hide=function(){this.player&&(-1==this.autoPaused&&(this.autoPaused=this.player.paused()?0:1),this.player.pause())},s.show=function(){this.player&&(1===this.autoPaused&&this.player.playVideo(),this.autoPaused=-1)},s.destroy=function(){this.player&&this.player.unload(),this.hasPlaylist&&this.playlist&&this.playlist.purge(),this.onStart=null,this.onLoaded=null,this.onCompleted=null,this.player=null,this.playlist=null,this.options=null,this.ready=!1,this.guid=null,this.container=null,$("#pbskids-comscore-video-beacon").remove()},namespace("LunchLab.players").ProducerPlayer=a}(),function(){var t=cloudkid.Application,e=cloudkid.OS,i=cloudkid.MediaLoader,n=cloudkid.Audio,a=(cloudkid.AudioAnimation,cloudkid.Animator),s=function(t){this.options=t,this.scale=1,this.animations=[],this.aliases=[],this.character=null},o=s.prototype=new t;o.name="CharacterController";var r,h=!1,c=!1,d=!1,l=-1;images={},o.init=function(){e.instance.stage.enableMouseOver(30),i.instance.cacheManager.cacheBust=e.instance.options.debug||!1,d=c=h=!1,n.init(this.options.audio,this._soundInitComplete.bind(this)),cloudkid.Animator.audioLib=n.instance;var t=[new cloudkid.LoadTask("characteranim",this.options.animation,this._characterLoaded.bind(this))];"freezerburn"==this.options.name&&(manifest=[{src:"guitar2.png",id:"guitar2"},{src:"popsicleLeg.png",id:"popsicleLeg"},{src:"PosicleBody.png",id:"PosicleBody"}],t.push(new cloudkid.ListTask("manifests",manifest,this._onManifestLoaded.bind(this))));var a=new cloudkid.TaskManager(t);a.addEventListener(cloudkid.TaskManager.ALL_TASKS_DONE,this._loadTasksComplete.bind(this)),a.startAll(),r=this._characterClicked.bind(this)},o._characterLoaded=function(t){void 0!==t&&document.body.appendChild(t.content)},o._onManifestLoaded=function(t){for(var e in t)images[e]=t[e].content},o._loadTasksComplete=function(){d=!0,h&&this._showCharacter()},o._soundInitComplete=function(){this.aliases=n.instance.getAliases(),h=!0,d&&this._showCharacter()},o._showCharacter=function(){this.character=new lib[this.options.name],this.character.enableFramerateIndependence(30),"freezerburn"==this.options.name&&(this.character.hitRect=new createjs.Rectangle(this.character.nominalBounds.x,this.character.nominalBounds.y,this.character.nominalBounds.width,this.character.nominalBounds.height)),this.addChild(this.character),this._characterIdle()},o._characterClicked=function(){if(c){$(e.instance.stage.canvas).untouch(r),this.character.cursor="",l++,l>=this.animations.length&&(l=0);var t=this.animations[l];cloudkid.Animator.play(this.character,t.alias,this._characterIdle.bind(this),null,0,1,t)}else n.instance.load(this._soundLoaded.bind(this))},o._soundLoaded=function(){for(var t=0;t<this.aliases.length;t++){var e=this.aliases[t];this.animations.push({alias:e,start:0})}c=!0,setTimeout(r,25)},o._characterIdle=function(){this.character&&(cloudkid.Animator.play(this.character,"idle"),this.character.cursor="pointer",$(e.instance.stage.canvas).touch(r))},o.resize=function(){},o.destroy=function(){this.character&&(a.stop(this.character),$(e.instance.stage.canvas).untouch(r)),this.removeAllChildren(),this.character=this.aliases=this.animations=r=null,n.instance.stop(),n.instance.destroy()},namespace("LunchLab.animation").CharacterController=s}(),function(){var t=cloudkid.Application,e=cloudkid.OS,i=cloudkid.TaskManager,n=cloudkid.LoadTask,a=cloudkid.MediaLoader,s=cloudkid.Audio,o=createjs.Stage,r=cloudkid.Animator,h=function(t){this.options=t,this.scale=1,this.character=null},c=h.prototype=new t;c.name="HomeCharacterController";var d=!1,l=!1,u=!1,g=null,m=!1,p=null,f=null,y=null;images={},c.init=function(){e.instance.stage.enableMouseOver(30),a.instance.cacheManager.cacheBust=e.instance.options.debug||!1,u=l=d=m=!1,this.character=null,s.init(this.options.audio,this._soundInitComplete.bind(this)),r.audioLib=s.instance;var t=[new n("characteranim",this.options.animation,this._characterLoaded.bind(this))],o=new i(t);o.addEventListener(i.ALL_TASKS_DONE,this._loadTasksComplete.bind(this)),o.startAll(),g=this._characterIdle.bind(this),p=this._characterClicked.bind(this),$("body").on("touchclick",p),a.instance.load("Mixie_Home.js",this._mixieLoaded.bind(this))},c.resume=function(){e.instance.resume(),s.instance.resume(),r.resume()},c.pause=function(){e.instance.pause(),s.instance.pause(),r.pause()},c._mixieLoaded=function(t){void 0!==t&&document.body.appendChild(t.content);var e=document.getElementById("homeMixie");y=new o(e),f=new lib.Mixie_Home,f.enableFramerateIndependence(30),y.addChild(f),r.play(f,"intro",this._mixieIdle.bind(this))},c._mixieIdle=function(){r.play(f,"idle")},c._characterLoaded=function(t){void 0!==t&&document.body.appendChild(t.content)},c._onManifestLoaded=function(t){for(var e in t)images[e]=t[e].content},c._loadTasksComplete=function(){u=!0,d&&this._showCharacter()},c._soundInitComplete=function(){this.aliases=s.instance.getAliases(),d=!0,u&&this._showCharacter()},c._showCharacter=function(){this.character=new lib[this.options.name],this.character.enableFramerateIndependence(30),this.character.mouseChildren=!1,this.addChild(this.character),r.play(this.character,"intro",this._introDone.bind(this))},c._characterClicked=function(){$("body").off(),l?m&&(m=!1,this.character&&(this.character.cursor=""),r.play(this.character,"action",g,null,0,1,{alias:this.options.name,start:0})):s.instance.load(this._soundLoaded.bind(this))},c._soundLoaded=function(){l=!0,setTimeout(this._characterClicked.bind(this),25)},c._introDone=function(){s.instance.load(this._soundLoaded.bind(this)),g()},c._characterIdle=function(){this.character&&(r.play(this.character,"idle"),this.character.cursor="pointer",m=!0)},c.update=function(t){y&&y.update(t)},c.destroy=function(){$("body").off(),this.removeAllChildren(),this.character&&r.stop(this.character),this.character=g=null,s.instance.stop(),s.instance.destroy(),e.instance.stage.clear(),y&&(r.stop(f),y.clear(),y=f=null)},namespace("LunchLab.animation").HomeCharacterController=h}(),function(t,e){{var i=cloudkid.OS,n=(cloudkid.Audio,cloudkid.Animator,LunchLab.utils.SupportUtils),a=LunchLab.animation.HomeCharacterController,s=function(){},o=6e3,r=500,h=700,c=600,d=610,l=s.prototype=new Canteen.Page,u=null,g=(Modernizr.canvas&&Modernizr.audio,!1),m=!1,p=null,f=null,y=null,b=null,v=null,w=null;Modernizr.canvas&&Modernizr.audio}l.enter=function(){n.clean(),g=!1,m=!1,f=$(e),y=$(t),v=$("canvas"),b=$("#promoFrame"),u=$("#promoBox"),w=u.find("li"),u.cycle({prev:"#prev",next:"#next",timeout:o,speed:r,before:this.resize.bind(this)}),f.width()<=h&&setTimeout(this.resize.bind(this),50),this.resize()},l._startAnimationLoad=function(){m=!0,this.site.gateway.get(this._getAnimation.bind(this),"home-animation","get-random-home-animation")},l.show=function(){u.cycle("resume"),g&&p.resume()},l.hide=function(){u.cycle("pause"),g&&p.pause()},l._getAnimation=function(t){if("error"==t.type)throw"There was an error loading animation data";var e=t.result.file,n=Canteen.settings,s=n.cdnDomain+n.basePath+n.characterAssetPath,o=i.init("homeCharacter",{fps:30,clearView:!0,basePath:s});p=new a({name:e.substr(e.lastIndexOf("/")+1),animation:e+".js",audio:e+".json"}),o.addApp(p),g=!0,this.resize()},l.resize=function(){var t,e=f.width(),i=u.width();c>=e?(t=(i-1.28*i)/2,w.width("128%"),b.height(w.height()),u.height(w.height()+33),w.css("left",t)):(t=(i-d)/2,w.width(i-2*t),w.css("left",t),u.removeAttr("style"),b.removeAttr("style")),h>=e?(v.hide(),g&&p.pause()):(v.show(),g?p.resume():m||this._startAnimationLoad())},l.exit=function(){g&&i.instance.destroy(),u&&(u.css("pointer-events","none"),u.cycle("destroy")),p=b=v=f=y=u=null},namespace("LunchLab.pages").HomePage=s}(document,window),function(){var t=LunchLab.dialogs.MagnetDialog,e=function(){this.button=null},i=e.prototype=new Canteen.Page;i.enter=function(){this.button=$("#downloadButton").untouch().touch(this._checkMagnetRequirement.bind(this))},i._checkMagnetRequirement=function(){t.earnRequirementByContent("Recipe",this.button.data("id"),this._onMagnet.bind(this))},i._onMagnet=function(){var t=this.button.attr("href");Modernizr.touch?document.location.href=document.location.protocol+"//"+document.location.hostname+t:($(".download iframe").remove(),this.button.after("<iframe style='display:none' src='"+t+"' id='downloadFile'></iframe>"))},i.exit=function(){this.button.untouch(),this.button=null},namespace("LunchLab.pages").PrintablePage=e}(),function(){var t=LunchLab.players.ProducerPlayer,e=(LunchLab.dialogs.MagnetDialog,LunchLab.pages.PrintablePage),i=function(){this.player=null,this.guid=null,this.button=null},n=i.prototype=new e,a=e.prototype;n.enter=function(){a.enter.call(this),window.scrollTo(0,72),this.guid=$("#videoPlayer").data("media-id"),this.guid&&(this.player=new t({pauseToggleControl:"#playButton"}),this.player.onLoaded=this._onLoaded.bind(this))},n._onLoaded=function(){this.player.player.loadAndPause(this.guid)},n.exit=function(){this.player&&(this.player.destroy(),this.player=null,this.guid=null),a.exit.call(this)},namespace("LunchLab.pages").RecipePage=i}(),function(){function t(t){t=t.originalEvent,i=t.changedTouches[0].screenX,n=t.changedTouches[0].screenY}function e(t){t=t.originalEvent,Math.abs(t.screenX-i)<2&&Math.abs(t.screenY-n)<2&&(t.preventDefault(),t.stopPropagation())}var i,n,a=LunchLab.dialogs.MagnetDialog,s=function(){},o=s.prototype=new Canteen.Page;o.enter=function(){this.site.gateway.get(this._getLoggedIn.bind(this),"kid","is-logged-in"),$(window).off("touchstart",t),$(window).on("touchstart",t),"magnets"!=this.uri?($(".listLink").off("mousedown mouseup",e),$(".listLink").on("mousedown mouseup",e)):(a.earnRequirementByContent("Page",$("#magnetList").data("id"),this.onMagnet.bind(this)),$(".magnetLink").off("mousedown mouseup",e),$(".magnetLink").on("mousedown mouseup",e))},o._getLoggedIn=function(t){"success"!=t.type&&this._showLoginDialog()},o._showLoginDialog=function(){$("#loginContainer").show(),$("#loginButton").touch(this._doLogin.bind(this)),$("#noButton").touch(this._goHome.bind(this))},o._doLogin=function(){PBS.KIDS.identity.signin()},o._goHome=function(){$("#loginButton").untouch(this._doLogin.bind(this)),$("#noButton").untouch(this._goHome.bind(this)),this.site.redirect("")},o.loginCheck=function(){$("#loginButton").untouch(this._doLogin.bind(this)),$("#noButton").untouch(this._goHome.bind(this)),this.site.refresh()},o.onMagnet=function(t){var e;return e=$("img#magnets-visitor"),t&&!e.attr("src").match(/1\./)&&e.attr("src",e.attr("src").replace(".","1.")),e=$("img#first-login"),$("#notifications").data("first-time-login")&&!e.attr("src").match(/1\./)&&e.attr("src",e.attr("src").replace(".","1.")),!0},o.exit=function(){$(window).off("touchstart",t),"magnets"!=this.uri?$(".listLink").off("mousedown mouseup",e):$(".magnetLink").off("mousedown mouseup",e)},namespace("LunchLab.pages").MagnetsPage=s}(),function(){var t=cloudkid.OS,e=LunchLab.animation.CharacterController,i=LunchLab.dialogs.MagnetDialog,n=function(){},a=n.prototype=new Canteen.Page,s=Modernizr.canvas&&Modernizr.audio;a.enter=function(){if(i.earnRequirementByContent("Page",$("#characterFrame").data("id")),window.scrollTo(0,72),s){if(void 0===Canteen.settings.animationsPath)throw"animationsPath needs to be defined in Canteen.settings";var n=Canteen.settings.cdnDomain+Canteen.settings.basePath,a=this.uri.split("/")[1],o=t.init("stage",{fps:30,clearView:!0,basePath:n+Canteen.settings.animationsPath});o.addApp(new e({name:a.replace(/-/g,""),animation:a+".js",audio:a+".json"}))}},a.exit=function(){s&&t.instance.destroy()},namespace("LunchLab.pages").CharacterPage=n}(),function(){var t=LunchLab.players.ProducerPlayer,e=LunchLab.dialogs.MagnetDialog,i=function(){this.player=null,this.frame=null,this.updatingUri=!1,this.categoriesList=null,this.categories=null,this.clearPlaylist=!1,this.currentVideoId=null},n=i.prototype=new Canteen.Page;n.enter=function(){this.updatingUri=!1,this.frame=$("#producerPlayer").addClass("loading"),this.categories={},this.categoriesList=$("#categoryList"),this.categoriesList.find("option").each(a.bind(this)),this.categoriesList.on("change",this._onCategorySelect.bind(this)),this.player=new t({pauseToggleControl:".controlRack .playPause",captionsToggleControl:".controlRack .captions",muteToggleControl:".controlRack .volume",scrubber:".controlRack .scrubber"}),this.player.hasPlaylist=!0,this.player.onLoaded=this._onLoaded.bind(this),this.player.onStart=this._onStart.bind(this)},n._onCategorySelect=function(){var t=this.categoriesList[0];this.site.redirect(t.options[t.selectedIndex].value.split(Canteen.settings.basePath)[1])};var a=function(t){var e=this.categoriesList.find("option"),i=e.eq(t),n=i.data("category"),a=i.data("season"),s=i.attr("value").split(Canteen.settings.basePath)[1];n?this.categories[s]=n:a&&(this.categories[s]=a)};n._onStart=function(t){this.site.gateway.get(this._onVideo.bind(this),"video","get-video-by-media-id",[t])},n._onVideo=function(t){if("error"==t.type||!t.result)return Debug.warn("Invalid video for GUID"),void this.site.redirect("videos");this.currentVideoId=t.result.id;var e="videos/video/"+t.result.uri;this.uri!=e&&(this.updatingUri=!0,this.site.redirect(e))},n._onLoaded=function(){this.frame.removeClass("loading");var t=this.frame.data("guid");this.player.onCompleted=this._videoEnded.bind(this),t?(this.player.play(t),this.clearPlaylist=!0):(this.player.play(),this.clearPlaylist=!1),"none"==$(this.player.options.playerOptions.captionsToggleControl).css("display")&&this.frame.addClass("no-captions")},n._videoEnded=function(){e.earnRequirementByContent("Video",this.currentVideoId),this.clearPlaylist&&(this.player.playlist.refresh(),this.clearPlaylist=!1)},n._switchVideo=function(t){return"error"==t.type?(Debug.error("Invalid video for URL"),void this.site.redirect("videos")):void this.player.playlist.selectItem(t.result.mediaId)},n._switchCategory=function(t){return"error"==t.type?(Debug.error("Invalid video for URL"),void this.site.redirect("videos")):void this.player.play(t.result.join(","))},n.hide=function(){this.player.hide()},n.show=function(){this.player.show()},n.resize=function(){this.player.resize()},n.exit=function(){try{this.player.destroy()}catch(t){Debug.error("Caught error when destroying player: "),Debug.error(t)}this.currentVideoId=this.categories=this.categoryList=this.player=this.frame=null},n.refresh=function(t){if(this.updatingUri)this.updatingUri=!1;else if(/videos\/video\/[a-z0-9A-Z\-]+/.test(t))this.site.gateway.get(this._switchVideo.bind(this),"video","get-video-by-uri",[t.split("/")[2]]);else if(void 0!==this.categories[t]){var e=/\/category\//.test(t)?"get-category-media-ids":"get-season-media-ids";this.site.gateway.get(this._switchCategory.bind(this),"video",e,this.categories[t])}else/^videos(\/)?$/.test(t)&&this.player.play();return!1},namespace("LunchLab.pages").VideoPage=i}(),function(){var t,e,i=LunchLab.dialogs.MagnetDialog,n=function(){},a=n.prototype=new Canteen.Page,s=null,o=null,r=null,h=null,c=null,d=null,l=null,u=null,g=null,m=0,p=null,f=null,y=-1,b=null;a.enter=function(){o=$("body").on("touchend mouseup",this._stopSeek.bind(this)),g=$("#musicPlayer").waypoint("sticky"),r=$("#tracks li"),c=$("#played");var e=Modernizr.touch,i=e?"touchend":"click";h=$("#bar").on(e?"touchstart":"mousedown",this._startSeek.bind(this)),d=$("#nextButton").on(i,this._nextSong.bind(this)),l=$("#prevButton").on(i,this._previousSong.bind(this)),u=$("#playButton").on(i,this._togglePlay.bind(this)),b=$("#videoButton"),"0"==b.data("id")?b.hide():b.attr("href",b.data("href"));var n=$("li.selected");m=r.index(n),t=n.data("trackid"),s=$.media("#audio"),s.ended(this._nextSong.bind(this)),s.time(this._updatePlayhead.bind(this)),this.site.gateway.get(this._getTracks.bind(this),"music","get-music-tracks"),y=-1},a.hide=function(){s&&(-1==y&&(y=s.playing()?1:0),s.pause())},a.show=function(){s&&(1===y&&s.play(),y=-1)},a._getTracks=function(t){f=t.result,p&&(this._onTrackChanged(p),p=null)},a._nextSong=function(e){"ended"==e.type&&i.earnRequirementByContent("MusicTrack",t);var n=m+1==r.length?0:m+1;Canteen.Site.instance.redirect(r.eq(n).data("id"))},a._previousSong=function(){var t=0===m?r.length-1:m-1;Canteen.Site.instance.redirect(r.eq(t).data("id"))},a._togglePlay=function(){s.playing()?this.stop():this.play()},a.stop=function(){u.removeClass("playing").addClass("paused"),s.pause()},a.play=function(){u.removeClass("paused").addClass("playing"),s.play()},a._startSeek=function(t){"touchstart"==t.type&&(e=t.originalEvent.targetTouches[0].identifier),this._seek(t),o.on("mousemove touchmove",this._seek.bind(this))},a._seek=function(t){t.preventDefault();var i;if(t.originalEvent.targetTouches){for(var n=t.originalEvent.targetTouches,a=0;a<n.length;++a)if(n[a].identifier==e){i=n[a].pageX;break}}else i=t.pageX;var o=i-h.offset().left,r=o/h.width(),c=r*s.duration();s.seek(c),this._updatePlayhead()},a._stopSeek=function(){o&&o.off("mousemove touchmove")},a._updatePlayhead=function(){var t=s.time()/s.duration()*100+"%";c.css("width",t),$("#playHead").css("left",t)},a._onTrackChanged=function(t){if(!f)return void(p=t);var e,i;for(i=0;i<f.length;i++)f[i].uri==t&&(e=f[i]);if(!e)throw"No track matching "+t;this.stop(),c.css("width","0%"),e.video?(b.attr("href",Canteen.settings.basePath+"videos/video/"+e.video.uri),b.show()):b.hide(),$("#songThumb").attr("src",e.image),$("#songName").html(e.name),s.off("time ended"),s.remove(),s=new $.mediaAudio([e.ogg+Canteen.settings.cacheBust,e.mp3+Canteen.settings.cacheBust]),s.ended(this._nextSong.bind(this)),s.time(this._updatePlayhead.bind(this)),this.enabled(!0),this.play(),s.playing()||u.removeClass("playing").addClass("paused")},a.refresh=function(e){r.eq(m).removeClass("selected");var i=$("li[data-id='"+e+"']");return t=i.data("trackid"),m=r.index(i),r.eq(m).addClass("selected"),this.enabled(!1),this._onTrackChanged(e.split("/")[1]),!1},a.enabled=function(t){t?(g.removeClass("loading"),d.removeAttr("disabled"),u.removeAttr("disabled"),l.removeAttr("disabled")):(d.attr("disabled",!0),u.attr("disabled",!0),l.attr("disabled",!0),g.addClass("loading"))},a.exit=function(){this._stopSeek(),this.stop();var t=Modernizr.touch,e=t?"touchend":"click";h&&h.off(t?"touchstart":"mousedown"),u.off(e),l.off(e),d.off(e),s&&(s.off("time ended"),s.remove()),b=s=o=r=h=c=d=u=l=g=p=f=null,m=0},namespace("LunchLab.pages").MusicPage=n}(window),function(){var t=function(){this.search=null,this.searchText=null,this.foodFact=null,this.timer=null};t.FACT_TIMEOUT=5e3;var e=t.prototype=new Canteen.Page;e.enter=function(){this.searchText=$("#searchText").keypress(this._onEnter.bind(this)),this.searchGo=$("#searchGo").touch(this._onSubmit.bind(this)),this.searchText.focus(),this.foodFact=$("#foodFact"),this.enableTimer(!0)},e.enableTimer=function(e){this.timer&&(clearTimeout(this.timer),this.timer=null),e&&(this.timer=setInterval(this.randomFact.bind(this),t.FACT_TIMEOUT))},e.randomFact=function(){this.enableTimer(!1),this.site.gateway.get(this.onRandomFact.bind(this),"food-fact","get-random-food-fact")},e.onRandomFact=function(t){if(this.foodFact){var e=t.result;this.foodFact.find(".description").html(e.description),this.foodFact.find(".title").html(e.name),this.foodFact.find("img").attr("src",e.image+Canteen.settings.cacheBust),"success"==t.type&&this.enableTimer(!0)}},e._onSubmit=function(){var t=this.searchText.val();t&&this.site.redirect("food/search/"+t)},e._onEnter=function(t){var e=t.charCode?t.charCode:t.which;13==e&&this._onSubmit()},e.exit=function(){this.enableTimer(!1),this.foodFact=null,this.searchGo.untouch(),this.searchGo=null,this.searchText.off("keypress"),this.searchText=null},namespace("LunchLab.pages").FoodPage=t}(),function(t){var e=function(){this.player=null,this.options={}},i=e.prototype=new Canteen.Page;i.constructor=e,i.enter=function(){window.scrollTo(0,72);var e=$("#gameContent"),i={id:"gameContent",width:e.data("game-width"),height:e.data("game-height"),gameId:e.data("game-id"),name:e.data("name")};if($.extend(i,this.options),e.data("is-flash")&&t.flash)this.player=new LunchLab.players.FlashGamePlayer(i);else if(e.data("is-html")&&t.canvas&&t.audio){if(e.data("is-webaudio")&&!t.webaudio)return void this.site.redirect("games");this.player=new LunchLab.players.HTML5GamePlayer(i)}else this.site.redirect("games")},i.hide=function(){this.player.hide()},i.show=function(){this.player.show()},i.loginCheck=function(){this.player.loginCheck()},i.resize=function(){if(this.player){var t=494/869,e=$("#game .frame");""===$("#game").data("aspect")&&e.css("padding-bottom",100*t+"%");var i=$("#game");i.css("width","inherit"),$(window).width()>600?(i.css("margin","0 12px"),e.css("margin-top","21px")):(i.css("margin","0"),e.css("margin-top","10px"));var n=$(window).height(),a=i.height(),s=$("#game .frame .topBar");if(s.show(),a>n){$(window).width()<600&&(s.hide(),e.css("margin-top","0"));var o;o=""!==i.data("aspect")?i.data("aspect")/100:t;var r=$("#gameContent").height();if(0===r)return;var h=a-r;i.width((n-h)/o),i.css("margin","0 auto")}}},i.exit=function(){this.player&&this.player.destroy()},namespace("LunchLab.pages").GamePage=e}(Modernizr),function(){var t=LunchLab.pages.GamePage,e=function(){n.constructor.call(this)},i=e.prototype=new t,n=t.prototype;i.enter=function(){var t=Canteen.settings,e=window.location.href.split("my-kitchen/");this.options={flashVars:{baseShareUrl:"http:"+t.host+t.basePath+"my-kitchen/",share:e[1]}},n.enter.call(this)},namespace("LunchLab.pages").MyKitchenPage=e}(),function(){var t=function(){},e=t.prototype=new Canteen.Page;e.enter=function(){window.scrollTo(0,72)},namespace("LunchLab.pages").ContactPage=t}(),function(){var t=function(){},e=t.prototype=new Canteen.Page;e.enter=function(){window.scrollTo(0,72),$("h2.toggler").touch(function(){$(this).toggleClass("selected"),$(this).next().slideToggle("slow")})},e.exit=function(){$("h2.toggler").untouch()},namespace("LunchLab.pages").CreditsPage=t}(),function(t){var e=function(t){o=o||cloudkid.SavedData,r=r||LunchLab.utils.ServiceCall,t&&(this.id=t.id,this.width=t.width,this.height=t.height,this.name=t.name,this.gameId=t.gameId||0,this.options=t,this.dom=null,this.listenerJQ=null,this.container=$("#game"),this.isGameLoaded=!1,this.captionsButton=new c("captionsButton",this.onCaptionsButton.bind(this)),this.musicButton=new c("musicButton",this.onMusicButton.bind(this)),this.effectsButton=new c("effectsButton",this.onEffectsButton.bind(this)),null===o.read(n)?(o.write(n,!0),o.write(a,!1),o.write(s,!1),this.captionsButton.setChecked(!1),this.musicButton.setChecked(!0),this.effectsButton.setChecked(!0)):(this.captionsButton.setChecked(!o.read(n)),this.musicButton.setChecked(!o.read(a)),this.effectsButton.setChecked(!o.read(s))))},i=e.prototype={},n="LLGameCaptionsMuted",a="LLGameMusicMuted",s="LLGameEffectsMuted";i.constructor=e;var o=null,r=null;i.destroy=function(){t.PBS&&t.PBS.KIDS&&t.PBS.KIDS.$_auth&&PBS.KIDS.$_auth("body").off("cbox_closed",this.onLoginBoxClosed),this.timeoutId&&clearInterval(this.timeoutId),this.captionsButton.destroy(),this.musicButton.destroy(),this.effectsButton.destroy();var e=this.listenerJQ;e&&(e.off("gameLoaded",this._loadComplete),e.off("kid-is-logged-in",this._getUser),e.off("game-save",this._saveData),e.off("kid-get-kid-saves-by-game",this._loadData),e.off("kid-award-kid-points",this._earnPoints),e.off("magnet-earn-requirement",this._earnMagnet)),this._loadComplete=this._getUser=this._saveData=this._loadData=this._earnPoints=this._earnMagnet=null,this.options=this.container=this.dom=this.listenerJS=this.width=this.height=this.id=this.name=this.captionsButton=this.musicButton=this.effectsButton=null},i.addListeners=function(){var t=this.listenerJQ;this._loadComplete=this._loadComplete.bind(this),this._getUser=this._getUser.bind(this),this._saveData=this._saveData.bind(this),this._loadData=this._loadData.bind(this),this._earnPoints=this._earnPoints.bind(this),this._earnMagnet=this._earnMagnet.bind(this),t.on("gameLoaded",this._loadComplete),t.on("kid-is-logged-in",this._getUser),t.on("game-save",this._saveData),t.on("kid-get-kid-saves-by-game",this._loadData),t.on("kid-award-kid-points",this._earnPoints),t.on("magnet-earn-requirement",this._earnMagnet)
},i.sendMessage=function(){},i.doCallback=function(t,e){if(t)if("string"==typeof t){var i={callback:t};void 0!==e&&(i.data=e),this.sendMessage(i)}else void 0!==e?t(e):t()},i._loadComplete=function(t){this.isGameLoaded=!0,this.restoreMuteSettings(),this.container.removeClass("loading"),this.doCallback(t.callback)},i._getUser=function(t){r.create().get("kid/is-logged-in",this.doCallback.bind(this,t.callback))},i._saveData=function(t){r.create().post("LunchLab\\Forms\\GameSaveForm",null,{gameid:t.gameId,save:JSON.stringify(t.save)})},i._loadData=function(t){r.create().get("kid/get-kid-saves-by-game",h.bind(this,this.doCallback.bind(this,t.callback)),t.gameId)},i._earnPoints=function(t){LunchLab.dialogs.CoinDialog.awardKidPoints(t.coinEventAlias)},i._earnMagnet=function(t){LunchLab.dialogs.MagnetDialog.earnRequirement(t.magnetRequirement)};var h=function(t,e){t&&t(e?JSON.parse(e.data):null)};i.loginCheck=function(){throw"loginCheck needs to be implemented"},i.setMusicMuted=function(){throw"Player must implement setMusicMuted"},i.setEffectsMuted=function(){throw"Player must implement setEffectsMuted"},i.setCaptionsMuted=function(){throw"Player must implement setCaptionsMuted"},i.hide=function(){throw"Player must implement hide method"},i.show=function(){throw"Player must implement show method"},i.restoreMuteSettings=function(){this.setCaptionsMuted(o.read(n)),this.setMusicMuted(o.read(a)),this.setEffectsMuted(o.read(s))},i.onCaptionsButton=function(t){this.setCaptionsMuted(!t),o.write(n,!t)},i.onMusicButton=function(t){this.setMusicMuted(!t),o.write(a,!t)},i.onEffectsButton=function(t){this.setEffectsMuted(!t),o.write(s,!t)};var c=function(t,e){var i=this.button=$("#"+t),n=!1;this.getChecked=function(){return n};var a=this.setChecked=function(t){n=t,i.removeClass("checked"),n&&i.addClass("checked")};this.button.touch(function(){a(!n),e(n)}),this.destroy=function(){this.button.untouch(),this.getChecked=null,this.setChecked=null,this.destroy=null}};namespace("LunchLab.players").GamePlayer=e}(window),function(){var t=org.pbskids.swfobject2_2,e=function(t){n.constructor.call(this,t),this.content=null,this.initialize()},i=e.prototype=new LunchLab.players.GamePlayer,n=LunchLab.players.GamePlayer.prototype,a=null;Object.defineProperty(e,"instance",{get:function(){return a}}),i.initialize=function(){a=this;var e=Canteen.settings.basePath,i=void 0!==Canteen.settings.cacheBust?Canteen.settings.cacheBust:"",n={local:Canteen.settings.local,debug:Canteen.settings.debug,cacheBust:Canteen.settings.debug,versions:e+"assets/txt/versions.txt",basePath:e,gateway:"http:"+Canteen.settings.host+e+"amf",folder:this.name,trackEvent:"GA_obj.trackEvent",gameId:this.gameId,gameBaseUrl:e+Canteen.settings.gamesPath,siteUrl:"http:"+Canteen.settings.baseUrl,showLoginCall:"PBS.KIDS.identity.signin",callbackObject:"LunchLab.players.FlashGamePlayer.instance"};$.extend(n,this.options.flashVars);var s={wmode:"opaque",allowScriptAccess:"always",id:this.id,bgcolor:"#000000",menu:"false"};t.embedSWF(e+"assets/swfs/LunchLab.swf"+i,this.id,"100%","100%","10.0.0","",n,s,{id:this.id},this.onSwfEmbedded.bind(this))},i.loadComplete=function(){this.listenerJQ.trigger("gameLoaded"),this.listenerJQ.resize()},i.loadProgress=function(t){this.listenerJQ.trigger({type:"loadProgress",amount:t})},i.awardKidPoints=function(t){this.listenerJQ.trigger({type:"kid-award-kid-points",coinEventAlias:t})},i.earnRequirement=function(t){this.listenerJQ.trigger({type:"magnet-earn-requirement",magnetRequirement:t})},i.onSwfEmbedded=function(){this.content=$("#"+this.id).attr("width",this.width).attr("height",this.height),this.dom=this.content.get(0),this.listenerJQ=$(this.dom.parentNode),this.addListeners(),0===this.content.height()&&setTimeout(this.listenerJQ.resize.bind(this.listenerJQ),100)},i.loginCheck=function(){this.dom.loginCheck&&this.dom.loginCheck()},i.setMusicMuted=function(t){this.isGameLoaded&&this.dom.setMusicMuted(t)},i.setEffectsMuted=function(t){this.isGameLoaded&&this.dom.setEffectsMuted(t)},i.setCaptionsMuted=function(t){this.isGameLoaded&&this.dom.setCaptionsMuted(t)},i.show=function(){this.dom.show()},i.hide=function(){this.dom.hide()},i.destroy=function(){this.content=null,n.destroy.call(this)},namespace("LunchLab.players").FlashGamePlayer=e}(),function(){var t=function(t){i.constructor.call(this,t),this.messageReceiver=this.messageReceiver.bind(this),this.initialize()},e=t.prototype=new LunchLab.players.GamePlayer,i=LunchLab.players.GamePlayer.prototype;e.initialize=function(){var t=Canteen.settings,e=t.basePath+t.gamesPath+this.name+"/index.html";$("#"+this.id).append("<iframe id='"+this.id+"_frame' scrolling='no' src='"+e+"'></iframe>");var i=document.getElementById(this.id+"_frame");this.dom=i.contentWindow||i,this.dom.hasLunchLabSite=!0,this.dom.LLSiteWindow=$(this.dom);var n=$("#"+this.id),a=$(i);this._resizeFunc=function(){a.width(n.width()),a.height(n.height())},n.on("resize",this._resizeFunc),a.width(n.width()),a.height(n.height()),window.addEventListener("message",this.messageReceiver)},e.sendMessage=function(t){this.dom.postMessage(t,"*")},e.messageReceiver=function(t){var e=t.data;if("LL_Game_Lib"==e)this.dom.postMessage("In_LL_Site","*");else switch(e.type){case"gameLoaded":this._loadComplete(e);break;case"loadProgress":this._loadProgress(e);break;case"kid-is-logged-in":this._getUser(e);break;case"game-save":this._saveData(e);break;case"kid-get-kid-saves-by-game":this._loadData(e);break;case"kid-award-kid-points":this._earnPoints(e);break;case"magnet-earn-requirement":this._earnMagnet(e)}},e.loginCheck=function(){this.sendMessage({type:"loginCheck"})},e.setMusicMuted=function(t){this.isGameLoaded&&this.sendMessage({type:"muteChange",context:"music",mute:t})},e.setEffectsMuted=function(t){this.isGameLoaded&&this.sendMessage({type:"muteChange",context:"sfx",mute:t})},e.setCaptionsMuted=function(t){this.isGameLoaded&&this.sendMessage({type:"muteChange",context:"captions",mute:t})},e.hide=function(){this.isGameLoaded&&this.sendMessage({type:"pause"})},e.show=function(){this.isGameLoaded&&this.sendMessage({type:"unpause"})},e.getContent=function(){return this.dom||(this.dom=$("#"+this.id).get(0)),this.dom},e.destroy=function(){$("#"+this.id).off("resize",this._resizeFunc),this._resizeFunc=null,i.destroy.call(this),window.removeEventListener("message",this.messageReceiver),this.messageReceiver=null},namespace("LunchLab.players").HTML5GamePlayer=t}(),$(function(){if(!Canteen.Site.instance)throw"Canteen Site isn't setup";var t=Canteen.Site.instance,e=org.pbskids.swfobject2_2,i=LunchLab.pages,n=(LunchLab.dialogs.MagnetDialog,LunchLab.dialogs.CoinDialog,LunchLab.dialogs.DialogManager);if(Modernizr.addTest("flash",e.hasFlashPlayerVersion("10.0.0")),Modernizr.addTest("webaudio","webkitAudioContext"in window||"AudioContext"in window),void 0!==Canteen.Pages){var a=Canteen.Pages.AdminPage;t.addPage(/^admin\/games(\/.*)?$/,new a("#game_name","#game_uri")),t.addPage(/^admin\/printables(\/.*)?$/,new a("#printable_name","#printable_uri")),t.addPage(/^admin\/music(\/.*)?$/,new a("#musictrack_name","#musictrack_uri")),t.addPage(/^admin\/recipes(\/.*)?$/,new a("#recipe_shortName","#recipe_uri")),t.addPage(/^admin\/videos(\/.*)?$/,new a("#video_title","#video_uri")),t.addPage(/^admin\/magnets(\/.*)?$/,new a("#magnet_name","#magnet_uri"))}t.addPage(/^food(\/(tag|search)\/.*)?$/,new i.FoodPage),t.addPage(/^food\/recipe\/.+$/,new i.RecipePage),t.addPage(/^printables\/.+$/,new i.PrintablePage),t.addPage(/^magnets(\/.+)?$/,new i.MagnetsPage),t.addPage(/^games\/.+$/,new i.GamePage),t.addPage(/^my\-kitchen(\/.+)?$/,new i.MyKitchenPage),t.addPage(/^music\/.+$/,new i.MusicPage),t.addPage(/^characters\/.+$/,new i.CharacterPage),t.addPage(/^videos(\/(category|video|season)\/.+)?$/,new i.VideoPage),t.addPage("credits",new i.CreditsPage),t.addPage("contact-us",new i.ContactPage),t.addPage("",new i.HomePage),n.init(),Canteen.Site.prototype.loginCheck=function(){this.gateway.get(function(t){t&&(t.created==t.lastLogin&&LunchLab.dialogs.MagnetDialog.firstTimeLogin(),LunchLab.dialogs.MagnetDialog.onLogin(),LunchLab.dialogs.CoinDialog.onLogin())},"kid","is-logged-in")},t.on("enter",function(){if($("input[data-restrict]").keypress(function(){var t=new RegExp("^["+$(this).data("restrict")+"]+$"),e=String.fromCharCode(event.charCode?event.charCode:event.which);return t.test(e)?void 0:(event.preventDefault(),!1)}),!Modernizr.svg){var t=/\.svg(z)?(\?.+)?$/;$("img").each(function(){Debug.log("an image!!: "+this.src);var e=$(this),i=this.src;if(i.match(t)){var n=e.data("fallback")||"png";e.attr("src",i.replace(t,"."+n))}})}LunchLab.utils.SupportUtils.clean()}),t.on("exit",function(){$("input[data-restrict]").off("keypress")}),$(window).on("show.visibility",function(){var e=t.currentPage;e&&$.isFunction(e.show)&&e.show()}).on("hide.visibility",function(){var e=t.currentPage;e&&$.isFunction(e.hide)&&e.hide()}),window.trackerCall=null,window.pushEvent=null,window.getCurrentUser=null,window.isAnonymousUser=function(){return!Canteen.settings.local}});