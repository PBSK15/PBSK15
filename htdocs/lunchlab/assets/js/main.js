!function(){var a=function(){this.isActive=!0,this._getCallback=this._getCallback.bind(this),this._postCallback=this._postCallback.bind(this),this._extCall=null},b=a.prototype,c=[];a.BASE_PATH="/lunchlab/",a.GATEWAY="/lunchlab/gateway/",b.get=function(b,c){if(this._extCall=c,arguments.length>2)for(var d=2;d<arguments.length;++d){var e=arguments[d];b+="/"+e}$.get(a.GATEWAY+b,null,this._getCallback,"json")},b._getCallback=function(a){var b=this._extCall;this._extCall=null,c.push(this),b&&b(a?a.result:null)},b.post=function(b,c,d){this._extCall=c;var e={async:!0,form:b};for(var f in d)e[f]=d[f];$.post(a.BASE_PATH,e,this._postCallback)},b._postCallback=function(a){if(a.ifError){Debug.error("Errors in service call post: ");for(var b=0;b<a.messages.length;++b)Debug.error(a.messages[b])}var d=this._extCall;this._extCall=null,c.push(this),d&&d(a?a.data:null)},a.create=function(){return c.length?c.pop():new a},namespace("LunchLab.utils").ServiceCall=a}(),function(a,b){var c={};c.clean=function(){b.flash||a(".requires-flash ").remove(),b.canvas&&b.audio||a(".requires-html ").remove(),b.webaudio||a(".requires-webaudio ").remove()},namespace("LunchLab.utils").SupportUtils=c}($,Modernizr),function(){var a=function(){if(c)throw"DialogManager is already initialized, use DialogManager.instance";this.dialogs=[],this.container=$("#notifications"),c=this,this.container.data("first-time-login")&&LunchLab.dialogs.MagnetDialog.firstTimeLogin()},b=a.prototype,c=null;a.TIMER=8e3,a.init=function(){new a},Object.defineProperty(a,"instance",{get:function(){return c}}),b.add=function(b){this.dialogs.push(b),b.open(),b.timerId=setTimeout(this.remove.bind(this,b),a.TIMER),this.container.append(b.content),b.content.slideToggle()},b.remove=function(a){clearTimeout(a.timerId),a.timerId=0;var b=this.dialogs.indexOf(a);b>-1&&this.dialogs.splice(b,1),a.content.slideToggle(400,this.removeDialog.bind(this,a))},b.removeDialog=function(a){a.content.remove(),a.close()},namespace("LunchLab.dialogs").DialogManager=a}(),function(){var a=LunchLab.dialogs.DialogManager,b=function(){this.content=null},c=b.prototype;c.timerId=0,c.open=function(){throw"Must override Dialog.open"},c.close=function(){throw"Must override Dialog.close"},c.manualClose=function(){a.instance.remove(this)},namespace("LunchLab.dialogs").Dialog=b}(),function(){var a=LunchLab.dialogs.Dialog,b=LunchLab.dialogs.DialogManager,c=function(a){this.earnResult=a},d=c.prototype=new a;c.anonymousPoints=[],c.awardKidPoints=function(a){var b=isAnonymousUser(),d="kid/award-kid-points";b&&(c.anonymousPoints.push(a),d="kid/no-award-kid-points"),Canteen.Site.instance.gateway.get(f,d,a)},c.onLogin=function(){var a,b,d=c.anonymousPoints.length;if(0!==d){for(b=0;d>b;b++)a=c.anonymousPoints[b],Canteen.Site.instance.gateway.get(e,"kid/award-kid-points",a);c.anonymousPoints=[]}};var e=function(a){a&&"error"!=a.type||Debug.error(a)},f=function(a){Modernizr.flash&&(a&&"error"!=a.type?a.result&&b.instance.add(new c(a.result)):Debug.error(a))};d.open=function(){this.content=$("#coinNotificationTemplate").html(),this.content=$(this.content),this.content.find(".coinValue").html(this.earnResult.coins),this.content.find(".closeButton").touch(this.manualClose.bind(this))},d.close=function(){this.content.find(".closeButton").untouch(),this.content=null,this.earnResult=null},namespace("LunchLab.dialogs").CoinDialog=c}(),function(){var a=LunchLab.dialogs.Dialog,b=LunchLab.dialogs.DialogManager,c=function(a){this.earnResult=a},d=c.prototype=new a;c.anonymousMagnets=[],c.firstTimeLogin=function(a){Canteen.Site.instance.gateway.get(f.bind(c,a),"magnet","first-time-login")};var e=function(a){return c.anonymousMagnets.indexOf(a)>-1};c.onLogin=function(){var a=null,b=0,d=c.anonymousMagnets.length,e=Canteen.Site.instance.gateway;if(0!==d){for(b=0;d>b;b++)a=c.anonymousMagnets[b],a.match(/^[0-9]+$/)?e.get(g,"magnet/earn-requirement",a):(a=a.split(":"),e.get(g,"magnet/earn-requirement",a[0],a[1]));c.anonymousPoints=[]}},c.earnRequirement=function(a,b){var d=isAnonymousUser(),g="magnet/earn-requirement",h=null;if(d){if(h=a,e(h))return;g="magnet/no-earn-requirement"}Canteen.Site.instance.gateway.get(f.bind(c,b,h),g,a)},c.earnRequirementByContent=function(a,b,d){var g=isAnonymousUser(),h="magnet/earn-requirement",i=null;if(g){if(i=a+":"+b,e(i))return;h="magnet/no-earn-requirement"}Canteen.Site.instance.gateway.get(f.bind(c,d,i),h,a,b)};var f=function(a,d,e){e?"error"==e.type?Debug.error(e.result):(d&&c.anonymousMagnets.push(d),e.result&&b.instance.add(new c(e.result)),a&&a(!!e.result)):Debug.error("No magnet response")},g=function(a){a?"error"==a.type&&Debug.error(a.result):Debug.error("No magnet response")};d.open=function(){this.content=$("#magnetNotificationTemplate").html(),this.content=$(this.content),this.content.find(".magnetName").html(this.earnResult.magnet.name),this.content.find(".title").html(this.earnResult.magnet.total==this.earnResult.numEarned?"You've unlocked:":"One step closer to:"),this.content.find(".icon img").attr("alt",this.earnResult.magnet.name),this.content.find("a.icon").attr("href",this.earnResult.magnet.stub).internalLink(Canteen.Site.instance);var a=this.earnResult.magnet.image,b=Math.floor(this.earnResult.magnet.total/this.earnResult.magnet.steps),c=this.earnResult.numEarned,d=c>=1&&0===Math.floor(c/b)?1:Math.floor(c/b);a=a.replace(".",d+"."),this.content.find(".icon img").attr("src",a),this.content.find(".closeButton").touch(this.manualClose.bind(this))},d.close=function(){this.earnResult=null,this.content.find(".closeButton").untouch(),this.content=null},namespace("LunchLab.dialogs").MagnetDialog=c}(),function(a){var b=org.pbskids.video.VideoEvent,c=org.pbskids.video.PlayList,d=org.pbskids.video.Player,e=function(a,b){this.onCompleted=null,this.onLoaded=null,this.onStart=null,this.player=null,this.playlist=null,this.options=null,this.ready=!1,this.hasPlaylist=!1,this.guid=null,this.autoPaused=-1,this.container=$("#videoPlayerContainer"),this.initialize(a,b)},f=e.prototype,g=Canteen.settings.cdnDomain+Canteen.settings.basePath+"assets/images/",h=Canteen.settings.cacheBust,i={playerId:"videoPlayer",playlistId:"videoPlaylist",videoPlaylistItemClass:"videoPlaylistItem",playlistOptions:{debugMode:Canteen.settings.debug,loadingIndicator:g+"arrowspin.gif"+h,loadMoreVideosMessage:"Show More Videos",loadMoreButtonClass:"showmoreVideos"},playerOptions:{onVideoClick:"toggle-fullscreen",debugMode:Canteen.settings.debug,onHoverOverlay:{url:g+"button_big.png"+h,width:"58px",height:"30px",fs_url:g+"button_small.png"+h,fs_width:"78px"},playIconOverlay:{url:g+"button_overlay_play.png"+h,width:"200px",height:"200px",color:"black",opacity:"50"}}},j=null,k=null;f.initialize=function(a,b){j=this._onVideoEnd.bind(this),k=this._onPlayState.bind(this),this.options=i,$.extend(this.options.playerOptions,a),$.extend(this.options.playlistOptions,b),this.options.playerOptions.onPlayerComplete=this._onPlayerComplete.bind(this),this.player=new d(this.options.playerId,this.options.playerOptions)},f.resize=function(){this.container.css("height",.5625*this.container.width())},f._onVideoEnd=function(){this.onCompleted&&this.onCompleted()},f._onPlayState=function(a){if(a.canPlay&&this.onStart&&this.hasPlaylist){var b=$("#"+this.options.playlistId+" li"),c=this.playlist.selectedIndex(),d=b.eq(c),e=d.attr("class");e&&(e=e.match(/\bguid_[a-zA-Z0-9\-\_]+\b/)[0].substr(5)),this.guid!=e&&(this.guid=e,this.onStart&&this.onStart(e))}},f._onPlayerComplete=function(a){a.success?($(document).off(b.VIDEO_END,j).off(b.CAN_PLAY_STATE_CHANGE,k).on(b.VIDEO_END,j).on(b.CAN_PLAY_STATE_CHANGE,k),this.hasPlaylist&&(this.playlist=new c(this.options.playlistId,this.options.videoPlaylistItemClass,this.player,this.options.playlistOptions)),this.ready=!0):Debug.error("Player error: "+a.message),this.onLoaded(a.success),this.onLoaded=null},f.play=function(b){if(!this.ready)throw"Player is not ready yet";if(this.player.unload(),this.hasPlaylist){var c=b!==a?{guid:b}:a;this.playlist.purge(),this.playlist.refresh(c)}else this.player.loadAndPlay(b)},f.hide=function(){this.player&&(-1==this.autoPaused&&(this.autoPaused=this.player.paused()?0:1),this.player.pause())},f.show=function(){this.player&&(1===this.autoPaused&&this.player.playVideo(),this.autoPaused=-1)},f.destroy=function(){this.player&&this.player.unload(),this.hasPlaylist&&this.playlist&&this.playlist.purge(),this.onStart=null,this.onLoaded=null,this.onCompleted=null,this.player=null,this.playlist=null,this.options=null,this.ready=!1,this.guid=null,this.container=null,$("#pbskids-comscore-video-beacon").remove()},namespace("LunchLab.players").ProducerPlayer=e}(),function(){var a=cloudkid.Application,b=cloudkid.OS,c=cloudkid.MediaLoader,d=cloudkid.Audio,e=(cloudkid.AudioAnimation,cloudkid.Animator),f=function(a){this.options=a,this.scale=1,this.animations=[],this.aliases=[],this.character=null},g=f.prototype=new a;g.name="CharacterController";var h,i=!1,j=!1,k=!1,l=-1;images={},g.init=function(){b.instance.stage.enableMouseOver(30),c.instance.cacheManager.cacheBust=b.instance.options.debug||!1,k=j=i=!1,d.init(this.options.audio,this._soundInitComplete.bind(this)),cloudkid.Animator.audioLib=d.instance;var a=[new cloudkid.LoadTask("characteranim",this.options.animation,this._characterLoaded.bind(this))];"freezerburn"==this.options.name&&(manifest=[{src:"guitar2.png",id:"guitar2"},{src:"popsicleLeg.png",id:"popsicleLeg"},{src:"PosicleBody.png",id:"PosicleBody"}],a.push(new cloudkid.ListTask("manifests",manifest,this._onManifestLoaded.bind(this))));var e=new cloudkid.TaskManager(a);e.addEventListener(cloudkid.TaskManager.ALL_TASKS_DONE,this._loadTasksComplete.bind(this)),e.startAll(),h=this._characterClicked.bind(this)},g._characterLoaded=function(a){void 0!==a&&document.body.appendChild(a.content)},g._onManifestLoaded=function(a){for(var b in a)images[b]=a[b].content},g._loadTasksComplete=function(){k=!0,i&&this._showCharacter()},g._soundInitComplete=function(){this.aliases=d.instance.getAliases(),i=!0,k&&this._showCharacter()},g._showCharacter=function(){this.character=new lib[this.options.name],this.character.enableFramerateIndependence(30),"freezerburn"==this.options.name&&(this.character.hitRect=new createjs.Rectangle(this.character.nominalBounds.x,this.character.nominalBounds.y,this.character.nominalBounds.width,this.character.nominalBounds.height)),this.addChild(this.character),this._characterIdle()},g._characterClicked=function(){if(j){$(b.instance.stage.canvas).untouch(h),this.character.cursor="",l++,l>=this.animations.length&&(l=0);var a=this.animations[l];cloudkid.Animator.play(this.character,a.alias,this._characterIdle.bind(this),null,0,1,a)}else d.instance.load(this._soundLoaded.bind(this))},g._soundLoaded=function(){for(var a=0;a<this.aliases.length;a++){var b=this.aliases[a];this.animations.push({alias:b,start:0})}j=!0,setTimeout(h,25)},g._characterIdle=function(){this.character&&(cloudkid.Animator.play(this.character,"idle"),this.character.cursor="pointer",$(b.instance.stage.canvas).touch(h))},g.resize=function(){},g.destroy=function(){this.character&&(e.stop(this.character),$(b.instance.stage.canvas).untouch(h)),this.removeAllChildren(),this.character=this.aliases=this.animations=h=null,d.instance.stop(),d.instance.destroy()},namespace("LunchLab.animation").CharacterController=f}(),function(){var a=cloudkid.Application,b=cloudkid.OS,c=cloudkid.TaskManager,d=cloudkid.LoadTask,e=cloudkid.MediaLoader,f=cloudkid.Audio,g=createjs.Stage,h=cloudkid.Animator,i=function(a){this.options=a,this.scale=1,this.character=null},j=i.prototype=new a;j.name="HomeCharacterController";var k=!1,l=!1,m=!1,n=null,o=!1,p=null,q=null,r=null;images={},j.init=function(){b.instance.stage.enableMouseOver(30),e.instance.cacheManager.cacheBust=b.instance.options.debug||!1,m=l=k=o=!1,this.character=null,f.init(this.options.audio,this._soundInitComplete.bind(this)),h.audioLib=f.instance;var a=[new d("characteranim",this.options.animation,this._characterLoaded.bind(this))],g=new c(a);g.addEventListener(c.ALL_TASKS_DONE,this._loadTasksComplete.bind(this)),g.startAll(),n=this._characterIdle.bind(this),p=this._characterClicked.bind(this),$("body").on("touchclick",p),e.instance.load("Mixie_Home.js",this._mixieLoaded.bind(this))},j.resume=function(){b.instance.resume(),f.instance.resume(),h.resume()},j.pause=function(){b.instance.pause(),f.instance.pause(),h.pause()},j._mixieLoaded=function(a){void 0!==a&&document.body.appendChild(a.content);var b=document.getElementById("homeMixie");r=new g(b),q=new lib.Mixie_Home,q.enableFramerateIndependence(30),r.addChild(q),h.play(q,"intro",this._mixieIdle.bind(this))},j._mixieIdle=function(){h.play(q,"idle")},j._characterLoaded=function(a){void 0!==a&&document.body.appendChild(a.content)},j._onManifestLoaded=function(a){for(var b in a)images[b]=a[b].content},j._loadTasksComplete=function(){m=!0,k&&this._showCharacter()},j._soundInitComplete=function(){this.aliases=f.instance.getAliases(),k=!0,m&&this._showCharacter()},j._showCharacter=function(){this.character=new lib[this.options.name],this.character.enableFramerateIndependence(30),this.character.mouseChildren=!1,this.addChild(this.character),h.play(this.character,"intro",this._introDone.bind(this))},j._characterClicked=function(){$("body").off(),l?o&&(o=!1,this.character&&(this.character.cursor=""),h.play(this.character,"action",n,null,0,1,{alias:this.options.name,start:0})):f.instance.load(this._soundLoaded.bind(this))},j._soundLoaded=function(){l=!0,setTimeout(this._characterClicked.bind(this),25)},j._introDone=function(){f.instance.load(this._soundLoaded.bind(this)),n()},j._characterIdle=function(){this.character&&(h.play(this.character,"idle"),this.character.cursor="pointer",o=!0)},j.update=function(a){r&&r.update(a)},j.destroy=function(){$("body").off(),this.removeAllChildren(),this.character&&h.stop(this.character),this.character=n=null,f.instance.stop(),f.instance.destroy(),b.instance.stage.clear(),r&&(h.stop(q),r.clear(),r=q=null)},namespace("LunchLab.animation").HomeCharacterController=i}(),function(a,b){{var c=cloudkid.OS,d=(cloudkid.Audio,cloudkid.Animator,LunchLab.utils.SupportUtils),e=LunchLab.animation.HomeCharacterController,f=function(){},g=6e3,h=500,i=700,j=600,k=610,l=f.prototype=new Canteen.Page,m=null,n=(Modernizr.canvas&&Modernizr.audio,!1),o=!1,p=null,q=null,r=null,s=null,t=null,u=null;Modernizr.canvas&&Modernizr.audio}l.enter=function(){d.clean(),n=!1,o=!1,q=$(b),r=$(a),t=$("canvas"),s=$("#promoFrame"),m=$("#promoBox"),u=m.find("li"),m.cycle({prev:"#prev",next:"#next",timeout:g,speed:h,before:this.resize.bind(this)}),q.width()<=i&&setTimeout(this.resize.bind(this),50),this.resize()},l._startAnimationLoad=function(){o=!0,this.site.gateway.get(this._getAnimation.bind(this),"home-animation","get-random-home-animation")},l.show=function(){m.cycle("resume"),n&&p.resume()},l.hide=function(){m.cycle("pause"),n&&p.pause()},l._getAnimation=function(a){if("error"==a.type)throw"There was an error loading animation data";var b=a.result.file,d=Canteen.settings,f=d.cdnDomain+d.basePath+d.characterAssetPath,g=c.init("homeCharacter",{fps:30,clearView:!0,basePath:f});p=new e({name:b.substr(b.lastIndexOf("/")+1),animation:b+".js",audio:b+".json"}),g.addApp(p),n=!0,this.resize()},l.resize=function(){var a,b=q.width(),c=m.width();j>=b?(a=(c-1.28*c)/2,u.width("128%"),s.height(u.height()),m.height(u.height()+33),u.css("left",a)):(a=(c-k)/2,u.width(c-2*a),u.css("left",a),m.removeAttr("style"),s.removeAttr("style")),i>=b?(t.hide(),n&&p.pause()):(t.show(),n?p.resume():o||this._startAnimationLoad())},l.exit=function(){n&&c.instance.destroy(),m&&(m.css("pointer-events","none"),m.cycle("destroy")),p=s=t=q=r=m=null},namespace("LunchLab.pages").HomePage=f}(document,window),function(){var a=LunchLab.dialogs.MagnetDialog,b=function(){this.button=null},c=b.prototype=new Canteen.Page;c.enter=function(){this.button=$("#downloadButton").untouch().touch(this._checkMagnetRequirement.bind(this))},c._checkMagnetRequirement=function(){a.earnRequirementByContent("Recipe",this.button.data("id"),this._onMagnet.bind(this))},c._onMagnet=function(){var a=this.button.attr("href");Modernizr.touch?document.location.href=document.location.protocol+"//"+document.location.hostname+a:($(".download iframe").remove(),this.button.after("<iframe style='display:none' src='"+a+"' id='downloadFile'></iframe>"))},c.exit=function(){this.button.untouch(),this.button=null},namespace("LunchLab.pages").PrintablePage=b}(),function(){var a=LunchLab.players.ProducerPlayer,b=(LunchLab.dialogs.MagnetDialog,LunchLab.pages.PrintablePage),c=function(){this.player=null,this.guid=null,this.button=null},d=c.prototype=new b,e=b.prototype;d.enter=function(){e.enter.call(this),window.scrollTo(0,72),this.guid=$("#videoPlayer").data("media-id"),this.guid&&(this.player=new a({pauseToggleControl:"#playButton"}),this.player.onLoaded=this._onLoaded.bind(this))},d._onLoaded=function(){this.player.player.loadAndPause(this.guid)},d.exit=function(){this.player&&(this.player.destroy(),this.player=null,this.guid=null),e.exit.call(this)},namespace("LunchLab.pages").RecipePage=c}(),function(){function a(a){a=a.originalEvent,c=a.changedTouches[0].screenX,d=a.changedTouches[0].screenY}function b(a){a=a.originalEvent,Math.abs(a.screenX-c)<2&&Math.abs(a.screenY-d)<2&&(a.preventDefault(),a.stopPropagation())}var c,d,e=LunchLab.dialogs.MagnetDialog,f=function(){},g=f.prototype=new Canteen.Page;g.enter=function(){this.site.gateway.get(this._getLoggedIn.bind(this),"kid","is-logged-in"),$(window).off("touchstart",a),$(window).on("touchstart",a),"magnets"!=this.uri?($(".listLink").off("mousedown mouseup",b),$(".listLink").on("mousedown mouseup",b)):(e.earnRequirementByContent("Page",$("#magnetList").data("id"),this.onMagnet.bind(this)),$(".magnetLink").off("mousedown mouseup",b),$(".magnetLink").on("mousedown mouseup",b))},g._getLoggedIn=function(a){"success"!=a.type&&this._showLoginDialog()},g._showLoginDialog=function(){$("#loginContainer").show(),$("#loginButton").touch(this._doLogin.bind(this)),$("#noButton").touch(this._goHome.bind(this))},g._doLogin=function(){PBS.KIDS.identity.signin()},g._goHome=function(){$("#loginButton").untouch(this._doLogin.bind(this)),$("#noButton").untouch(this._goHome.bind(this)),this.site.redirect("")},g.loginCheck=function(){$("#loginButton").untouch(this._doLogin.bind(this)),$("#noButton").untouch(this._goHome.bind(this)),this.site.refresh()},g.onMagnet=function(a){var b;return b=$("img#magnets-visitor"),a&&!b.attr("src").match(/1\./)&&b.attr("src",b.attr("src").replace(".","1.")),b=$("img#first-login"),$("#notifications").data("first-time-login")&&!b.attr("src").match(/1\./)&&b.attr("src",b.attr("src").replace(".","1.")),!0},g.exit=function(){$(window).off("touchstart",a),"magnets"!=this.uri?$(".listLink").off("mousedown mouseup",b):$(".magnetLink").off("mousedown mouseup",b)},namespace("LunchLab.pages").MagnetsPage=f}(),function(){var a=cloudkid.OS,b=LunchLab.animation.CharacterController,c=LunchLab.dialogs.MagnetDialog,d=function(){},e=d.prototype=new Canteen.Page,f=Modernizr.canvas&&Modernizr.audio;e.enter=function(){if(c.earnRequirementByContent("Page",$("#characterFrame").data("id")),window.scrollTo(0,72),f){if(void 0===Canteen.settings.animationsPath)throw"animationsPath needs to be defined in Canteen.settings";var d=Canteen.settings.cdnDomain+Canteen.settings.basePath,e=this.uri.split("/")[1],g=a.init("stage",{fps:30,clearView:!0,basePath:d+Canteen.settings.animationsPath});g.addApp(new b({name:e.replace(/-/g,""),animation:e+".js",audio:e+".json"}))}},e.exit=function(){f&&a.instance.destroy()},namespace("LunchLab.pages").CharacterPage=d}(),function(){var a=LunchLab.players.ProducerPlayer,b=LunchLab.dialogs.MagnetDialog,c=function(){this.player=null,this.frame=null,this.updatingUri=!1,this.categoriesList=null,this.categories=null,this.clearPlaylist=!1,this.currentVideoId=null},d=c.prototype=new Canteen.Page;d.enter=function(){this.updatingUri=!1,this.frame=$("#producerPlayer").addClass("loading"),this.categories={},this.categoriesList=$("#categoryList"),this.categoriesList.find("option").each(e.bind(this)),this.categoriesList.on("change",this._onCategorySelect.bind(this)),this.player=new a({pauseToggleControl:".controlRack .playPause",captionsToggleControl:".controlRack .captions",muteToggleControl:".controlRack .volume",scrubber:".controlRack .scrubber"}),this.player.hasPlaylist=!0,this.player.onLoaded=this._onLoaded.bind(this),this.player.onStart=this._onStart.bind(this)},d._onCategorySelect=function(){var a=this.categoriesList[0];this.site.redirect(a.options[a.selectedIndex].value.split(Canteen.settings.basePath)[1])};var e=function(a){var b=this.categoriesList.find("option"),c=b.eq(a),d=c.data("category"),e=c.data("season"),f=c.attr("value").split(Canteen.settings.basePath)[1];d?this.categories[f]=d:e&&(this.categories[f]=e)};d._onStart=function(a){this.site.gateway.get(this._onVideo.bind(this),"video","get-video-by-media-id",[a])},d._onVideo=function(a){if("error"==a.type||!a.result)return Debug.warn("Invalid video for GUID"),void this.site.redirect("videos");this.currentVideoId=a.result.id;var b="videos/video/"+a.result.uri;this.uri!=b&&(this.updatingUri=!0,this.site.redirect(b))},d._onLoaded=function(){this.frame.removeClass("loading");var a=this.frame.data("guid");this.player.onCompleted=this._videoEnded.bind(this),a?(this.player.play(a),this.clearPlaylist=!0):(this.player.play(),this.clearPlaylist=!1),"none"==$(this.player.options.playerOptions.captionsToggleControl).css("display")&&this.frame.addClass("no-captions")},d._videoEnded=function(){b.earnRequirementByContent("Video",this.currentVideoId),this.clearPlaylist&&(this.player.playlist.refresh(),this.clearPlaylist=!1)},d._switchVideo=function(a){return"error"==a.type?(Debug.error("Invalid video for URL"),void this.site.redirect("videos")):void this.player.playlist.selectItem(a.result.mediaId)},d._switchCategory=function(a){return"error"==a.type?(Debug.error("Invalid video for URL"),void this.site.redirect("videos")):void this.player.play(a.result.join(","))},d.hide=function(){this.player.hide()},d.show=function(){this.player.show()},d.resize=function(){this.player.resize()},d.exit=function(){try{this.player.destroy()}catch(a){Debug.error("Caught error when destroying player: "),Debug.error(a)}this.currentVideoId=this.categories=this.categoryList=this.player=this.frame=null},d.refresh=function(a){if(this.updatingUri)this.updatingUri=!1;else if(/videos\/video\/[a-z0-9A-Z\-]+/.test(a))this.site.gateway.get(this._switchVideo.bind(this),"video","get-video-by-uri",[a.split("/")[2]]);else if(void 0!==this.categories[a]){var b=/\/category\//.test(a)?"get-category-media-ids":"get-season-media-ids";this.site.gateway.get(this._switchCategory.bind(this),"video",b,this.categories[a])}else/^videos(\/)?$/.test(a)&&this.player.play();return!1},namespace("LunchLab.pages").VideoPage=c}(),function(){var a,b,c=LunchLab.dialogs.MagnetDialog,d=function(){},e=d.prototype=new Canteen.Page,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=0,p=null,q=null,r=-1,s=null;e.enter=function(){g=$("body").on("touchend mouseup",this._stopSeek.bind(this)),n=$("#musicPlayer").waypoint("sticky"),h=$("#tracks li"),j=$("#played");var b=Modernizr.touch,c=b?"touchend":"click";i=$("#bar").on(b?"touchstart":"mousedown",this._startSeek.bind(this)),k=$("#nextButton").on(c,this._nextSong.bind(this)),l=$("#prevButton").on(c,this._previousSong.bind(this)),m=$("#playButton").on(c,this._togglePlay.bind(this)),s=$("#videoButton"),"0"==s.data("id")?s.hide():s.attr("href",s.data("href"));var d=$("li.selected");o=h.index(d),a=d.data("trackid"),f=$.media("#audio"),f.ended(this._nextSong.bind(this)),f.time(this._updatePlayhead.bind(this)),this.site.gateway.get(this._getTracks.bind(this),"music","get-music-tracks"),r=-1},e.hide=function(){f&&(-1==r&&(r=f.playing()?1:0),f.pause())},e.show=function(){f&&(1===r&&f.play(),r=-1)},e._getTracks=function(a){q=a.result,p&&(this._onTrackChanged(p),p=null)},e._nextSong=function(b){"ended"==b.type&&c.earnRequirementByContent("MusicTrack",a);var d=o+1==h.length?0:o+1;Canteen.Site.instance.redirect(h.eq(d).data("id"))},e._previousSong=function(){var a=0===o?h.length-1:o-1;Canteen.Site.instance.redirect(h.eq(a).data("id"))},e._togglePlay=function(){f.playing()?this.stop():this.play()},e.stop=function(){m.removeClass("playing").addClass("paused"),f.pause()},e.play=function(){m.removeClass("paused").addClass("playing"),f.play()},e._startSeek=function(a){"touchstart"==a.type&&(b=a.originalEvent.targetTouches[0].identifier),this._seek(a),g.on("mousemove touchmove",this._seek.bind(this))},e._seek=function(a){a.preventDefault();var c;if(a.originalEvent.targetTouches){for(var d=a.originalEvent.targetTouches,e=0;e<d.length;++e)if(d[e].identifier==b){c=d[e].pageX;break}}else c=a.pageX;var g=c-i.offset().left,h=g/i.width(),j=h*f.duration();f.seek(j),this._updatePlayhead()},e._stopSeek=function(){g&&g.off("mousemove touchmove")},e._updatePlayhead=function(){var a=f.time()/f.duration()*100+"%";j.css("width",a),$("#playHead").css("left",a)},e._onTrackChanged=function(a){if(!q)return void(p=a);var b,c;for(c=0;c<q.length;c++)q[c].uri==a&&(b=q[c]);if(!b)throw"No track matching "+a;this.stop(),j.css("width","0%"),b.video?(s.attr("href",Canteen.settings.basePath+"videos/video/"+b.video.uri),s.show()):s.hide(),$("#songThumb").attr("src",b.image),$("#songName").html(b.name),f.off("time ended"),f.remove(),f=new $.mediaAudio([b.ogg+Canteen.settings.cacheBust,b.mp3+Canteen.settings.cacheBust]),f.ended(this._nextSong.bind(this)),f.time(this._updatePlayhead.bind(this)),this.enabled(!0),this.play(),f.playing()||m.removeClass("playing").addClass("paused")},e.refresh=function(b){h.eq(o).removeClass("selected");var c=$("li[data-id='"+b+"']");return a=c.data("trackid"),o=h.index(c),h.eq(o).addClass("selected"),this.enabled(!1),this._onTrackChanged(b.split("/")[1]),!1},e.enabled=function(a){a?(n.removeClass("loading"),k.removeAttr("disabled"),m.removeAttr("disabled"),l.removeAttr("disabled")):(k.attr("disabled",!0),m.attr("disabled",!0),l.attr("disabled",!0),n.addClass("loading"))},e.exit=function(){this._stopSeek(),this.stop();var a=Modernizr.touch,b=a?"touchend":"click";i&&i.off(a?"touchstart":"mousedown"),m.off(b),l.off(b),k.off(b),f&&(f.off("time ended"),f.remove()),s=f=g=h=i=j=k=m=l=n=p=q=null,o=0},namespace("LunchLab.pages").MusicPage=d}(window),function(){var a=function(){this.search=null,this.searchText=null,this.foodFact=null,this.timer=null};a.FACT_TIMEOUT=5e3;var b=a.prototype=new Canteen.Page;b.enter=function(){this.searchText=$("#searchText").keypress(this._onEnter.bind(this)),this.searchGo=$("#searchGo").touch(this._onSubmit.bind(this)),this.searchText.focus(),this.foodFact=$("#foodFact"),this.enableTimer(!0)},b.enableTimer=function(b){this.timer&&(clearTimeout(this.timer),this.timer=null),b&&(this.timer=setInterval(this.randomFact.bind(this),a.FACT_TIMEOUT))},b.randomFact=function(){this.enableTimer(!1),this.site.gateway.get(this.onRandomFact.bind(this),"food-fact","get-random-food-fact")},b.onRandomFact=function(a){if(this.foodFact){var b=a.result;this.foodFact.find(".description").html(b.description),this.foodFact.find(".title").html(b.name),this.foodFact.find("img").attr("src",b.image+Canteen.settings.cacheBust),"success"==a.type&&this.enableTimer(!0)}},b._onSubmit=function(){var a=this.searchText.val();a&&this.site.redirect("food/search/"+a)},b._onEnter=function(a){var b=a.charCode?a.charCode:a.which;13==b&&this._onSubmit()},b.exit=function(){this.enableTimer(!1),this.foodFact=null,this.searchGo.untouch(),this.searchGo=null,this.searchText.off("keypress"),this.searchText=null},namespace("LunchLab.pages").FoodPage=a}(),function(a){var b=function(){this.player=null,this.options={}},c=b.prototype=new Canteen.Page;c.constructor=b,c.enter=function(){window.scrollTo(0,72);var b=$("#gameContent"),c={id:"gameContent",width:b.data("game-width"),height:b.data("game-height"),gameId:b.data("game-id"),name:b.data("name")};if($.extend(c,this.options),b.data("is-flash")&&a.flash)this.player=new LunchLab.players.FlashGamePlayer(c);else if(b.data("is-html")&&a.canvas&&a.audio){if(b.data("is-webaudio")&&!a.webaudio)return void this.site.redirect("games");this.player=new LunchLab.players.HTML5GamePlayer(c)}else this.site.redirect("games")},c.hide=function(){this.player.hide()},c.show=function(){this.player.show()},c.loginCheck=function(){this.player.loginCheck()},c.resize=function(){if(this.player){var a=494/869,b=$("#game .frame");""===$("#game").data("aspect")&&b.css("padding-bottom",100*a+"%");var c=$("#game");c.css("width","inherit"),$(window).width()>600?(c.css("margin","0 12px"),b.css("margin-top","21px")):(c.css("margin","0"),b.css("margin-top","10px"));var d=$(window).height(),e=c.height(),f=$("#game .frame .topBar");if(f.show(),e>d){$(window).width()<600&&(f.hide(),b.css("margin-top","0"));var g;g=""!==c.data("aspect")?c.data("aspect")/100:a;var h=$("#gameContent").height();if(0===h)return;var i=e-h;c.width((d-i)/g),c.css("margin","0 auto")}}},c.exit=function(){this.player&&this.player.destroy()},namespace("LunchLab.pages").GamePage=b}(Modernizr),function(){var a=LunchLab.pages.GamePage,b=function(){d.constructor.call(this)},c=b.prototype=new a,d=a.prototype;c.enter=function(){var a=Canteen.settings,b=window.location.href.split("my-kitchen/");this.options={flashVars:{baseShareUrl:"http:"+a.host+a.basePath+"my-kitchen/",share:b[1]}},d.enter.call(this)},namespace("LunchLab.pages").MyKitchenPage=b}(),function(){var a=function(){},b=a.prototype=new Canteen.Page;b.enter=function(){window.scrollTo(0,72)},namespace("LunchLab.pages").ContactPage=a}(),function(){var a=function(){},b=a.prototype=new Canteen.Page;b.enter=function(){window.scrollTo(0,72),$("h2.toggler").touch(function(){$(this).toggleClass("selected"),$(this).next().slideToggle("slow")})},b.exit=function(){$("h2.toggler").untouch()},namespace("LunchLab.pages").CreditsPage=a}(),function(a,b){var c=function(a){i=i||cloudkid.SavedData,j=j||LunchLab.utils.ServiceCall,a&&(this.id=a.id,this.width=a.width,this.height=a.height,this.name=a.name,this.gameId=a.gameId||0,this.options=a,this.dom=null,this.listenerJQ=null,this.container=$("#game"),this.isGameLoaded=!1,this.captionsButton=new l("captionsButton",this.onCaptionsButton.bind(this)),this.musicButton=new l("musicButton",this.onMusicButton.bind(this)),this.effectsButton=new l("effectsButton",this.onEffectsButton.bind(this)),null===i.read(e)?(i.write(e,!0),i.write(f,!1),i.write(g,!1),this.captionsButton.setChecked(!1),this.musicButton.setChecked(!0),this.effectsButton.setChecked(!0)):(this.captionsButton.setChecked(!i.read(e)),this.musicButton.setChecked(!i.read(f)),this.effectsButton.setChecked(!i.read(g))))},d=c.prototype={},e="LLGameCaptionsMuted",f="LLGameMusicMuted",g="LLGameEffectsMuted";d.constructor=c;var h=a.GA_obj||null,i=null,j=null;d.destroy=function(){a.PBS&&a.PBS.KIDS&&a.PBS.KIDS.$_auth&&PBS.KIDS.$_auth("body").off("cbox_closed",this.onLoginBoxClosed),this.timeoutId&&clearInterval(this.timeoutId),this.captionsButton.destroy(),this.musicButton.destroy(),this.effectsButton.destroy();var b=this.listenerJQ;b&&(b.off("gameLoaded",this._loadComplete),b.off("kid-is-logged-in",this._getUser),b.off("game-save",this._saveData),b.off("kid-get-kid-saves-by-game",this._loadData),b.off("kid-award-kid-points",this._earnPoints),b.off("magnet-earn-requirement",this._earnMagnet)),this._loadComplete=this._getUser=this._saveData=this._loadData=this._earnPoints=this._earnMagnet=null,this.options=this.container=this.dom=this.listenerJS=this.width=this.height=this.id=this.name=this.captionsButton=this.musicButton=this.effectsButton=null},d.addListeners=function(){var a=this.listenerJQ;this._loadComplete=this._loadComplete.bind(this),this._getUser=this._getUser.bind(this),this._saveData=this._saveData.bind(this),this._loadData=this._loadData.bind(this),this._earnPoints=this._earnPoints.bind(this),this._earnMagnet=this._earnMagnet.bind(this),a.on("gameLoaded",this._loadComplete),a.on("kid-is-logged-in",this._getUser),a.on("game-save",this._saveData),a.on("kid-get-kid-saves-by-game",this._loadData),a.on("kid-award-kid-points",this._earnPoints),a.on("magnet-earn-requirement",this._earnMagnet)
},d.sendMessage=function(){},d.doCallback=function(a,c){if(a)if("string"==typeof a){var d={callback:a};c!==b&&(d.data=c),this.sendMessage(d)}else c!==b?a(c):a()},d._loadComplete=function(a){this.isGameLoaded=!0,this.restoreMuteSettings(),this.container.removeClass("loading"),this.doCallback(a.callback)},d._getUser=function(a){j.create().get("kid/is-logged-in",this.doCallback.bind(this,a.callback))},d._saveData=function(a){j.create().post("LunchLab\\Forms\\GameSaveForm",null,{gameid:a.gameId,save:JSON.stringify(a.save)})},d._loadData=function(a){j.create().get("kid/get-kid-saves-by-game",k.bind(this,this.doCallback.bind(this,a.callback)),a.gameId)},d._earnPoints=function(a){LunchLab.dialogs.CoinDialog.awardKidPoints(a.coinEventAlias)},d._earnMagnet=function(a){LunchLab.dialogs.MagnetDialog.earnRequirement(a.magnetRequirement)};var k=function(a,b){a&&a(b?JSON.parse(b.data):null)};d.loginCheck=function(){throw"loginCheck needs to be implemented"},d.setMusicMuted=function(){throw"Player must implement setMusicMuted"},d.setEffectsMuted=function(){throw"Player must implement setEffectsMuted"},d.setCaptionsMuted=function(){throw"Player must implement setCaptionsMuted"},d.hide=function(){throw"Player must implement hide method"},d.show=function(){throw"Player must implement show method"},d.restoreMuteSettings=function(){this.setCaptionsMuted(i.read(e)),this.setMusicMuted(i.read(f)),this.setEffectsMuted(i.read(g))},d.onCaptionsButton=function(a){this.setCaptionsMuted(!a),i.write(e,!a)},d.onMusicButton=function(a){this.setMusicMuted(!a),i.write(f,!a)},d.onEffectsButton=function(a){this.setEffectsMuted(!a),i.write(g,!a)},d.trackEvent=function(a,b,c,d){Canteen.settings.debug||(h?h.trackEvent(a,b,c,d):Debug.error("There's no valid GA_obj"))};var l=function(a,b){var c=this.button=$("#"+a),d=!1;this.getChecked=function(){return d};var e=this.setChecked=function(a){d=a,c.removeClass("checked"),d&&c.addClass("checked")};this.button.touch(function(){e(!d),b(d)}),this.destroy=function(){this.button.untouch(),this.getChecked=null,this.setChecked=null,this.destroy=null}};namespace("LunchLab.players").GamePlayer=c}(window),function(){var a=org.pbskids.swfobject2_2,b=function(a){d.constructor.call(this,a),this.content=null,this.initialize()},c=b.prototype=new LunchLab.players.GamePlayer,d=LunchLab.players.GamePlayer.prototype,e=null;Object.defineProperty(b,"instance",{get:function(){return e}}),c.initialize=function(){e=this;var b=Canteen.settings.basePath,c=void 0!==Canteen.settings.cacheBust?Canteen.settings.cacheBust:"",d={local:Canteen.settings.local,debug:Canteen.settings.debug,cacheBust:Canteen.settings.debug,versions:b+"assets/txt/versions.txt",basePath:b,gateway:"http:"+Canteen.settings.host+b+"amf.php",folder:this.name,trackEvent:"LunchLab.players.FlashGamePlayer.instance.trackEvent",gameId:this.gameId,gameBaseUrl:b+Canteen.settings.gamesPath,siteUrl:"http:"+Canteen.settings.baseUrl,showLoginCall:"PBS.KIDS.identity.signin",callbackObject:"LunchLab.players.FlashGamePlayer.instance"};$.extend(d,this.options.flashVars);var f={wmode:"opaque",allowScriptAccess:"always",id:this.id,bgcolor:"#000000",menu:"false"};a.embedSWF(b+"assets/swfs/LunchLab.swf"+c,this.id,"100%","100%","10.0.0","",d,f,{id:this.id},this.onSwfEmbedded.bind(this))},c.loadComplete=function(){this.listenerJQ.trigger("gameLoaded"),this.listenerJQ.resize()},c.loadProgress=function(a){this.listenerJQ.trigger({type:"loadProgress",amount:a})},c.awardKidPoints=function(a){this.listenerJQ.trigger({type:"kid-award-kid-points",coinEventAlias:a})},c.earnRequirement=function(a){this.listenerJQ.trigger({type:"magnet-earn-requirement",magnetRequirement:a})},c.onSwfEmbedded=function(){this.content=$("#"+this.id).attr("width",this.width).attr("height",this.height),this.dom=this.content.get(0),this.listenerJQ=$(this.dom.parentNode),this.addListeners(),0===this.content.height()&&setTimeout(this.listenerJQ.resize.bind(this.listenerJQ),100)},c.loginCheck=function(){this.dom.loginCheck&&this.dom.loginCheck()},c.setMusicMuted=function(a){this.isGameLoaded&&this.dom.setMusicMuted(a)},c.setEffectsMuted=function(a){this.isGameLoaded&&this.dom.setEffectsMuted(a)},c.setCaptionsMuted=function(a){this.isGameLoaded&&this.dom.setCaptionsMuted(a)},c.show=function(){this.dom.show()},c.hide=function(){this.dom.hide()},c.destroy=function(){this.content=null,d.destroy.call(this)},namespace("LunchLab.players").FlashGamePlayer=b}(),function(){var a=function(a){c.constructor.call(this,a),this.messageReceiver=this.messageReceiver.bind(this),this.initialize()},b=a.prototype=new LunchLab.players.GamePlayer,c=LunchLab.players.GamePlayer.prototype;b.initialize=function(){var a=Canteen.settings,b=a.basePath+a.gamesPath+this.name+"/index.html";$("#"+this.id).append("<iframe id='"+this.id+"_frame' scrolling='no' src='"+b+"'></iframe>");var c=document.getElementById(this.id+"_frame");this.dom=c.contentWindow||c,this.dom.hasLunchLabSite=!0,this.dom.LLSiteWindow=$(this.dom);var d=$("#"+this.id),e=$(c);this._resizeFunc=function(){e.width(d.width()),e.height(d.height())},d.on("resize",this._resizeFunc),e.width(d.width()),e.height(d.height()),window.addEventListener("message",this.messageReceiver)},b.sendMessage=function(a){this.dom.postMessage(a,"*")},b.messageReceiver=function(a){var b=a.data;if("LL_Game_Lib"==b)this.dom.postMessage("In_LL_Site","*");else switch(b.type){case"gameLoaded":this._loadComplete(b);break;case"loadProgress":this._loadProgress(b);break;case"kid-is-logged-in":this._getUser(b);break;case"game-save":this._saveData(b);break;case"kid-get-kid-saves-by-game":this._loadData(b);break;case"kid-award-kid-points":this._earnPoints(b);break;case"magnet-earn-requirement":this._earnMagnet(b)}},b.loginCheck=function(){this.sendMessage({type:"loginCheck"})},b.setMusicMuted=function(a){this.isGameLoaded&&this.sendMessage({type:"muteChange",context:"music",mute:a})},b.setEffectsMuted=function(a){this.isGameLoaded&&this.sendMessage({type:"muteChange",context:"sfx",mute:a})},b.setCaptionsMuted=function(a){this.isGameLoaded&&this.sendMessage({type:"muteChange",context:"captions",mute:a})},b.hide=function(){this.isGameLoaded&&this.sendMessage({type:"pause"})},b.show=function(){this.isGameLoaded&&this.sendMessage({type:"unpause"})},b.getContent=function(){return this.dom||(this.dom=$("#"+this.id).get(0)),this.dom},b.destroy=function(){$("#"+this.id).off("resize",this._resizeFunc),this._resizeFunc=null,c.destroy.call(this),window.removeEventListener("message",this.messageReceiver),this.messageReceiver=null},namespace("LunchLab.players").HTML5GamePlayer=a}(),$(function(){var a=include("Canteen.Site",!1);if(!a.instance)throw"Canteen Site isn't setup";var b=a.instance,c=include("org.pbskids.swfobject2_2"),d=include("LunchLab.pages"),e=(include("LunchLab.dialogs.MagnetDialog"),include("LunchLab.dialogs.CoinDialog"),include("Modernizr")),f=include("LunchLab.dialogs.DialogManager"),g=include("GA_obj",!1);if(e.addTest("flash",c.hasFlashPlayerVersion("10.0.0")),e.addTest("webaudio","webkitAudioContext"in window||"AudioContext"in window),void 0!==Canteen.Pages){var h=Canteen.Pages.AdminPage;b.addPage(/^admin\/games(\/.*)?$/,new h("#game_name","#game_uri")),b.addPage(/^admin\/printables(\/.*)?$/,new h("#printable_name","#printable_uri")),b.addPage(/^admin\/music(\/.*)?$/,new h("#musictrack_name","#musictrack_uri")),b.addPage(/^admin\/recipes(\/.*)?$/,new h("#recipe_shortName","#recipe_uri")),b.addPage(/^admin\/videos(\/.*)?$/,new h("#video_title","#video_uri")),b.addPage(/^admin\/magnets(\/.*)?$/,new h("#magnet_name","#magnet_uri"))}b.addPage(/^food(\/(tag|search)\/.*)?$/,new d.FoodPage),b.addPage(/^food\/recipe\/.+$/,new d.RecipePage),b.addPage(/^printables\/.+$/,new d.PrintablePage),b.addPage(/^magnets(\/.+)?$/,new d.MagnetsPage),b.addPage(/^games\/.+$/,new d.GamePage),b.addPage(/^my\-kitchen(\/.+)?$/,new d.MyKitchenPage),b.addPage(/^music\/.+$/,new d.MusicPage),b.addPage(/^characters\/.+$/,new d.CharacterPage),b.addPage(/^videos(\/(category|video|season)\/.+)?$/,new d.VideoPage),b.addPage("credits",new d.CreditsPage),b.addPage("contact-us",new d.ContactPage),b.addPage("",new d.HomePage),f.init(),a.prototype.loginCheck=function(){this.gateway.get(function(a){a&&(a.created==a.lastLogin&&LunchLab.dialogs.MagnetDialog.firstTimeLogin(),LunchLab.dialogs.MagnetDialog.onLogin(),LunchLab.dialogs.CoinDialog.onLogin())},"kid","is-logged-in")},b.on("enter",function(){if($("input[data-restrict]").keypress(function(){var a=new RegExp("^["+$(this).data("restrict")+"]+$"),b=String.fromCharCode(event.charCode?event.charCode:event.which);return a.test(b)?void 0:(event.preventDefault(),!1)}),!e.svg){var a=/\.svg(z)?(\?.+)?$/;$("img").each(function(){Debug.log("an image!!: "+this.src);var b=$(this),c=this.src;if(c.match(a)){var d=b.data("fallback")||"png";b.attr("src",c.replace(a,"."+d))}})}LunchLab.utils.SupportUtils.clean()}).on("exit",function(){$("input[data-restrict]").off("keypress")}).on("loadingDone",function(){var a=b.currentState,c=Canteen.settings.basePath;c+=Canteen.settings.siteIndex==a?"":a,g&&g.trackPageview(c)}),$(window).on("show.visibility",function(){var a=b.currentPage;a&&$.isFunction(a.show)&&a.show()}).on("hide.visibility",function(){var a=b.currentPage;a&&$.isFunction(a.hide)&&a.hide()}),window.trackerCall=null,window.pushEvent=null,window.getCurrentUser=null,window.isAnonymousUser=function(){return!Canteen.settings.local}});