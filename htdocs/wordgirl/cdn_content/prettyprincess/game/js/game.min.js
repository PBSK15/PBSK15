/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Math.map=function(x,istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((x-istart)/(istop-istart));};Math.limit=function(x,min,max){return Math.min(max,Math.max(min,x));};Math.roundAt=function(x,precision){if(!precision)return Math.round(x);precision=Math.pow(10,precision||0);return Math.round(x*precision)/precision;};Math.toInt=function(x){return(x|0);};Math.toRad=function(x){return((x*Math.PI)/180);};Math.toDeg=function(x){return((x*180)/Math.PI);};Math.getRandomArbitrary=function(min,max){return Math.random()*(max-min)+min;};Math.range=function(min,max){return Math.floor(Math.random()*(max-min+1))+min;};Object.defineProperty(Array.prototype,'erase',{value:function(item){var i=this.indexOf(item);if(i>=0)this.splice(i,1);return this;}});Object.defineProperty(Array.prototype,'random',{value:function(){return this[0|(Math.random()*this.length)];}});Object.defineProperty(Array.prototype,'shuffle',{value:function(){var i=this.length,j,temp;if(i===0)return this;while(--i){j=Math.floor(Math.random()*(i+1));temp=this[i];this[i]=this[j];this[j]=temp;}
return this;}});Object.defineProperty(Array.prototype,'clone',{value:function(){return this.slice(0);}});Function.prototype.bind=Function.prototype.bind||function(object){var t=this;return function(){return t.apply(object,arguments);};};window.ig={main:null,debug:null,version:'1.23',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'js/lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector[0]=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:document.createElement.bind(document),copy:function(object){var c,i;if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(Array.isArray(object)){c=object.slice(0);for(i=0;i<c.length;i++){if(c[i]&&typeof(c[i])=='object'){c[i]=ig.copy(c[i]);}}
return c;}
else{c={};for(i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class||ext===null){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var k in obj){keys.push(k);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr[0].toUpperCase()+attr.substr(1);el[attr]=val||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},getVendorAttribute:function(el,attr){var uc=attr[0].toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},external:function(){var externalRequires=Array.prototype.slice.call(arguments);for(var i=0;i<externalRequires.length;i++){if(!ig.modules[name])ig._loadScript(externalRequires[i]);}
return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(msg){if(this.debug&&window.console&&console.log){console.log(msg);}},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};script.src=path;ig.$('head')[0].appendChild(script);},_execModules:function(){var i,j,m,modulesLoaded=false;for(i=0;i<ig._loadQueue.length;i++){m=ig._loadQueue[i];var dependenciesLoaded=true;for(j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload===0&&ig._loadQueue.length!==0){var unresolved=[];for(i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(j=0;j<requires.length;j++){m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw('Unresolved (circular?) dependencies. '+"Most likely there's a name/path mismatch for one of the listed modules:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.small=!(window.innerWidth>=768&&window.innerHeight>=768);ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPod=/iPod/i.test(navigator.userAgent);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.kindle=/Silk/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad||ig.ua.iPod;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||ig.ua.kindle||/mobile/i.test(navigator.userAgent);ig.ua.touchDevice=(('ontouchstart'in window)||(window.navigator.msMaxTouchPoints));},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}};var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){this.parent=parent[name];return fn.apply(this,arguments);};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){this.parent=parent[name];return fn.apply(this,arguments);};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;return Class;};})(window);

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,tick:0,delegate:null,stages:[],numStages:0,init:function(fps,width,height){if(!window.createjs){throw("CreateJS is not included");}
this.resize(width,height);this.fps=fps;createjs.Ticker.timingMode=createjs.Ticker.RAF;createjs.Ticker.addEventListener("tick",this.run.bind(this));},addStage:function(stage){stage.canvas.width=this.width;stage.canvas.height=this.height;this.stages.push(stage);this.numStages=this.stages.length;return stage;},resize:function(width,height){this.width=width;this.height=height;for(var i=0;i<this.numStages;i++){this.stages[i].canvas.width=this.width;this.stages[i].canvas.height=this.height;this.stages[i].update();}},setGame:function(GameClass){ig.main=new(GameClass)();this.delegate=ig.main;},run:function(event){this.tick=event.delta/1000;if(this.delegate){this.delegate.update(event);ig.input.clearPressed();}
for(var i=0;i<this.numStages;i++){var stage=this.stages[i];if(stage.stopUpdate)continue;stage.update(event);}}});});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},numTouches:0,initMouse:function(stage){if(this.isUsingMouse){return;}
this.isUsingMouse=true;stage.on("stagemousedown",this.keydown.bind(this));stage.on("stagemouseup",this.keyup.bind(this));stage.on("stagemousemove",this.mousemove.bind(this));if(ig.ua.mobile&&cjs.Touch.isSupported()){cjs.Touch.enable(stage);stage.enableDOMEvents(false);}},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},mousemove:function(event){if(!event.primary){return;}
this.mouse.x=event.stageX;this.mouse.y=event.stageY;},keydown:function(event){var nativeEvent=event.nativeEvent||event;var tag=nativeEvent.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=nativeEvent.type=='keydown'?nativeEvent.keyCode:(nativeEvent.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='stagemousedown'){if(nativeEvent.touches){this.numTouches=nativeEvent.touches.length;}
if(event.primary)
this.mousemove(event);else
return;}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;if(code!==ig.KEY.MOUSE1&&code!==ig.KEY.MOUSE2){event.stopPropagation();event.preventDefault();}}}},keyup:function(event){var nativeEvent=event.nativeEvent||event;var tag=nativeEvent.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=nativeEvent.type=='keyup'?nativeEvent.keyCode:(nativeEvent.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(nativeEvent.touches){this.numTouches=nativeEvent.touches.length;if(!event.primary){return;}}
var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;if(code!==ig.KEY.MOUSE1&&code!==ig.KEY.MOUSE2){event.stopPropagation();event.preventDefault();}}},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return!!this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.system','impact.input').defines(function(){"use strict";ig.main=function(gameClass,fps,width,height){ig.system=new ig.System(fps,width,height);ig.input=new ig.Input();ig.ready=true;ig.system.setGame(gameClass);};});

// lib/display/background-stars.js
ig.baked=true;ig.module('display.background-stars').defines(function(){ig.BackgroundStars=ig.Class.extend({starField0:null,starField1:null,init:function(){ig.LAYERS.STARS.set({x:ig.system.width/2,y:ig.system.height/2,mousechildren:false,mouseEnabled:false});this.starField0=new cjs.Bitmap(ig.main.preQueue.getResult("loaderSparkles")).set({regX:415,regY:224,rotation:45,angluarSpeed:30});ig.LAYERS.STARS.addChild(this.starField0);this.starField1=new cjs.Bitmap(ig.main.preQueue.getResult("loaderSparkles")).set({regX:415,regY:224,rotation:135,angluarSpeed:-30});ig.LAYERS.STARS.addChild(this.starField1);},update:function(){for(var i=0;i<2;i++){var star=ig.LAYERS.STARS.children[i];star.rotation+=star.angluarSpeed*ig.system.tick;if(star.rotation>360){star.rotation-=360;}else if(star.rotation<0){star.rotation+=360;}}}});});

// lib/impact/main.js
ig.baked=true;ig.module('impact.main').requires('impact.impact').defines(function(){"use strict";ig.Main=ig.Class.extend({staticInstantiate:function(){ig.main=this;return null;},update:function(event){}});});

// lib/display/preloader.js
ig.baked=true;ig.module('display.preloader').requires('impact.main').defines(function(){ig.Preloader=ig.Class.extend({BAR_WIDTH:168,BAR_HEIGHT:16,queue:null,starSpeeds:[246,200,115,90,70],init:function(){ig.LAYERS.PRELOADER.x=ig.system.width/2;ig.LAYERS.PRELOADER.y=ig.system.height/2;var PRELOADER=ig.LAYERS.PRELOADER;PRELOADER.mousechildren=false;PRELOADER.mouseEnabled=false;this.starContainer=new cjs.Container();var nStars=10;for(var i=0;i<nStars;i++){var scale=Math.getRandomArbitrary(0.2,0.35);var aSpeed=this.starSpeeds.shift();if(i%2===0)aSpeed*=-1;this.starContainer.addChild(new cjs.Bitmap(ig.main.preQueue.getResult("star")).set({regX:400,scaleX:scale,scaleY:scale,rotation:i*360/nStars,angluarSpeed:aSpeed}));this.starSpeeds.push(aSpeed);}
PRELOADER.addChild(this.starContainer);this.backShape=new cjs.Shape().set({y:58});this.backShape.graphics.f("#FFF").rr(-this.BAR_WIDTH*0.5,-this.BAR_HEIGHT*0.5,this.BAR_WIDTH,this.BAR_HEIGHT,this.BAR_HEIGHT/2);PRELOADER.addChild(this.backShape);this.fillShape=new cjs.Shape().set({y:58});PRELOADER.addChild(this.fillShape);this.frontShape=new cjs.Shape().set({y:58});this.frontShape.graphics.ss(3).s("#C39").rr(-this.BAR_WIDTH*0.5,-this.BAR_HEIGHT*0.5,this.BAR_WIDTH,this.BAR_HEIGHT,this.BAR_HEIGHT/2);PRELOADER.addChild(this.frontShape);this.horse=new cjs.Bitmap(ig.main.preQueue.getResult("loaderHorse")).set({regX:53,regY:53});PRELOADER.addChild(this.horse);},update:function(){var w=this.BAR_WIDTH-2;var h=this.BAR_HEIGHT-2;if(!this.queue)
return;this.fillShape.graphics.c().f("#F9C").rr(-w*0.5,-h*0.5,w*this.queue.progress,h,h/2);for(var i=0;i<this.starContainer.children.length;i++){var star=this.starContainer.children[i];star.rotation+=star.angluarSpeed*ig.system.tick;if(star.rotation>360){star.rotation-=360;}else if(star.rotation<0){star.rotation+=360;}}}});});

// lib/controllers/transition.js
ig.baked=true;ig.module('controllers.transition').defines(function(){ig.TransitionController=ig.Class.extend({tailShape:null,sparkleCont:null,starCont:null,_starPool:[],_sparklePool:[],_spawnTimer:0,_spawnInterval:0.1,_isAnimating:false,init:function(){if(ig.TransitionControl!==null){console.error("You do not instantiate this class!");return;}
ig.TransitionControl=this;},build:function(){var CTNR=ig.LAYERS.TRANSITION;CTNR.set({mouseChildren:false,mouseEnabled:false,x:ig.system.width*0.5,y:ig.system.height*0.5,visible:false});this.tailShape=new cjs.Shape();this.tailShape.graphics.c().f("#E8D2E7").mt(-430,-90).lt(430,-90).lt(636,1330).lt(-636,1330).cp();CTNR.addChild(this.tailShape);var q=ig.main.mainQueue;CTNR.addChild(new cjs.Bitmap(q.getResult("transitionHeart")).set({regX:429,regY:356}));this.sparkleCont=CTNR.addChild(new cjs.Container());this.starCont=CTNR.addChild(new cjs.Container().set({y:-100}));CTNR.addChild(new cjs.Bitmap(q.getResult("transitionPrincess")).set({regX:205,regY:288}));this.buildStarPool();this.buildSparklePool();},buildStarPool:function(){var j=0;for(var i=0;i<8;i++){var c=new cjs.Container();var star=new cjs.Bitmap(ig.main.preQueue.getResult("star")).set({regX:75,regY:71,scaleX:0.5,scaleY:0.5,});c.addChild(star);c.scaleX=i%2===0?1:-1;if(i%2===0&&i!==0)j++;c.rotation=-60+(90/4)*j;if(c.scaleX===-1)c.rotation+=52;star.tween=cjs.Tween.get(star,{loop:true,paused:true}).wait(i*200).to({guide:{path:[0,0,-70,350,-600,-530]},rotation:720,scaleX:1,scaleY:1},1600,cjs.Ease.quadOut);this.starCont.addChild(c);this._starPool.push(star);}},buildSparklePool:function(){for(var i=0;i<12;i++){var sparkle=new cjs.Bitmap(ig.main.preQueue.getResult("sparkle")).set({regX:25,regY:25});this._sparklePool.push(sparkle);}},addNewSparkle:function(){var angle=Math.random()*Math.PI*2;if(angle<0.8||angle>Math.PI*2)
angle-=Math.PI;if(!this._sparklePool.length){ig.log("Increase pool!");return;}
var sparkle=this._sparklePool.pop();sparkle.set({x:0,y:0,vx:500*Math.sin(angle),vy:500*Math.cos(angle),alpha:1});this.sparkleCont.addChild(sparkle);},returnSparkle:function(s){this.sparkleCont.removeChild(s);this._sparklePool.push(s);},update:function(){if(!this._isAnimating){return;}
for(var i=0;i<this.sparkleCont.children.length;i++){var s=this.sparkleCont.children[i];s.x+=s.vx*ig.system.tick;s.y+=s.vy*ig.system.tick;s.alpha-=ig.system.tick;s.rotation+=300*ig.system.tick;if(s.rotation>360){s.rotation-=360;}
var starPoint=s.localToGlobal(0,0);if(s.alpha<0||starPoint.x<0||starPoint.x>ig.system.width||starPoint.y<0||starPoint.y>ig.system.height*4){this.returnSparkle(s);}}
this._spawnTimer+=ig.system.tick;if(this._spawnTimer>this._spawnInterval){this._spawnTimer-=this._spawnInterval;this.addNewSparkle();}},animateUp:function(readyCallback){cjs.Sound.play("sfx_fw_chimes1");this._isAnimating=true;this.tailShape.alpha=1;ig.LAYERS.TRANSITION.y=ig.system.height*1.5;cjs.Tween.get(ig.LAYERS.TRANSITION).set({visible:true}).to({y:-400},3000).call(readyCallback,[true]).call(this.endAnimate,null,this);for(var i=0;i<8;i++){this._starPool[i].tween.setPaused(false);}},endAnimate:function(){this._isAnimating=false;for(var i=0;i<8;i++){this._starPool[i].tween.setPaused(true);}
this.sparkleCont.removeAllChildren();cjs.Tween.get(this.tailShape).to({alpha:0},800,cjs.Ease.quadInOut).call(this.reset,[false],this);},reset:function(visible){ig.LAYERS.TRANSITION.visible=false;ig.LAYERS.TRANSITION.y=ig.system.height/2+ig.system.height*2;}});ig.TransitionControl=null;new ig.TransitionController();});

// lib/display/screen.js
ig.baked=true;ig.module('display.screen').defines(function(){ig.Screen=ig.Class.extend({init:function(){},start:function(){this.setActive(true);},update:function(){},setActive:function(active){},kill:function(){}});});

// lib/display/screens/title.js
ig.baked=true;ig.module('display.screens.title').requires('display.screen').defines(function(){ig.Screen.Title=ig.Screen.extend({container:null,playBtn:null,init:function(){var ctnr=this.container=new cjs.Container();var q=ig.main.mainQueue||ig.main.preQueue;var titleImage=new cjs.Bitmap(q.getResult("titleImage")).set({x:-25,y:-3,mouseEnabled:false});ig.CenterReg(titleImage);ctnr.addChild(titleImage);var playBtn=new cjs.Bitmap(q.getResult("titlePlayBtn")).set({y:229,scaleX:0,scaleY:0,visible:false,mouseEnabled:false,cursor:"pointer"});ig.CenterReg(playBtn);ctnr.addChild(playBtn);playBtn.on("click",this.btnHandler,this);if(ig.ua.mobile){playBtn.on("mousedown",this.btnHandler,this);playBtn.on("pressup",this.btnHandler,this);}else{playBtn.on("mouseover",this.btnHandler,this);playBtn.on("mouseout",this.btnHandler,this);}
this.playBtn=playBtn;if(ig.ua.iPod||ig.ua.iPhone){ctnr.scaleX=ctnr.scaleY=0.8;}
ig.LAYERS.SCREENS.addChild(ctnr);},start:function(){cjs.Sound.play("prettyprincess_title");cjs.Tween.get(this.playBtn).set({visible:true,mouseEnabled:false}).to({scaleX:0.85,scaleY:0.85},500,cjs.Ease.backOut).set({mouseEnabled:true});this.parent();},setActive:function(active){this.playBtn.mouseEnabled=active;},btnHandler:function(e){var btn=e.target;if(!btn)return;var ease=cjs.Ease.cubicOut;switch(e.type){case"click":cjs.Sound.play("sfx_click");ig.main.onPlayClick();break;case"mouseover":cjs.Sound.play("prettyprincess_play",cjs.Sound.INTERRUPT_NONE);cjs.Tween.get(this.playBtn,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(this.playBtn,{override:true}).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":cjs.Sound.play("prettyprincess_play");btn.scaleX=0.8;btn.scaleY=0.8;break;case"pressup":btn.scaleX=0.85;btn.scaleY=0.85;break;}},kill:function(){this.playBtn.removeAllEventListeners();ig.LAYERS.SCREENS.removeChild(this.container);}});});

// lib/display/screens/character-select.js
ig.baked=true;ig.module('display.screens.character-select').requires('display.screen').defines(function(){ig.Screen.CharacterSelect=ig.Screen.extend({container:null,tickTime:0,anims:[],_startSound:null,init:function(){this._buildGraphics();},_buildGraphics:function(){var ctnr=this.container=new cjs.Container().set({mouseEnabled:false,mouseChildren:false});var banner=new cjs.Sprite(ig.SHEETS.MAIN,"ChooseHero").set({y:-229,mouseEnabled:false});ig.CenterReg(banner);ctnr.addChild(banner);var characters=[ig.CHARACTERS.BECKY,ig.CHARACTERS.TJ,ig.CHARACTERS.VIOLET];var classes=[PPAnims.characterSelect.BeckyCharacter,PPAnims.characterSelect.TJCharacter,PPAnims.characterSelect.VioletCharacter];for(var i=0;i<3;i++){var c=new cjs.Container().set({name:characters[i].toLowerCase(),cursor:"pointer",x:-250+i*250,y:62,mouseChildren:false});c.addChild(new cjs.Sprite(ig.SHEETS.MAIN,"ChooseHeroWindow").set({regX:116,regY:206}));var CharacterAnim=classes[i];this.anims.push(c.addChild(new CharacterAnim().set({name:"anim",y:-10,framerate:24})));var namePlaque=new cjs.Container().set({name:"name",scaleX:0.85,scaleY:0.85,x:2,y:-206});namePlaque.addChild(new cjs.Sprite(ig.SHEETS.MAIN,"BlankPlaque").set({regX:78,regY:40}));namePlaque.addChild(this.makeCenteredBitmapText(c.name));ig.FastCache(namePlaque);c.addChild(namePlaque);c.on("click",this.btnHandler,this);if(ig.ua.mobile){c.on("mousedown",this.btnHandler,this);c.on("pressup",this.btnHandler,this);}else{c.on("mouseover",this.btnHandler,this);c.on("mouseout",this.btnHandler,this);}
ctnr.addChild(c);}
ig.LAYERS.SCREENS.addChild(ctnr);},start:function(){this._startSound=cjs.Sound.play("prettyprincess_chooseahero");this.parent();},setActive:function(active){this.container.mouseChildren=this.container.mouseEnabled=active;},makeCenteredBitmapText:function(textString){var bmpText=new cjs.BitmapText(textString,ig.SHEETS.HOUSEARAMA_22).set({letterSpacing:-3});var b=bmpText.getBounds();bmpText.regX=Math.round(b.width*0.5)+3;bmpText.regY=Math.round(b.height*0.5)+1;return bmpText;},btnHandler:function(e){var btn=e.target;if(!btn)return;var name=btn.getChildByName("name");var anim=btn.getChildByName("anim");var ease=cjs.Ease.cubicOut;switch(e.type){case"click":cjs.Sound.play("sfx_click");ig.Session.character=btn.name;if(ig.ua.mobile){cjs.Sound.play("prettyprincess_"+btn.name);anim.gotoAndPlay("wave");cjs.Tween.get(this).wait(1000).call(ig.ScreenControl.goto,[ig.SCREENS.PATH_SELECT],ig.ScreenControl);}else{ig.ScreenControl.goto(ig.SCREENS.PATH_SELECT);}
this.setActive(false);break;case"mouseover":if(this._startSound.playState===cjs.Sound.PLAY_FINISHED){cjs.Sound.play("prettyprincess_"+btn.name);}
anim.gotoAndPlay("wave");cjs.Tween.get(name,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(name,{override:true}).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":name.scaleX=0.8;name.scaleY=0.8;break;case"pressup":name.scaleX=0.85;name.scaleY=0.85;break;}},kill:function(){var ctnr=this.container;for(var i=0;i<ctnr.children.length;i++){var c=ctnr.children[i];c.removeAllEventListeners();}
ig.LAYERS.SCREENS.removeChild(ctnr);}});});

// lib/display/screens/path-select.js
ig.baked=true;ig.module('display.screens.path-select').requires('display.screen').defines(function(){ig.Screen.PathSelect=ig.Screen.extend({container:null,tickTime:0,anims:[],_startSound:null,init:function(){this._buildGraphics();},_buildGraphics:function(){var ctnr=this.container=new cjs.Container().set({mouseEnabled:false,mouseChildren:false});var banner=new cjs.Sprite(ig.SHEETS.MAIN,ig.Session.getNumberOfLocationsPlayed()===0?"ChoosePath":"ChooseNextPath").set({y:-229,mouseEnabled:false});ig.CenterReg(banner);ctnr.addChild(banner);var q=ig.main.mainQueue;var locations=ig.Session.getRandomLocations();for(var i=0;i<2;i++){var c=new cjs.Container().set({cursor:"pointer",x:-470+i*475,y:-165,mouseChildren:false,data:locations[i]});c.addChild(new cjs.Bitmap(q.getResult("choiceFrame")));c.addChild(new cjs.Bitmap(q.getResult("choice-"+c.data.id)).set({x:12,y:12}));var plaque=new cjs.Container().set({name:"name",scaleX:0.85,scaleY:0.85,x:238,y:296});plaque.addChild(new cjs.Sprite(ig.SHEETS.MAIN,"BlankPlaqueL").set({regX:106,regY:57}));var vocab=c.data.vocab;plaque.addChild(this.makeCenteredBitmapText(vocab).set({y:-11,scaleX:vocab.length>11?0.88:0.95,scaleY:0.95}));plaque.addChild(this.makeCenteredBitmapText(c.data.realname).set({y:11,scaleX:0.95,scaleY:0.95}));ig.FastCache(plaque);c.addChild(plaque);var b=plaque.getBounds();plaque.cache(b.x,b.y,b.width,b.height);c.on("click",this.btnHandler,this);if(ig.ua.mobile){c.on("mousedown",this.btnHandler,this);c.on("pressup",this.btnHandler,this);}else{c.on("mouseover",this.btnHandler,this);c.on("mouseout",this.btnHandler,this);}
ctnr.addChild(c);}
var character=new cjs.Sprite(ig.SHEETS.MAIN,ig.Session.character+"Circle");var characterHeight=character.getBounds().height;ctnr.addChild(character.set({regX:100,regY:characterHeight,y:292}));ig.LAYERS.SCREENS.addChild(ctnr);},start:function(){if(ig.Session.getNumberOfLocationsPlayed()===0){this._startSound=cjs.Sound.play("luteplayer_choosepath");}else{this._startSound=cjs.Sound.play("luteplayer_choosenextpath");}
this.parent();},setActive:function(active){this.container.mouseChildren=this.container.mouseEnabled=active;},makeCenteredBitmapText:function(textString){var bmpText=new cjs.BitmapText(textString,ig.SHEETS.HOUSEARAMA_22).set({letterSpacing:-3});var b=bmpText.getBounds();bmpText.regX=Math.round(b.width*0.5);bmpText.regY=Math.round(b.height*0.5);return bmpText;},btnHandler:function(e){var btn=e.target;if(!btn)return;var name=btn.getChildByName("name");var ease=cjs.Ease.cubicOut;switch(e.type){case"click":cjs.Sound.play("sfx_click");this.setActive(false);cjs.Tween.get(this).wait(1000).call(ig.main.gotoPath,[btn.data],ig.main);if(ig.ua.mobile){cjs.Sound.play(btn.data.chooseSound);}
break;case"mouseover":if(this._startSound.playState===cjs.Sound.PLAY_FINISHED){cjs.Sound.play(btn.data.chooseSound);}
cjs.Tween.get(name,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(name,{override:true}).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":name.scaleX=0.8;name.scaleY=0.8;break;case"pressup":name.scaleX=0.85;name.scaleY=0.85;break;}},kill:function(){ig.LAYERS.SCREENS.removeChild(this.container);}});});

// lib/display/screens/destination-select.js
ig.baked=true;ig.module('display.screens.destination-select').requires('display.screen').defines(function(){ig.Screen.DestinationSelect=ig.Screen.extend({container:null,tickTime:0,anims:[],init:function(){var ctnr=this.container=new cjs.Container();var q=ig.main.mainQueue;var banner=new cjs.Sprite(ig.SHEETS.MAIN,"ChooseDestination").set({y:-240,mouseEnabled:false});ig.CenterReg(banner);ctnr.addChild(banner);var locations=ig.GameConfig.bossBattles.locations;var cx=ig.system.width*-0.5;var cy=ig.system.height*-0.5;for(var i=0;i<locations.length;i++){var l=locations[i];var c=new cjs.Container().set({x:i===2?cx+306:cx+124+i*369,y:i===2?cy+356:cy+120,cursor:"pointer",mouseChildren:false});c.addChild(new cjs.Bitmap(q.getResult(l.thumb)));c.data=l;var plaque=new cjs.Container().set({name:"name",scaleX:0.85,scaleY:0.85,x:176,y:192});plaque.addChild(new cjs.Sprite(ig.SHEETS.MAIN,"BlankPlaqueL").set({regX:106,regY:57,scaleX:0.84,scaleY:0.84}));var words=l.name.split(" ");plaque.addChild(this.makeCenteredBitmapText(words[0]).set({y:-11,scaleX:0.95,scaleY:0.95}));plaque.addChild(this.makeCenteredBitmapText(words[1]).set({y:11,scaleX:0.95,scaleY:0.95}));c.addChild(plaque);c.on("click",this.btnHandler,this);if(ig.ua.mobile){c.on("mousedown",this.btnHandler,this);c.on("pressup",this.btnHandler,this);}else{c.on("mouseover",this.btnHandler,this);c.on("mouseout",this.btnHandler,this);}
ctnr.addChild(c);}
ig.LAYERS.SCREENS.addChild(ctnr);},start:function(){this._startSound=cjs.Sound.play("luteplayer_choosedestination");this.parent();},makeCenteredBitmapText:function(textString){var bmpText=new cjs.BitmapText(textString,ig.SHEETS.HOUSEARAMA_22).set({letterSpacing:-3});var b=bmpText.getBounds();bmpText.regX=b.width/2;bmpText.regY=b.height/2;return bmpText;},btnHandler:function(e){var btn=e.target;if(!btn)return;var name=btn.getChildByName("name");var ease=cjs.Ease.cubicOut;switch(e.type){case"click":this.container.mouseEnabled=this.container.mouseChildren=false;if(this._startSound){this._startSound.stop();}
cjs.Sound.play("sfx_click");ig.Session.setDestinationChoice(btn.data);ig.main.loadBossBattle();if(ig.ua.mobile){cjs.Sound.play(btn.data.chooseSound);}
break;case"mouseover":if(this._startSound.playState===cjs.Sound.PLAY_FINISHED){cjs.Sound.play(btn.data.chooseSound);}
cjs.Tween.get(name,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(name,{override:true}).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":name.scaleX=0.8;name.scaleY=0.8;break;case"pressup":name.scaleX=0.85;name.scaleY=0.85;break;}},kill:function(){ig.LAYERS.SCREENS.removeChild(this.container);}});});

// lib/display/screens/bossbattle.js
ig.baked=true;ig.module('display.screens.bossbattle').requires('display.screen').defines(function(){ig.Screen.BossBattle=ig.Screen.extend({container:null,playBtn:null,player:null,cloudy:null,princess:null,rainbow:null,locationCloud:null,questionIndex:-1,questionLinesCont:null,answerContainer:null,_endIndex:-1,init:function(){var ctnr=this.container=new cjs.Container();var q=ig.main.mainQueue;var sheetData=ig.main.midQueue.getResult("bossBattleSheetData");sheetData.images=[];var ids=["bossBattleSheetAll","bossBattleSheetBecky","bossBattleSheetClouds","bossBattleSheetIce","bossBattleSheetTower","bossBattleSheetTJ","bossBattleSheetViolet"];for(var i=0;i<ids.length;i++){sheetData.images.push(ig.main.midQueue.getResult(ids[i]));}
ig.SHEETS.BOSS_BATTLES=new cjs.SpriteSheet(sheetData);ig.LAYERS.SCREENS.addChild(ctnr);var BossBattleClass;switch(ig.Session.bossDestination.id){case"tower":BossBattleClass=PPAnims.bossBattles.BossBattle_GloomyTower;break;case"ice":BossBattleClass=PPAnims.bossBattles.BossBattle_FrozenLake;break;case"clouds":BossBattleClass=PPAnims.bossBattles.BossBattle_StormCloud;break;}
this.anim=new BossBattleClass().set({x:ig.system.width*-0.5,y:ig.system.height*-0.5,mouseEnabled:false,mouseChildren:false,framerate:30});ctnr.addChild(this.anim);this.buildQuestionTemplate();},start:function(){this.isReady=true;this.parent();},begin:function(){cjs.Sound.play("sfx_thunder1");this.cloudy.onAnimEnd=this.nextStep.bind(this);this.cloudy.gotoAndPlay("evil_laugh");cjs.Tween.get(this.cloudy).to({x:this.cloudy.oX},2000,cjs.Ease.quadOut);this.player.play();},nextStep:function(){switch(this.questionIndex){case-1:this.currentVO=cjs.Sound.play("luteplayer_intro_"+ig.Session.bossDestination.id);this.currentVO.on("complete",this.onIntroComplete,this);break;case 0:case 1:case 2:this.nextQuestion();break;}},playWinSequence:function(){this._endIndex++;switch(this._endIndex){case 0:this.cloudy.onAnimEnd=this.playWinSequence.bind(this);this.cloudy.gotoAndPlay("defeated");break;case 1:this.cloudy.onAnimEnd=null;this.princess.onAnimEnd=this.playWinSequence.bind(this);this.princess.gotoAndPlay("free");break;case 2:this.princess.onAnimEnd=null;this.currentVO=cjs.Sound.play("luteplayer_"+ig.Session.character+"won");this.currentVO.on("complete",this.playWinSequence,this);this.player.gotoAndPlay("end");break;case 3:this.currentVO.removeAllEventListeners();var anims=["hooray","yourescuedmefromthatevilcountcloudy","thanksforsavingme","yousavedme"];this.princess.onAnimEnd=this.onCompletion.bind(this);this.princess.gotoAndPlay(anims.random());cjs.Sound.play("sfx_fw_chimes3");this.rainbow.play();break;}},onCompletion:function(){cjs.Tween.get(this).wait(500).call(ig.ScreenControl.goto,[ig.SCREENS.END],ig.ScreenControl);},onIntroComplete:function(){this.currentVO.removeAllEventListeners();this.currentVO=cjs.Sound.play("luteplayer_almostcomplete");this.currentVO.on("complete",this.onIntroSecondComplete,this);},onIntroSecondComplete:function(){this.currentVO.removeAllEventListeners();this.nextQuestion();},buildQuestionTemplate:function(){this.questionContainer=new cjs.Container().set({x:ig.system.width*-0.5+26,y:ig.system.height*-0.5+30,alpha:0,visible:false});this.locationCloud=new cjs.Bitmap(ig.main.midQueue.getResult("cloud-village")).set({x:134-26,y:115});this.questionContainer.addChild(this.locationCloud);this.questionContainer.addChild(new cjs.Sprite(ig.SHEETS.MAIN,"QuestionCloud"));this.questionLinesCont=new cjs.Container().set({x:160,y:60});this.questionContainer.addChild(this.questionLinesCont);this.answerContainer=new cjs.Container().set({x:433,y:450});this.questionContainer.addChild(this.answerContainer);var pos=[{x:-113,y:-45},{x:127,y:-45},{x:7,y:35}];for(i=0;i<3;i++){var ac=new cjs.Container().set({x:pos[i].x,y:pos[i].y,mouseChildren:false,cursor:"pointer"});ac.on("click",this.btnHandler,this);if(ig.ua.mobile){ac.on("mousedown",this.btnHandler,this);ac.on("pressup",this.btnHandler,this);}else{ac.on("mouseover",this.btnHandler,this);ac.on("mouseout",this.btnHandler,this);}
this.answerContainer.addChild(ac);ac.addChild(new cjs.Sprite(ig.SHEETS.MAIN,"VocabCloud").set({regX:101,regY:36}));ac.addChild(this.makeCenteredBitmapText("temp").set({y:-5}));}
this.container.addChild(this.questionContainer);},nextQuestion:function(){this.questionIndex++;var location=ig.Session.visitedLocations[this.questionIndex];this.locationCloud.image=ig.main.midQueue.getResult("cloud-"+location.id);this.questionLinesCont.removeAllChildren();this.makeQuestion();var distractors=ig.GameConfig.bossBattles.distractors[location.vocab];distractors.shuffle();var words=[location.vocab,distractors[0],distractors[1]];words.shuffle();for(i=0;i<this.answerContainer.children.length;i++){var ac=this.answerContainer.children[i];ac.vocab=words[i];ac.removeChildAt(1);ac.mouseEnabled=true;ac.alpha=1;ac.scaleX=1;ac.scaleY=1;var bmpText=this.makeCenteredBitmapText(words[i]).set({y:-5});var b=bmpText.getBounds();bmpText.cache(b.x,b.y,b.width,b.height);ac.addChild(bmpText);}
cjs.Tween.get(this.questionContainer).set({visible:true}).to({alpha:1},500,cjs.Ease.quadInOut);this.answerContainer.mouseEnabled=this.answerContainer.mouseChildren=true;var vos=["luteplayer_firstplace","luteplayer_secondplace","luteplayer_rightnow"];this._qSound=cjs.Sound.play(vos[this.questionIndex]);},completeQuestion:function(){cjs.Tween.get(this.questionContainer).to({alpha:0},500,cjs.Ease.quadInOut).set({visible:false});cjs.Tween.get(this).wait(800).call(this.playCountsAnim,null,this);},playCountsAnim:function(){if(this.questionIndex>=2){this.questionIndex=3;cjs.Tween.get(this.questionContainer).to({alpha:0},800,cjs.Ease.quadInOut);this.playWinSequence();}else{var anims=["Audio1","Audio2","Audio3","Audio4","Audio5","Audio6"];this.cloudy.gotoAndPlay(anims.random());}},makeQuestion:function(){var question=ig.GameConfig.bossBattles.questions[this.questionIndex];var lines=[];var words=question.split(" ");var line="";for(var i=0;i<words.length;i++){var word=words[i];if(line.length+word.length<22){line+=word+" ";}else{lines.push(line);line=word+" ";}}
lines.push(line);for(i=0;i<lines.length;i++){this.questionLinesCont.addChild(this.makeCenteredBitmapText(lines[i]).set({y:i*26}));}
var b=this.questionLinesCont.getBounds();this.questionLinesCont.cache(b.x,b.y,b.width,b.height);},makeCenteredBitmapText:function(textString){var bmpText=new cjs.BitmapText(textString,ig.SHEETS.RIDDLE_FONT).set({letterSpacing:-3});var b=bmpText.getBounds();bmpText.regX=b.width/2;bmpText.regY=b.height/2;return bmpText;},findPrincess:function(){for(var i=this.anim.children.length-1;i>=0;i--){var c=this.anim.children[i];if(c.name==="princess"){this.princess=c;return;}}},findPlayer:function(){for(var i=this.anim.children.length-1;i>=0;i--){var c=this.anim.children[i];if(c.name==="players"){for(var j=c.children.length-1;j>=0;j--){var cc=c.children[j];if(cc.name===ig.Session.character){this.player=cc;}else{c.removeChild(cc);}}
return;}}},update:function(){if(!this.cloudy){this.cloudy=this.anim.getChildByName("cloudy");if(this.cloudy){this.cloudy.oX=this.cloudy.x;this.cloudy.x+=ig.system.width;}
return;}
if(!this.princess){this.princess=this.anim.getChildByName("princess");return;}
if(!this.rainbow){this.rainbow=this.anim.getChildByName("rainbow");return;}
if(!this.player){this.findPlayer();return;}
if(this.isReady){this.isReady=false;this.begin();}},btnHandler:function(e){var btn=e.target;if(!btn)return;var ease=cjs.Ease.cubicOut;switch(e.type){case"click":if(this._qSound){this._qSound.stop();}
var location=ig.Session.visitedLocations[this.questionIndex];if(location.vocab===btn.vocab){this.answerContainer.mouseEnabled=this.answerContainer.mouseChildren=false;cjs.Sound.play(["sfx_fw_chimes2","sfx_fw_chimes3"].random());this.seq=new ig.VOSequence();if(ig.ua.mobile&&!ig.main.isAudioLimited){this.seq.add("luteplayer_word_"+btn.vocab,200);}
this.seq.add(["luteplayer_goodjob","luteplayer_nicework"].random(),200);this.seq.play(this.completeQuestion.bind(this));}else{cjs.Sound.play("sfx_click");this.seq=new ig.VOSequence();if(ig.ua.mobile&&!ig.main.isAudioLimited){this.seq.add("luteplayer_word_"+btn.vocab,200);}
this.seq.add(Math.random()>0.5?"luteplayer_keeptrying":"luteplayer_oops",200);this.seq.play();btn.mouseEnabled=false;cjs.Tween.get(btn,{overwrite:true}).to({alpha:0.25,scaleX:0.9,scaleY:0.9},250,ease);}
break;case"mouseover":if(this._qSound.playState===cjs.Sound.PLAY_FINISHED){cjs.Sound.stop();cjs.Sound.play("luteplayer_word_"+btn.vocab);}
cjs.Tween.get(btn,{overwrite:true}).to({scaleX:1.2,scaleY:1.2},250,ease);break;case"mouseout":cjs.Tween.get(btn,{overwrite:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mousedown":btn.scaleX=0.9;btn.scaleY=0.9;break;case"pressup":btn.scaleX=1;btn.scaleY=1;break;}},kill:function(){ig.LAYERS.SCREENS.removeChild(this.container);}});});

// lib/display/screens/end.js
ig.baked=true;ig.module('display.screens.end').requires('display.screen').defines(function(){ig.Screen.End=ig.Screen.extend({container:null,tickTime:0,anims:[],firstPath:false,init:function(){var ctnr=this.container=new cjs.Container().set({x:ig.system.width*-0.5,y:ig.system.height*-0.5});var q=ig.main.mainQueue;switch(ig.Session.character){case"becky":ctnr.addChild(new PPAnims.characterEnds.BeckyAnim().setTransform(494,274.9,1,1,0,0,0,420,266.9).set({framerate:24,mouseEnabled:false,mouseChildren:false}));break;case"tj":ctnr.addChild(new PPAnims.characterEnds.TJAnim().setTransform(494,274.9,1,1,0,0,0,420,266.9).set({framerate:24,mouseEnabled:false,mouseChildren:false}));break;case"violet":ctnr.addChild(new PPAnims.characterEnds.VioletAnim().setTransform(494,274.9,1,1,0,0,0,420,266.9).set({framerate:24,mouseEnabled:false,mouseChildren:false}));break;}
ctnr.addChild(new cjs.Bitmap(q.getResult("endbackground")));var playBtn=new cjs.Sprite(ig.SHEETS.MAIN,"PlayAgainBtn").set({x:ig.system.width*0.5-15,y:ig.system.height*0.5+235,scaleX:0.85,scaleY:0.85,cursor:"pointer"});ig.CenterReg(playBtn);ctnr.addChild(playBtn);playBtn.on("click",this.btnHandler,this);if(ig.ua.mobile){playBtn.on("mousedown",this.btnHandler,this);playBtn.on("pressup",this.btnHandler,this);}else{playBtn.on("mouseover",this.btnHandler,this);playBtn.on("mouseout",this.btnHandler,this);}
this.playBtn=playBtn;ig.LAYERS.SCREENS.addChild(ctnr);},start:function(){this.parent();},setActive:function(active){this.container.mouseChildren=active;},btnHandler:function(e){var btn=e.target;if(!btn)return;var ease=cjs.Ease.cubicOut;switch(e.type){case"click":cjs.Sound.play("sfx_click");ig.main.startNewGame();break;case"mouseover":cjs.Tween.get(this.playBtn,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(this.playBtn,{override:true}).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":btn.scaleX=0.8;btn.scaleY=0.8;break;case"pressup":btn.scaleX=0.85;btn.scaleY=0.85;break;}},kill:function(){ig.LAYERS.SCREENS.removeChild(this.container);}});});

// lib/display/screens/game.js
ig.baked=true;ig.module('display.screens.game').requires('display.screen').defines(function(){ig.Screen.Game=ig.Screen.extend({container:null,playBtn:null,locationData:null,counterTextbox:null,riddleContainer:null,riddleIconPositions:[{x:195,y:216},{x:385,y:216},{x:194,y:364},{x:384,y:364}],_introPlayed:false,_showingInstructions:false,init:function(){this.locationData=ig.Session.currentLocation;this.container=new cjs.Container();this.buildUI();this.buildRiddle();this.addWorld();ig.LAYERS.SCREENS.addChild(this.container);},start:function(){this.parent();if(!ig.main.seenInstructions){this.showInstructions();}else{this.startGame();}},buildUI:function(){var c=this.container;var rightCloud=new cjs.Sprite(ig.SHEETS.GAME,"corner-cloud").set({x:-30,y:ig.system.height*-0.5,scaleY:ig.ua.mobile&&ig.ua.small?1.4:1,});c.addChild(rightCloud);var leftCloud=new cjs.Sprite(ig.SHEETS.GAME,"corner-cloud").set({scaleX:-1,scaleY:ig.ua.mobile?1.4:1,x:ig.ua.mobile?-64:ig.system.width*-0.5+316,y:ig.system.height*-0.5});c.addChild(leftCloud);var sheetData=ig.main.midQueue.getResult(this.locationData.id+"SheetData");sheetData.images=[ig.main.midQueue.getResult(this.locationData.id+"Sheet")];this.spriteSheet=new cjs.SpriteSheet(sheetData);c.addChild(new cjs.Sprite(this.spriteSheet,"willow_counter").set({x:312,y:ig.ua.mobile&&ig.ua.small?ig.system.height*-0.5+36:ig.system.height*-0.5+2}));this.counterTextbox=new cjs.BitmapText("0/5",ig.SHEETS.COUNTER_FONT).set({x:436,y:ig.system.height*-0.5+24,letterSpacing:-2});if(ig.ua.mobile&&ig.ua.small)this.counterTextbox.y+=34;c.addChild(this.counterTextbox);this.helpBtn=new cjs.Sprite(ig.SHEETS.GAME,"help-btn").set({x:-448,y:ig.system.height*-0.5+34,regX:24,regY:24,cursor:"pointer"});if(ig.ua.mobile)this.helpBtn.y+=34;if(ig.ua.iPhone||ig.ua.iPod)this.helpBtn.y+=34;this.helpBtn.on("click",this.helpBtnHandler,this);if(ig.ua.mobile){this.helpBtn.on("mousedown",this.helpBtnHandler,this);this.helpBtn.on("pressup",this.helpBtnHandler,this);}else{this.helpBtn.on("mouseover",this.helpBtnHandler,this);this.helpBtn.on("mouseout",this.helpBtnHandler,this);}
c.addChild(this.helpBtn);},showInstructions:function(){this._showingInstructions=true;var c=this.container;this.instructions=new cjs.Container();this.instructions.addChild(new cjs.Bitmap(ig.main.mainQueue.getResult("instructions")).set({regX:445,regY:238}));if(ig.ua.iPod||ig.ua.iPhone){this.instructions.scaleX=this.instructions.scaleY=0.8;}
this.closeBtn=new cjs.Sprite(ig.SHEETS.MAIN,"CloseBtn").set({scaleX:0.85,scaleY:0.85,regX:89,regY:47,y:238,cursor:"pointer"});this.closeBtn.on("click",this.closeBtnHandler,this);if(ig.ua.mobile){this.closeBtn.on("mousedown",this.closeBtnHandler,this);this.closeBtn.on("pressup",this.closeBtnHandler,this);}else{this.closeBtn.on("mouseover",this.closeBtnHandler,this);this.closeBtn.on("mouseout",this.closeBtnHandler,this);}
this.instructions.addChild(this.closeBtn);c.addChild(this.instructions);this.instructionSound=cjs.Sound.play(ig.ua.mobile?"luteplayer_touchinstructions":"luteplayer_desktopinstructions");},buildRiddle:function(){var q=ig.main.mainQueue;this.riddleContainer=new cjs.Container().set({x:-275,y:Math.round(ig.system.height*-0.5+37),alpha:0,visible:false});this.container.addChild(this.riddleContainer);var paper=new cjs.Bitmap(q.getResult("riddlePaper"));this.riddleContainer.addChild(paper);this.riddle=this.locationData.riddle;this.writeRiddle();var choices=this.riddle.distractors.clone();choices.push(this.riddle.a);choices.shuffle();var pos=[0,1,2,3];pos.shuffle();for(i=0;i<4;i++){var p=this.riddleIconPositions[pos[i]];var spriteName=ig.Session.getCurrentLocationName()+"_"+choices[i];var icon=new cjs.Sprite(ig.SHEETS.RIDDLE_ICONS,spriteName).set({x:p.x,y:p.y,regX:70,regY:62,cursor:"pointer"});icon.on("click",this.btnHandler,this);if(ig.ua.mobile){icon.on("mousedown",this.btnHandler,this);icon.on("pressup",this.btnHandler,this);}else{icon.on("mouseover",this.btnHandler,this);icon.on("mouseout",this.btnHandler,this);}
this.riddleContainer.addChild(icon);}},writeRiddle:function(){var riddleText=new cjs.Container().set({x:288,y:75});var lines=this.riddle.q.split("\n");for(i=0;i<lines.length;i++){riddleText.addChild(this.makeCenteredBitmapText(lines[i]).set({y:i*26}));}
this.riddleContainer.addChild(riddleText);},addWorld:function(){this.world=new ig.World.PPWorld({location:ig.Session.getCurrentLocationName(),spriteSheet:this.spriteSheet,gravity:1400});switch(ig.Session.character){case"becky":this.world.spawnEntity(ig.Becky,300,420);break;case"tj":this.world.spawnEntity(ig.TJ,300,420);break;case"violet":this.world.spawnEntity(ig.Violet,300,420);break;}
this.updateCounter();},startGame:function(){if(!this._introPlayed){cjs.Sound.play(this.locationData.startSound);this._introPlayed=true;}
ig.MusicControl.set("locationMusic");},updateCounter:function(){var bmpText=this.counterTextbox;bmpText.text=this.world.willowCount+"/5";var b=bmpText.getBounds();bmpText.regX=b.width/2;},win:function(){if(this.hasWon){return;}
this.hasWon=true;this.helpBtn.visible=false;ig.MusicControl.stop();cjs.Sound.play("sfx_endlevel");var seq=new ig.VOSequence();seq.add(this.locationData.endSound).add("luteplayer_ihaveariddleforyou");seq.play(this.showRiddle.bind(this));},showRiddle:function(){cjs.Sound.play("sfx_fw_chimes3");cjs.Tween.get(this.riddleContainer).set({visible:true}).to({alpha:1},750,cjs.Ease.quadInOut).call(this.playRiddle,null,this);},playRiddle:function(){this.riddleQuestion=cjs.Sound.play("locationRiddleQuestion");},makeCenteredBitmapText:function(textString){var bmpText=new cjs.BitmapText(textString,ig.SHEETS.RIDDLE_FONT).set({letterSpacing:-3});var b=bmpText.getBounds();bmpText.regX=Math.round(b.width*0.5);bmpText.regY=Math.round(b.height*0.5);return bmpText;},update:function(){if(this.world&&!this._showingInstructions){this.world.update();}},endGame:function(){ig.TransitionControl.animateUp(ig.main.progressGame);},btnHandler:function(e){var btn=e.target;if(!btn)return;var ease=cjs.Ease.cubicOut;switch(e.type){case"click":if(this.riddleQuestion)
this.riddleQuestion.stop();if(btn.currentAnimation.indexOf(this.riddle.a)>-1){cjs.Sound.play(["sfx_fw_chimes2","sfx_fw_chimes3"].random());this.riddleContainer.mouseEnabled=false;this.riddleContainer.mouseChilren=false;var seq=new ig.VOSequence();if(ig.main.isAudioLimited){seq.add("luteplayer_congratulations",200);}else{seq.add("locationRiddleAnswer",200).add("luteplayer_congratulations",200);}
seq.play(this.endGame.bind(this));ig.MusicControl.stop();}else{cjs.Sound.play("sfx_click");cjs.Sound.play(Math.random()>0.5?"luteplayer_keeptrying":"luteplayer_oops");btn.mouseEnabled=false;cjs.Tween.get(btn).to({alpha:0.25,scaleX:1,scaleY:1},250,ease);}
break;case"mouseover":cjs.Sound.play("sfx_jump");cjs.Tween.get(btn,{override:true}).to({scaleX:1.2,scaleY:1.2},250,ease);break;case"mouseout":cjs.Tween.get(btn,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mousedown":btn.scaleX=0.9;btn.scaleY=0.9;break;case"pressup":btn.scaleX=1;btn.scaleY=1;break;}},closeBtnHandler:function(e){var btn=e.target;if(!btn)return;var ease=cjs.Ease.cubicOut;switch(e.type){case"click":cjs.Sound.play("sfx_click");this.instructionSound.stop();ig.main.seenInstructions=true;this.container.removeChild(this.instructions);this._showingInstructions=false;this.startGame();break;case"mouseover":cjs.Tween.get(btn,{override:true}).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(btn,{override:true}).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":btn.scaleX=0.8;btn.scaleY=0.8;break;case"pressup":btn.scaleX=0.85;btn.scaleY=0.85;break;}},helpBtnHandler:function(e){if(this._showingInstructions)
return;var btn=e.target;if(!btn)return;switch(e.type){case"click":cjs.Sound.play("sfx_click");this.showInstructions();btn.gotoAndStop("help-btn");btn.scaleX=btn.scaleY=1;break;case"mouseover":btn.gotoAndStop("help-btn-over");break;case"mouseout":btn.gotoAndStop("help-btn");break;case"mousedown":btn.gotoAndStop("help-btn-over");btn.scaleX=0.8;btn.scaleY=0.8;break;case"pressup":btn.gotoAndStop("help-btn");break;}},kill:function(){ig.LAYERS.SCREENS.removeChild(this.container);this.world.kill();cjs.Sound.removeSound("locationRiddleQuestion");cjs.Sound.removeSound("locationRiddleAnswer");}});});

// lib/display/screens/intro.js
ig.baked=true;ig.module('display.screens.intro').requires('display.screen').defines(function(){ig.Screen.Intro=ig.Screen.extend({container:null,playBtn:null,init:function(){var ctnr=this.container=new cjs.Container();this.anim=new PPAnims.intro.Intro();this.anim.set({onAnimEnd:this.onSlideShowComplete.bind(this),mouseEnabled:false,mouseChildren:false,framerate:30,x:-140,y:-80});ig.CenterReg(this.anim);ctnr.addChild(this.anim);var btn=new cjs.Sprite(ig.SHEETS.MAIN,"SkipBtn").set({y:198,scaleX:0.85,scaleY:0.85,cursor:"pointer",mouseEnabled:false,});ig.CenterReg(btn);ctnr.addChild(btn);btn.on("click",this.btnHandler,this);if(ig.ua.mobile){btn.on("mousedown",this.btnHandler,this);btn.on("pressup",this.btnHandler,this);}else{btn.on("mouseover",this.btnHandler,this);btn.on("mouseout",this.btnHandler,this);}
this.skipBtn=btn;ig.LAYERS.SCREENS.addChild(ctnr);this.initSlideshow();},setActive:function(active){this.skipBtn.mouseEnabled=active;},initSlideshow:function(){this.anim.gotoAndPlay(1);this.introSound=cjs.Sound.play("IntroCombined");},onSlideShowComplete:function(){ig.ScreenControl.goto(ig.SCREENS.CHARACTER_SELECT);},btnHandler:function(e){var btn=e.target;if(!btn)return;var ease=cjs.Ease.cubicOut;switch(e.type){case"click":if(this.introSound){this.introSound.stop();}
cjs.Sound.play("sfx_click");ig.ScreenControl.goto(ig.SCREENS.CHARACTER_SELECT);break;case"mouseover":cjs.Tween.get(btn).to({scaleX:1,scaleY:1},250,ease);break;case"mouseout":cjs.Tween.get(btn).to({scaleX:0.85,scaleY:0.85},250,ease);break;case"mousedown":btn.scaleX=0.8;btn.scaleY=0.8;break;case"pressup":btn.scaleX=0.85;btn.scaleY=0.85;break;}},kill:function(){ig.LAYERS.SCREENS.removeChild(this.container);}});});

// lib/controllers/screen.js
ig.baked=true;ig.module('controllers.screen').requires('display.screens.title','display.screens.character-select','display.screens.path-select','display.screens.destination-select','display.screens.bossbattle','display.screens.end','display.screens.game','display.screens.intro').defines(function(){ig.ScreenController=ig.Class.extend({current:null,init:function(){if(ig.ScreenControl!==null){console.error("You do not instantiate this class!");return;}
ig.ScreenControl=this;},update:function(){if(this.current)
this.current.update();},goto:function(screen){if(this.current){this.current.setActive(false);cjs.Tween.get(this.current.container).to({alpha:0},500,cjs.Ease.quadInOut).call(this.current.kill,null,this.current).call(this.goto,[screen],this);this.current=null;return;}
switch(screen){case ig.SCREENS.TITLE:this.current=new ig.Screen.Title();if(!ig.ua.iOS){ig.MusicControl.set("mainMusic");}
break;case ig.SCREENS.INTRO:this.current=new ig.Screen.Intro();ig.MusicControl.set("mainMusic");break;case ig.SCREENS.CHARACTER_SELECT:this.current=new ig.Screen.CharacterSelect();ig.MusicControl.set("mainMusic");break;case ig.SCREENS.PATH_SELECT:this.current=new ig.Screen.PathSelect();ig.MusicControl.set("mainMusic");break;case ig.SCREENS.GAME:this.current=new ig.Screen.Game();break;case ig.SCREENS.DESTINATION_SELECT:this.current=new ig.Screen.DestinationSelect();ig.MusicControl.set("mainMusic");break;case ig.SCREENS.BOSS_BATTLE:this.current=new ig.Screen.BossBattle();break;case ig.SCREENS.END:this.current=new ig.Screen.End();ig.MusicControl.currentID="";ig.MusicControl.set("mainMusic");break;}
this.current.container.alpha=0;cjs.Tween.get(this.current.container).to({alpha:1},500,cjs.Ease.quadInOut).call(this.current.start,null,this.current);},removeCurrent:function(t){if(typeof t==="undefined")t=500;if(this.current){this.current.setActive(false);cjs.Tween.get(this.current.container).to({alpha:0},t,cjs.Ease.quadInOut).call(this.current.kill,null,this.current);this.current=null;}}});ig.ScreenControl=null;new ig.ScreenController();});

// lib/controllers/session.js
ig.baked=true;ig.module('controllers.session').defines(function(){ig.SessionController=ig.Class.extend({character:"becky",availableLocations:[],visitedLocations:[],bossDestination:null,currentLocation:null,init:function(){if(ig.Session!==null){console.error("You do not instantiate this class!");return;}
ig.Session=this;},newData:function(){this.visitedLocations=[];this.bossDestination=null;this.currentLocation=null;this._buildLocations();},_buildLocations:function(){ig.log("Build Locations");this.availableLocations=[];var locations=ig.GameConfig.locations;var requestedLocation=this.getParameterByName("testlevel");if(requestedLocation){for(var j=0;j<locations.length;j++){if(requestedLocation===locations[j].id){requestedLocation=locations[j];break;}}}
for(var i=0;i<locations.length;i++){var l={vocab:"",id:"",realname:"",map:null,riddle:null};var locationData=requestedLocation||locations[i];l.vocab=locationData.vocab;l.id=locationData.id;l.realname=locationData.realname;l.chooseSound=locationData.chooseSound;l.startSound=locationData.startSound;l.endSound=locationData.endSound;l.music=locationData.music;var levelData=ig.GameConfig.levelData[l.id];levelData.maps.shuffle();l.map=levelData.maps.random();l.riddle=levelData.riddles.random();this.availableLocations.push(l);}},getParameterByName:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "));},getNumberOfLocationsPlayed:function(){return this.visitedLocations.length;},getRandomLocations:function(){this.availableLocations.shuffle();return[this.availableLocations[0],this.availableLocations[1]];},getCurrentLocationName:function(){var locationData=this.visitedLocations[this.visitedLocations.length-1];return locationData.id;},setPathChoice:function(choice){ig.log("setPathChoice");ig.log(choice);this.availableLocations.splice(this.availableLocations.indexOf(choice),1);this.currentLocation=choice;this.visitedLocations.push(choice);},setDestinationChoice:function(choice){ig.log("setPathChoice");ig.log(choice);this.bossDestination=choice;this.visitedLocations[2]=choice;}});ig.Session=null;new ig.SessionController();});

// lib/controllers/music.js
ig.baked=true;ig.module('controllers.music').defines(function(){ig.MusicController=ig.Class.extend({current:null,currentID:"",init:function(){if(ig.MusicControl!==null){console.error("You do not instantiate this class!");return;}
ig.MusicControl=this;},set:function(id){if(id===this.currentID)
return;if(this.current)
this.current.stop();this.current=cjs.Sound.play(id,{loop:-1,volume:0.3});this.currentID=id;},stop:function(){if(this.current)
this.current.stop();},pause:function(){if(this.current)this.current.pause();},resume:function(){if(this.current)this.current.resume();}});ig.MusicControl=null;new ig.MusicController();});

// lib/controllers/visibility.js
ig.baked=true;ig.module('controllers.visibility').defines(function(){ig.VisibilityController=ig.Class.extend({_bindedHandler:null,hidden:null,visibilitychange:null,i:0,init:function(){if(ig.Visibility!==null){console.error("You do not instantiate this class!");return;}
ig.Visibility=this;},addListeners:function(){ig.log("Visibility Listeners Active");this._bindedHandler=this.onPageVisibilityChange.bind(this);window.addEventListener("pagehide",this._bindedHandler);window.addEventListener("pageshow",this._bindedHandler);window.addEventListener('focus',this._bindedHandler);window.addEventListener('blur',this._bindedHandler);if(typeof document.hidden!=="undefined"){this.hidden="hidden";this.visibilityChange="visibilitychange";}else if(typeof document.mozHidden!=="undefined"){this.hidden="mozHidden";this.visibilityChange="mozvisibilitychange";}else if(typeof document.msHidden!=="undefined"){this.hidden="msHidden";this.visibilityChange="msvisibilitychange";}else if(typeof document.webkitHidden!=="undefined"){this.hidden="webkitHidden";this.visibilityChange="webkitvisibilitychange";}
if(this.visibilityChange&&this.hidden){document.addEventListener(this.visibilityChange,this._bindedHandler);window.addEventListener(this.visibilityChange,this._bindedHandler);}},removeListeners:function(){if(!this._bindedHandler)
return;window.removeEventListener("pagehide",this._bindedHandler);window.removeEventListener("pageshow",this._bindedHandler);window.removeEventListener('focus',this._bindedHandler);window.removeEventListener('blur',this._bindedHandler);if(this.visibilityChange&&this.hidden){document.removeEventListener(this.visibilityChange,this._bindedHandler);}},onPageVisibilityChange:function(event){if(!event)
return;switch(event.type){case this.visibilityChange:case"visibilitychange":cjs.Sound.setMute(document[this.hidden]);if(document[this.hidden]){ig.MusicControl.pause();}else{ig.MusicControl.resume();}
break;case"pagehide":case"blur":ig.MusicControl.pause();cjs.Sound.setMute(true);break;case"pageshow":case"focus":ig.MusicControl.resume();cjs.Sound.setMute(false);break;}}});ig.Visibility=null;new ig.VisibilityController();});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16,dx:0,dy:0},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:1000,y:1000},zIndex:0,gravityFactor:0,standing:false,bounciness:0,minBounceVelocity:40,onGround:false,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,world:null,_debugShape:null,_displayobject:null,slopeStanding:{min:Math.toRad(44),max:Math.toRad(136)},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=this.last.x=x;this.pos.y=this.last.y=y;ig.merge(this,settings);this.size.dx=this.size.dx||this.size.x;this.size.dy=this.size.dy||this.size.y;if(this.world._debugDraw){this._debugShape=new cjs.Shape();this._debugShape.graphics.s("#F00").r(0,0,this.size.x,this.size.y);this.world._debugContainer.addChild(this._debugShape);}},reset:function(x,y,settings){var proto=this.constructor.prototype;this.pos.x=x;this.pos.y=y;this.last.x=x;this.last.y=y;this.vel.x=proto.vel.x;this.vel.y=proto.vel.y;this.accel.x=proto.accel.x;this.accel.y=proto.accel.y;this.health=proto.health;this._killed=proto._killed;this.standing=proto.standing;this.type=proto.type;this.checkAgainst=proto.checkAgainst;this.collides=proto.collides;ig.merge(this,settings);},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=this.world.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;this.handleMovement(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);if(this.world._debugDraw){this._debugShape.graphics.c().s("#F00").r(0,0,this.size.x,this.size.y);this._debugShape.x=this.pos.x;this._debugShape.y=this.pos.y;}},draw:function(){if(this._displayobject){this._displayobject.x=this.pos.x;this._displayobject.y=this.pos.y;this.checkVisibility();}},checkVisibility:function(){if(this._displayobject.x-this._displayobject.regX+this.world._worldContainer.x>ig.system.width||this._displayobject.x-this._displayobject.regX+this.size.dx+this.world._worldContainer.x<0){this._displayobject.visible=false;}else{this._displayobject.visible=true;}},getNewVelocity:function(vel,accel,friction,max){if(accel){return Math.limit(vel+accel*ig.system.tick,-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return Math.limit(vel,-max,max);},handleMovement:function(x,y,vx,vy){var yCollision=false;var xCollision=false;this.standing=false;this.pos.x=x+vx;if(y+this.size.y+vy>this.world.groundY){this.pos.y=this.world.groundY-this.size.y;yCollision=true;}else{this.pos.y=y+vy;}
if(yCollision){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(xCollision){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
this.onGround=this.standing;},kill:function(){this.world.removeEntity(this);},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){},erase:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);var world=left.world;if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=world.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=world.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=world.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);var world=top.world;var nudgeX=0;var resTop;if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=world.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(world.gravity&&(bottom.standing||top.vel.y>0)){resTop=top.world.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;nudgeX=bottom.vel.x*ig.system.tick;resTop=world.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=world.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/world.js
ig.baked=true;ig.module('impact.world').requires('impact.impact','impact.entity').defines(function(){"use strict";ig.World=ig.Class.extend({_worldContainer:null,_entitiesContainer:null,_debugContainer:null,_debugDraw:false,gravity:0,player:null,groundY:9999,entities:[],namedEntities:{},_deferredKill:[],init:function(settings){ig.merge(this,settings);this._worldContainer=new cjs.Container().set({mouseChildren:false,mouseEnabled:false});ig.LAYERS.GAME.removeAllChildren();ig.LAYERS.GAME.addChild(this._worldContainer);this._entitiesContainer=new cjs.Container();this._worldContainer.addChild(this._entitiesContainer);if(this._debugDraw){this._debugContainer=new cjs.Container();this._worldContainer.addChild(this._debugContainer);}},spawnEntity:function(type,x,y,settings){var EntityClass=typeof(type)==='string'?ig.global[type]:type;if(!EntityClass){throw("Can't spawn entity of type "+type);}
settings=settings||{};settings.world=this;var ent=new(EntityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
this._entitiesContainer.addChild(ent._displayobject);return ent;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
this._entitiesContainer.removeChild(ent._displayobject);if(this._debugDraw){this._debugContainer.removeChild(ent._debugShape);}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},update:function(){this.updateEntities();if(this.player){this.doPlayerCheck();}
for(var i=0;i<this._deferredKill.length;i++){this._deferredKill[i].erase();this.entities.erase(this._deferredKill[i]);}
this._deferredKill.length=0;this.drawEntities();},updateEntities:function(){var l=this.entities.length;for(var i=0;i<l;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},drawEntities:function(){var l=this.entities.length;for(var i=0;i<l;i++){var ent=this.entities[i];ent.draw();}},doPlayerCheck:function(){var l=this.entities.length;for(var i=0;i<l;i++){var e=this.entities[i];if(e===this.player||(e._displayobject&&!e._displayobject.visible)){continue;}
if(this.player.touches(e)){ig.Entity.checkPair(this.player,e);}}},trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};},kill:function(){ig.LAYERS.GAME.removeAllChildren();}});});

// lib/game/entities/player.js
ig.baked=true;ig.module('game.entities.player').requires('impact.entity','impact.world').defines(function(){ig.Player=ig.Entity.extend({type:ig.Entity.TYPE.A,checkAgainst:ig.Entity.TYPE.B,collides:ig.Entity.COLLIDES.ACTIVE,gravityFactor:1,speed:1000,lastPlatform:null,hurtTimer:0,activeCheckpoint:false,active:true,lastMouseY:0,yTimer:0,_shadow:null,wasOffGround:false,touchStarted:false,init:function(x,y,settings){this.parent(x,y,settings);this.maxVel.x=500;this.friction.x=1000;this.initSprites();this.checkAnimation("idle");this.world.player=this;},initSprites:function(){var image=ig.main.midQueue.getResult(ig.Session.character+"Run");var sheetData=ig.main.midQueue.getResult("runData");sheetData=sheetData[ig.Session.character];sheetData.images=[image];var sheet=new cjs.SpriteSheet(sheetData);this._displayobject=new cjs.Sprite(sheet,"idle");this._shadow=new cjs.Sprite(ig.SHEETS.GAME,"shadow").set({regX:60,regY:15});this.world._worldContainer.addChild(this._shadow);this._shadow.y=this.world.groundY;this.world.resetEntitiesToTop();},checkAnimation:function(anim){},updateShadow:function(){var shadowdist=((this._shadow.y-(this.pos.y+this.size.y))/100);shadowdist=Math.limit(shadowdist,0,1);this._shadow.alpha=1-shadowdist;this._shadow.scaleX=1+shadowdist;},update:function(){this.parent();this._shadow.x=this._displayobject.x+this.size.x/2;if(this.hurtTimer>0){this.hurtTimer-=ig.system.tick;return;}
if(this.onPlatform){this.standing=this.onPlatform;}
this.onPlatform=false;if(this.active){if(ig.ua.mobile){this.handleMobileControls();}else{this.handleDesktopControls();}}else{this.accel.x=0;}
if(!this.standing){this._displayobject.gotoAndStop("jump");}else if(this.vel.x!==0){if(this._displayobject.currentAnimation!=="run")this._displayobject.gotoAndPlay("run");}else{this._displayobject.gotoAndStop("idle");}
if(this.vel.x!==0){this._displayobject.scaleX=this.vel.x>0?1:-1;}
if(this.activeCheckpoint){if(!this.touches(this.activeCheckpoint)){this.activeCheckpoint=null;}}
if(this.wasOffGround&&this.standing){cjs.Sound.play("sfx_landing");}
this.wasOffGround=!this.standing;this.checkAnimation();this.updateShadow();},jump:function(){cjs.Sound.play("sfx_jump");this.pos.y-=10;this.vel.y=-700;},handleMobileControls:function(){if(!this.touchStarted&&ig.input.pressed("mouse")){this.touchStarted=true;}else if(this.touchStarted&&ig.input.released("mouse")){this.touchStarted=false;}
if(!this.touchStarted)
return;var playerScreenX=this.pos.x+this.size.x/2+this.world._worldContainer.x;var distance=Math.abs(playerScreenX-ig.input.mouse.x);if(ig.input.state("mouse")){if(ig.input.mouse.x<100&&ig.input.mouse.y<150){return;}
this.yTimer+=ig.system.tick;if(this.standing&&this.lastMouseY>ig.input.mouse.y&&this.lastMouseY-ig.input.mouse.y>30){this.jump();}
if(this.yTimer>0.4||ig.input.mouse.y>this.lastMouseY){this.lastMouseY=ig.input.mouse.y;this.yTimer=0;}
if(distance>20){var ms=distance/240*this.speed;if(ms>this.maxVel.x){ms=this.maxVel.x;}
if(ig.input.mouse.x<playerScreenX){this.vel.x=-ms;}else if(ig.input.mouse.x>playerScreenX){this.vel.x=ms;}}else{this.accel.x=0;}}else{this.accel.x=0;this.lastMouseY=0;this.yTimer=0;}},handleDesktopControls:function(){if(ig.input.state('up')&&this.standing){this.jump();}
if(ig.input.state('right')){this.accel.x=this.speed;if(this.vel.x<0){this.vel.x*=-1;}}else if(ig.input.state('left')){this.accel.x=-this.speed;if(this.vel.x>0){this.vel.x*=-1;}}else{this.accel.x=0;}},check:function(other){if(other instanceof ig.Willow){this.world.willowCount++;ig.ScreenControl.current.updateCounter();other.collect();}else if(other.isCheckpoint&&!this.activeCheckpoint){this.activeCheckpoint=other;this.world.doWinCheck();}},collideWith:function(other,axis){if(other.isObstacle===true){cjs.Sound.play("sfx_bounceback");if(axis==="x"){this.hurtTimer=0.5;this.vel.x=other.pos.x>this.pos.x?-400:400;}else{this.vel.x=-700;this.vel.y=-700;this.hurtTimer=0.7;}
this.accel.x=0;}else if(axis==='y'&&this.pos.y+this.size.y<=other.pos.y){this.onPlatform=true;}}});ig.Becky=ig.Player.extend({size:{x:42,y:140},checkAnimation:function(anim){var d=this._displayobject;switch(d.currentAnimation){case"jump":d.regX=58;d.regY=40;break;case"run":d.regX=58;d.regY=58;break;case"idle":d.regX=4;d.regY=58;break;}
if(d.scaleX<0){d.regX+=42;}}});ig.TJ=ig.Player.extend({size:{x:42,y:120},checkAnimation:function(anim){var d=this._displayobject;switch(d.currentAnimation){case"jump":d.regX=58;d.regY=50;break;case"run":d.regX=50;d.regY=58;break;case"idle":d.regX=2;d.regY=50;break;}
if(d.scaleX<0){d.regX+=42;}}});ig.Violet=ig.Player.extend({size:{x:42,y:143},checkAnimation:function(anim){var d=this._displayobject;switch(d.currentAnimation){case"jump":d.regX=40;d.regY=50;break;case"run":d.regX=50;d.regY=58;break;case"idle":d.regX=12;d.regY=50;break;}
if(d.scaleX<0){d.regX+=42;}}});});

// lib/utils/utils.js
ig.baked=true;ig.module('utils.utils').requires('impact.impact').defines(function(){"use strict";ig.HitCheck=function(displayObject){var bb=displayObject.getTransformedBounds();var tx=bb.x;var ty=bb.y;var parent=displayObject.parent;while(parent){tx+=parent.x;ty+=parent.y;parent=parent.parent;}
return!(ig.input.mouse.x<tx||ig.input.mouse.y<ty||ig.input.mouse.x>tx+bb.width||ig.input.mouse.y>ty+bb.height);};ig.CenterReg=function(bmp){var b=bmp.getBounds();bmp.regX=Math.round(b.width*0.5);bmp.regY=Math.round(b.height*0.5);};ig.FastCache=function(displayObject){var b=displayObject.getBounds();displayObject.cache(b.x,b.y,b.width,b.height);};});

// lib/game/entities/tower.js
ig.baked=true;ig.module('game.entities.tower').requires('impact.entity','impact.world').defines(function(){ig.Tower=ig.Entity.extend({collides:ig.Entity.COLLIDES.FIXED,init:function(x,y,settings){this._displayobject=new cjs.Sprite(ig.SHEETS.GAME,"tower");var b=this._displayobject.getBounds();this._displayobject.regX=10;this._displayobject.regY=10;this.size.x=b.width-50;this.size.y=b.height-20;this.size.dx=b.width;this.size.dy=b.height;x-=this.size.x/2;y-=this.size.y;this.parent(x,y,settings);},update:function(){this.parent();if(this._displayobject.scaleX<0){this._displayobject.regX=this.size.x+30;}}});});

// lib/game/entities/platform.js
ig.baked=true;ig.module('game.entities.platform').requires('impact.entity','impact.world').defines(function(){ig.Platform=ig.Entity.extend({collides:ig.Entity.COLLIDES.FIXED,size:{x:228,y:54},_displayobject:null,init:function(x,y,settings){x-=this.size.x/2;this.parent(x,y,settings);this._displayobject=new cjs.Sprite(settings.world.spriteSheet,settings.world.location+"_platform");},update:function(){var p=this.world.player;if(p){this.collides=p.pos.y+p.size.y<=this.pos.y?ig.Entity.COLLIDES.FIXED:ig.Entity.COLLIDES.NONE;}
this.parent();}});});

// lib/game/entities/obstacle.js
ig.baked=true;ig.module('game.entities.obstacle').requires('impact.entity','impact.world').defines(function(){ig.Obstacle=ig.Entity.extend({collides:ig.Entity.COLLIDES.FIXED,isObstacle:true,init:function(x,y,settings){var name=settings.spriteName;if(!name){ig.log("No Name!");return;}
this._displayobject=new cjs.Sprite(settings.world.spriteSheet,name);var b=this._displayobject.getBounds();var data=ig.GameConfig.obstacles[name]||{};this._displayobject.regX=data.regX||(b.width*0.5)-(b.width/2.75);this._displayobject.regY=data.regY||40;this.size.x=data.width||((b.width/2.75)*2.0);this.size.y=data.height||b.height-40;this.size.dx=b.width;this.size.dy=b.height;x-=this.size.x/2;y-=this.size.y;this.parent(x,y,settings);}});});

// lib/game/entities/willow.js
ig.baked=true;ig.module('game.entities.willow').requires('impact.entity','impact.world').defines(function(){ig.Willow=ig.Entity.extend({type:ig.Entity.TYPE.B,collides:ig.Entity.COLLIDES.NONE,init:function(x,y,settings){this._displayobject=new cjs.Sprite(settings.world.spriteSheet,settings.world.location+"_willow");var b=this._displayobject.getBounds();this.size.x=b.width;this.size.y=b.height;x-=this.size.x/2;y-=this.size.y/2-4;this._displayobject.regX=b.width/2;this._displayobject.regY=b.height/2;this.parent(x,y,settings);},draw:function(){this.parent();this._displayobject.x=this.pos.x+this._displayobject.regX;this._displayobject.y=this.pos.y+this._displayobject.regY;this.checkVisibility();},collect:function(){this.type=ig.Entity.TYPE.NONE;cjs.Sound.play("sfx_fw_chimes3");cjs.Tween.get(this._displayobject).to({alpha:0,scaleX:2,scaleY:2},800,cjs.Ease.cubicOut).call(this.kill,null,this);}});});

// lib/game/ppworld.js
ig.baked=true;ig.module('game.ppworld').requires('impact.world').defines(function(){ig.World.PPWorld=ig.World.extend({layers:[],groundY:540,location:"",mapStepSize:306,levelData:null,spriteSheet:null,willowCount:0,active:true,init:function(settings){this.parent(settings);this.initLayers();},initLayers:function(){this.levelData=ig.GameConfig.levelData[ig.Session.currentLocation.id];this.map=ig.Session.currentLocation.map;this.createWorld();},createWorld:function(){this.lastX=0;this.generateScenery();this.startTower=this.spawnEntity(ig.Tower,0,this.groundY);this.generateObstacles();this.generatePlatforms();this.generateWillows();this.endCheckpoint=this.spawnEntity(ig.Entity,this.lastX+this.mapStepSize*2,this.groundY-400,{size:{x:500,y:400},type:ig.Entity.TYPE.B,isCheckpoint:true});this.endTower=this.spawnEntity(ig.Tower,this.lastX+this.mapStepSize*2+500,this.groundY);this.endTower._displayobject.scaleX=-1;},generateScenery:function(){var q=ig.main.midQueue;var l=this.location;var sceneryList=this.levelData.scenery;for(var i=0;i<sceneryList.length;i++){var s=sceneryList[i];var layer={xFactor:s.xFactor,bitmaps:[],img:new cjs.Bitmap(q.getResult(l+"_"+s.id)).set({y:s.yPos})};this.layers.push(layer);var b=layer.img.getBounds();for(var j=0;j<2;j++){var bmp=j===0?layer.img:layer.img.clone();bmp.page=j;bmp.x=b.width*j;this._worldContainer.addChild(bmp);layer.bitmaps.push(bmp);}}
this.resetEntitiesToTop();},generateObstacles:function(){var arr=this.map.obstacles.split(",");for(var i=0;i<arr.length;i++){var code=arr[i];if(code==="---"){continue;}
var l=this.location;var data=this.getDataByCode(code);var name=l+"_"+data.name;var x=i*this.mapStepSize;if(this.lastX<x)this.lastX=x;this.spawnEntity(ig.Obstacle,x,data.hanging===true?230:this.groundY,{spriteName:name});}},generatePlatforms:function(){var arr=this.map.platforms.split(",");for(var i=0;i<arr.length;i++){var code=arr[i];if(code==="___"){continue;}
var letters="LMH";var yPos=this.groundY-140-letters.indexOf(code.charAt(1))*80;var x=i*this.mapStepSize;if(this.lastX<x)this.lastX=x;this.spawnEntity(ig.Platform,x,yPos);}},generateWillows:function(){var willows=[];var arr=this.map.willows.split(",");for(var i=0;i<arr.length;i++){var code=arr[i];if(code==="+++"){continue;}
var letters="GLMH";var x=i*this.mapStepSize;if(this.lastX<x)this.lastX=x;var yPos=this.groundY;var j=letters.indexOf(code.charAt(1));if(j>0){yPos=this.groundY-140-j*80;}
willows.push(this.spawnEntity(ig.Willow,x,yPos));}
while(willows.length>5){willows.shuffle();var w=willows.pop();this.removeEntity(w);}},getDataByCode:function(code){var arr=this.levelData.codes;for(var i=0;i<arr.length;i++){var d=arr[i];if(d.code===code){return d;}}},doWinCheck:function(){if(this.willowCount<5){var w=5-this.willowCount;cjs.Sound.play("luteplayer_missed"+w+"willows");}else{ig.log("Success Win!");this.player.active=false;ig.ScreenControl.current.win();}},resetEntitiesToTop:function(){this._worldContainer.addChild(this._entitiesContainer);if(this._debugDraw){this._worldContainer.addChild(this._debugContainer);}},update:function(){this.parent();if(ig.debug&&ig.input.state("shift")&&ig.input.state("d")){this.willowCount=99;ig.ScreenControl.current.updateCounter();this.doWinCheck();}
if(!this.player){return;}
this._worldContainer.x=-this.player.pos.x+300;for(var i=0;i<this.layers.length;i++){var l=this.layers[i];var b=l.img.getBounds();for(var j=0;j<2;j++){var img=l.bitmaps[j];img.x=this._worldContainer.x*l.xFactor+b.width*img.page;if(img.x+b.width<this._worldContainer.x*-1){img.page+=2;}else if(img.x>this._worldContainer.x*-1+b.width){img.page-=2;}}}}});});

// lib/impact/vo-sequence.js
ig.baked=true;ig.module('impact.vo-sequence').defines(function(){ig.VOSequence=ig.Class.extend({_sequence:[],_index:0,_callback:null,_current:null,init:function(){},play:function(callback){this._index=-1;this._callback=callback;this._next();},add:function(id,delay){this._sequence.push({id:id,delay:delay||0});return this;},_next:function(){this._index++;if(this._current){this._current.removeAllEventListeners();}
var seq=this._sequence[this._index];if(seq){this._current=cjs.Sound.play(seq.id,{delay:seq.delay});if(this._current){this._current.on("complete",this._onSoundComplete,this);}else{this._next();}}else if(this._callback){this._callback();}},_onSoundComplete:function(){this._next();}});});

// lib/game/game.js
ig.baked=true;ig.module('game.game').requires('display.background-stars','display.preloader','controllers.transition','controllers.screen','controllers.session','controllers.music','controllers.visibility','game.entities.player','utils.utils','game.entities.tower','game.entities.platform','game.entities.obstacle','game.entities.willow','game.ppworld','impact.world','impact.vo-sequence','impact.main').defines(function(){ig.SHEETS={};ig.LAYERS={};ig.SCREENS={TITLE:0,INTRO:1,CHARACTER_SELECT:2,PATH_SELECT:3,GAME:4,DESTINATION_SELECT:5,BOSS_BATTLE:6,END:7};ig.CHARACTERS={BECKY:"becky",TJ:"tj",VIOLET:"violet"};ig.PPMagicRescue=ig.Main.extend({stage:null,bgStage:null,preQueue:null,mainQueue:null,midQueue:null,_isMouseEnabled:false,firstTouchHandler:null,isAudioLimited:false,seenInstructions:false,backStars:null,world:null,init:function(){this.isAudioLimited=ig.ua.mobile&&!cjs.WebAudioPlugin.isSupported();cjs.Sound.EXTENSION_MAP.mp3="mpeg";ig.Visibility.addListeners();this.initializeCanvases();this.loadPreloads();},initializeCanvases:function(){ig.log("Initialize Stage");this.bgStage=ig.system.addStage(new createjs.Stage("bgCanvas"));this.bgStage.stopUpdate=true;this.bgStage.snapToPixelEnabled=true;this.bgStage.enableDOMEvents(false);this.stage=ig.system.addStage(new createjs.Stage("fgCanvas"));this.stage.snapToPixelEnabled=ig.ua.mobile;ig.input.initMouse(this.stage);ig.input.initKeyboard();ig.input.bind(ig.KEY.MOUSE1,'mouse');ig.input.bind(ig.KEY.LEFT_ARROW,'left');ig.input.bind(ig.KEY.UP_ARROW,'up');ig.input.bind(ig.KEY.RIGHT_ARROW,'right');ig.input.bind(ig.KEY.DOWN_ARROW,'down');ig.input.bind(ig.KEY.SPACE,'up');ig.input.bind(ig.KEY.SHIFT,'shift');ig.input.bind(ig.KEY.D,'d');if(!ig.ua.mobile){this._isMouseEnabled=true;this.stage.enableMouseOver(30);}},loadPreloads:function(){createjs.LoadQueue.loadTimeout=300000;ig.log("Load Pre Queue");this.preQueue=new createjs.LoadQueue(true,ig.prefix);this.preQueue.setMaxConnections(4);this.preQueueComplete=this.onPreQueueComplete.bind(this);this.preQueue.addEventListener("complete",this.preQueueComplete);this.preQueue.loadManifest([{id:"mainBG",src:"media/images/background.jpg"},{id:"loaderHorse",src:"media/images/loader-horse.png"},{id:"loaderSparkles",src:"media/images/loader-sparkles.png"},{id:"star",src:"media/images/star.png"},{id:"sparkle",src:"media/images/sparkle.png"},]);if(this.isAudioLimited){this.preQueue.loadFile({id:"singleTrackData",src:"media/audio/single.json"});this.preQueue.loadFile({id:"titleImage",src:"media/images/title-image.png"});this.preQueue.loadFile({id:"titlePlayBtn",src:"media/images/title-play-btn.png"});}else{this.preQueue.loadManifest([{id:"miscVOData",src:"media/audio/misc-vo.json"},{id:"sfxSoundData",src:"media/audio/sfx.json"},{id:"bossSoundData",src:"media/audio/bossbattle-vo.json"}]);}},onPreQueueComplete:function(){ig.log("onPreQueueComplete");this.preQueue.removeEventListener("complete",this.preQueueComplete);this.preQueueComplete=null;this.initLayers();if(this.isAudioLimited){ig.ScreenControl.goto(ig.SCREENS.TITLE);}else{this.startLoad();}},mobileTouch:function(){ig.ScreenControl.removeCurrent();this.goFullScreen();this.startLoad();},startLoad:function(){this.initSound();this.loadStartUpAssets();},goFullScreen:function(){var element=document.documentElement;if(element.requestFullscreen){element.requestFullscreen();}else if(element.mozRequestFullScreen){element.mozRequestFullScreen();}else if(element.webkitRequestFullscreen){element.webkitRequestFullscreen();}else if(element.msRequestFullscreen){element.msRequestFullscreen();}},onPlayClick:function(){if(ig.ua.mobile&&cjs.WebAudioPlugin.isSupported()&&cjs.WebAudioPlugin.isSupported()){cjs.WebAudioPlugin.playEmptySound();}
if(this.isAudioLimited){this.mobileTouch();}else{if(ig.ua.mobile){this.goFullScreen();}
ig.ScreenControl.goto(ig.SCREENS.INTRO);}},initSound:function(){ig.log("Initialize sounds");if(!cjs.Sound.initializeDefaultPlugins()){ig.log("Sound Problem!!!");return;}
cjs.Sound.alternateExtensions=["ogg","mp3"];cjs.Sound.defaultInterruptBehavior=cjs.Sound.INTERRUPT_EARLY;},initLayers:function(){var background=new cjs.Bitmap(this.preQueue.getResult("mainBG"));this.bgStage.addChild(background);this.bgStage.update();ig.LAYERS.STARS=this.stage.addChild(new cjs.Container());ig.LAYERS.GAME=this.stage.addChild(new cjs.Container());ig.LAYERS.GAME_UI=this.stage.addChild(new cjs.Container());ig.LAYERS.SCREENS=this.stage.addChild(new cjs.Container());ig.LAYERS.PRELOADER=this.stage.addChild(new cjs.Container());ig.LAYERS.TRANSITION=this.stage.addChild(new cjs.Container());ig.LAYERS.SCREENS.set({x:Math.round(ig.system.width*0.5),y:Math.round(ig.system.height*0.5)});this.backStars=new ig.BackgroundStars();this.preloader=new ig.Preloader();ig.LAYERS.PRELOADER.visible=false;if(ig.debug){ig.LAYERS.DEBUG=this.stage.addChild(new cjs.Container());var s=new cjs.Shape();s.graphics.f("#000000").r(0,0,20,14);ig.LAYERS.DEBUG.addChild(s);this.fpsTextbox=new cjs.Text("fps","11px Arial","#FFFFFF").set({x:2});ig.LAYERS.DEBUG.addChild(this.fpsTextbox);}},loadStartUpAssets:function(){ig.log("Load Startup Asset");this.fileLoadHandler=this.handleFileLoad.bind(this);this.mainLoadHandler=this.onStartUpAssetsComplete.bind(this);this.mainQueue=new createjs.LoadQueue(true,ig.prefix);this.mainQueue.stopOnError=true;this.mainQueue.setMaxConnections(4);this.mainQueue.installPlugin(cjs.Sound);this.mainQueue.addEventListener("fileload",this.fileLoadHandler);this.mainQueue.addEventListener("error",function(e){ig.log(e);});var soundData;if(this.isAudioLimited){soundData=this.preQueue.getResult("singleTrackData");this.mainQueue.loadManifest([{src:"media/audio/"+soundData.urls[1],data:{channels:1,audioSprite:soundData.audioSprite}}]);}else{soundData=this.preQueue.getResult("miscVOData");this.mainQueue.loadManifest([{src:"media/audio/"+soundData.urls[0],data:{channels:1,audioSprite:soundData.audioSprite}}]);soundData=this.preQueue.getResult("sfxSoundData");this.mainQueue.loadManifest([{src:"media/audio/"+soundData.urls[0],data:{channels:2,audioSprite:soundData.audioSprite}}]);soundData=this.preQueue.getResult("bossSoundData");this.mainQueue.loadManifest([{src:"media/audio/"+soundData.urls[0],data:{channels:1,audioSprite:soundData.audioSprite}}]);this.mainQueue.loadFile({id:"mainMusic",src:"media/audio/music/game_music_village.ogg"});}
if(!this.isAudioLimited){this.mainQueue.loadFile({id:"titleImage",src:"media/images/title-image.png"});this.mainQueue.loadFile({id:"titlePlayBtn",src:"media/images/title-play-btn.png"});}
this.mainQueue.addEventListener("complete",this.mainLoadHandler);this.mainQueue.loadManifest([{id:"transitionHeart",src:"media/images/transition-heart.png"},{id:"transitionPrincess",src:"media/images/transition-princess.png"},{id:"bgOverlay",src:"media/images/background-overlay.png"},{id:"IntroSlideshow",src:"media/animations/intro.js"},{id:"slide1",src:"media/images/intro/1.jpg"},{id:"slide2",src:"media/images/intro/2.jpg"},{id:"slide3",src:"media/images/intro/3.jpg"},{id:"slide4",src:"media/images/intro/4.jpg"},{id:"slide5",src:"media/images/intro/5.jpg"},{id:"slide6",src:"media/images/intro/6.jpg"},{id:"video_frame",src:"media/images/video_frame.png"},{id:"mainSheet",src:"media/images/mainsheet.png"},{id:"mainSheetData",src:"media/images/mainsheet.json"},{id:"housearama22Sheet",src:"media/fonts/housearama22.png"},{id:"housearama22Data",src:"media/fonts/housearama22.json"},{id:"riddleFontSheet",src:"media/fonts/riddlefont.png"},{id:"riddleFontData",src:"media/fonts/riddlefont.json"},{id:"counterFontSheet",src:"media/fonts/counter-font.png"},{id:"counterFontData",src:"media/fonts/counter-font.json"},{id:"characterSelectsSheet",src:"media/images/characterselects.png"},{id:"characterSelectsData",src:"media/images/characterselects.json"},{id:"CharacterSelects",src:"media/animations/character-selects.js"},{id:"choice-forest",src:"media/images/choice-forest.png"},{id:"choice-castle",src:"media/images/choice-castle.png"},{id:"choice-swamp",src:"media/images/choice-swamp.png"},{id:"choice-flowerfield",src:"media/images/choice-flowerfield.png"},{id:"choice-village",src:"media/images/choice-village.png"},{id:"choiceFrame",src:"media/images/choice-frame.png"},{id:"choice-boss-tower",src:"media/images/choice-boss-tower.png"},{id:"choice-boss-clouds",src:"media/images/choice-boss-clouds.png"},{id:"choice-boss-ice",src:"media/images/choice-boss-ice.png"},{id:"gameSheet",src:"media/images/gamesheet.png"},{id:"gameSheetData",src:"media/images/gamesheet.json"},{id:"riddleSheet",src:"media/images/riddlesheet.png"},{id:"riddleSheetData",src:"media/images/riddlesheet.json"},{id:"riddlePaper",src:"media/images/riddle_paper.png"},{id:"endSheet",src:"media/images/endanims.png"},{id:"endSheetData",src:"media/images/endanims.json"},{id:"CharacterEndings",src:"media/animations/character-endings.js"},{id:"endbackground",src:"media/images/endbackground.png"}]);if(ig.ua.mobile){this.mainQueue.loadFile({id:"instructions",src:"media/images/instructions-mobile.png"});}else{this.mainQueue.loadFile({id:"instructions",src:"media/images/instructions-desktop.png"});}
ig.LAYERS.PRELOADER.visible=true;this.preloader.queue=this.mainQueue;},onStartUpAssetsComplete:function(){ig.log("onMainQueueComplete");this.mainQueue.removeEventListener("fileload",this.fileLoadHandler);this.mainQueue.removeEventListener("complete",this.mainLoadHandler);this.mainLoadHandler=null;var data=this.mainQueue.getResult("mainSheetData");data.images=[this.mainQueue.getResult("mainSheet")];ig.SHEETS.MAIN=new createjs.SpriteSheet(data);data=this.mainQueue.getResult("characterSelectsData");data.images=[this.mainQueue.getResult("characterSelectsSheet")];ig.SHEETS.CHARACTER_SELECT=new cjs.SpriteSheet(data);data=this.mainQueue.getResult("housearama22Data");data.images=[this.mainQueue.getResult("housearama22Sheet")];ig.SHEETS.HOUSEARAMA_22=new cjs.SpriteSheet(data);data=this.mainQueue.getResult("riddleFontData");data.images=[this.mainQueue.getResult("riddleFontSheet")];ig.SHEETS.RIDDLE_FONT=new cjs.SpriteSheet(data);data=this.mainQueue.getResult("counterFontData");data.images=[this.mainQueue.getResult("counterFontSheet")];ig.SHEETS.COUNTER_FONT=new cjs.SpriteSheet(data);data=this.mainQueue.getResult("gameSheetData");data.images=[this.mainQueue.getResult("gameSheet")];ig.SHEETS.GAME=new cjs.SpriteSheet(data);data=this.mainQueue.getResult("riddleSheetData");data.images=[this.mainQueue.getResult("riddleSheet")];ig.SHEETS.RIDDLE_ICONS=new cjs.SpriteSheet(data);data=this.mainQueue.getResult("endSheetData");data.images=[this.mainQueue.getResult("endSheet")];ig.SHEETS.END=new cjs.SpriteSheet(data);ig.TransitionControl.build();this.startExperience();},startExperience:function(){ig.log("Start Experience");ig.Session.newData();ig.TransitionControl.animateUp(this.handlePreloadTransition.bind(this));},startNewGame:function(){ig.Session.newData();ig.TransitionControl.animateUp(this.handleNewGameTransition.bind(this));},progressGame:function(){ig.LAYERS.GAME.removeAllChildren();ig.ScreenControl.removeCurrent(0);if(ig.Session.getNumberOfLocationsPlayed()<2){ig.ScreenControl.goto(ig.SCREENS.PATH_SELECT);}else{ig.ScreenControl.goto(ig.SCREENS.DESTINATION_SELECT);}},handlePreloadTransition:function(){ig.LAYERS.SCREENS.visible=true;ig.LAYERS.PRELOADER.visible=false;var overlay=new cjs.Bitmap(this.mainQueue.getResult("bgOverlay"));this.bgStage.addChild(overlay);this.bgStage.update();if(this.isAudioLimited){ig.ScreenControl.goto(ig.SCREENS.INTRO);}else{ig.ScreenControl.goto(ig.SCREENS.TITLE);}},handleNewGameTransition:function(){ig.ScreenControl.removeCurrent(0);ig.LAYERS.SCREENS.visible=true;ig.LAYERS.PRELOADER.visible=false;ig.ScreenControl.goto(ig.SCREENS.CHARACTER_SELECT);},gotoPath:function(data){ig.Session.setPathChoice(data);this.loadWorld();},loadWorld:function(){ig.log("Load World");ig.ScreenControl.removeCurrent();if(this.midQueue){this.midQueue.removeAll();this.midQueue.removeAllEventListeners();}
var l=ig.Session.currentLocation;var lName=l.id;ig.LAYERS.PRELOADER.visible=true;this.midQueue=new createjs.LoadQueue(true,ig.prefix);this.midQueue.setMaxConnections(4);this.midQueue.installPlugin(cjs.Sound);this.midQueue.on("fileload",this.handleFileLoad,this);this.midQueue.on("complete",this.onWorldLoad,this);this.midQueue.loadManifest([{id:lName+"Sheet",src:"media/images/locations/"+lName+"/"+lName+"sheet.png"},{id:lName+"SheetData",src:"media/images/locations/"+lName+"/"+lName+"sheet.json"},{id:lName+"_back",src:"media/images/locations/"+lName+"/"+lName+"_back.png"},{id:lName+"_middle",src:"media/images/locations/"+lName+"/"+lName+"_middle.png"},{id:lName+"_front",src:"media/images/locations/"+lName+"/"+lName+"_front.png"},{id:lName+"_ground",src:"media/images/locations/"+lName+"/"+lName+"_ground.png"}]);if(!this.isAudioLimited){this.midQueue.loadFile({id:l.startSound,src:"media/audio/specifics/"+l.startSound+".ogg"});this.midQueue.loadFile({id:l.endSound,src:"media/audio/specifics/"+l.endSound+".ogg"});this.midQueue.loadFile({id:"locationRiddleQuestion",src:"media/audio/specifics/luteplayer_q_"+l.riddle.a+".ogg"});this.midQueue.loadFile({id:"locationRiddleAnswer",src:"media/audio/specifics/luteplayer_object_"+l.riddle.a+".ogg"});this.midQueue.loadFile({id:"locationMusic",src:"media/audio/music/"+l.music+".ogg"});}
switch(ig.Session.character){case"becky":this.midQueue.loadFile({id:"beckyRun",src:"media/images/becky.png"});break;case"tj":this.midQueue.loadFile({id:"tjRun",src:"media/images/tj.png"});break;case"violet":this.midQueue.loadFile({id:"violetRun",src:"media/images/violet.png"});break;}
this.midQueue.loadFile({id:"runData",src:"media/images/player-runs.json"});this.preloader.queue=this.midQueue;},onWorldLoad:function(fromTransition){ig.log("onWorldLoad:"+fromTransition);if(fromTransition===true){ig.LAYERS.SCREENS.visible=true;ig.LAYERS.PRELOADER.visible=false;ig.ScreenControl.goto(ig.SCREENS.GAME);}else{ig.MusicControl.stop();ig.TransitionControl.animateUp(this.onWorldLoad.bind(this));}},loadBossBattle:function(){ig.ScreenControl.removeCurrent();if(this.midQueue){this.midQueue.removeAll();this.midQueue.removeAllEventListeners();}
ig.LAYERS.PRELOADER.visible=true;this.midQueue=new createjs.LoadQueue(true,ig.prefix);this.midQueue.setMaxConnections(4);this.midQueue.installPlugin(cjs.Sound);this.midQueue.on("fileload",this.handleFileLoad,this);this.midQueue.on("complete",this.onBossBattleLoad,this);this.midQueue.loadManifest([{id:"BossBattleAnimation",src:"media/animations/boss-battles.js"},{id:"bossBattleSheetAll",src:"media/images/boss-battle-all.png"},{id:"bossBattleSheetBecky",src:"media/images/boss-battle-becky.png"},{id:"bossBattleSheetClouds",src:"media/images/boss-battle-clouds.png"},{id:"bossBattleSheetIce",src:"media/images/boss-battle-ice.png"},{id:"bossBattleSheetTJ",src:"media/images/boss-battle-tj.png"},{id:"bossBattleSheetTower",src:"media/images/boss-battle-tower.png"},{id:"bossBattleSheetViolet",src:"media/images/boss-battle-violet.png"},{id:"bossBattleSheetData",src:"media/images/boss-battle.json"},{id:"cloud-castle",src:"media/images/cloud-castle.png"},{id:"cloud-swamp",src:"media/images/cloud-swamp.png"},{id:"cloud-forest",src:"media/images/cloud-forest.png"},{id:"cloud-flowerfield",src:"media/images/cloud-flowerfield.png"},{id:"cloud-ice",src:"media/images/cloud-frigidlake.png"},{id:"cloud-tower",src:"media/images/cloud-tower.png"},{id:"cloud-clouds",src:"media/images/cloud-clouds.png"},{id:"cloud-village",src:"media/images/cloud-village.png"}]);if(!this.isAudioLimited){for(var i=0;i<ig.Session.visitedLocations.length;i++){var location=ig.Session.visitedLocations[i];var distractors=ig.GameConfig.bossBattles.distractors[location.vocab];var words=[location.vocab,distractors[0],distractors[1]];for(var j=0;j<words.length;j++){this.midQueue.loadFile({id:"luteplayer_word_"+words[j],src:"media/audio/specifics/luteplayer_word_"+words[j]+".ogg"});}}}
this.preloader.queue=this.midQueue;},onBossBattleLoad:function(fromTransition){ig.log("onBossBattleLoad:"+fromTransition);if(fromTransition===true){ig.LAYERS.SCREENS.visible=true;ig.LAYERS.PRELOADER.visible=false;ig.ScreenControl.goto(ig.SCREENS.BOSS_BATTLE);}else{ig.MusicControl.stop();ig.TransitionControl.animateUp(this.onBossBattleLoad.bind(this));}},onAssetsComplete:function(){ig.log("Assets Complete");this.mainQueue.removeEventListener("complete",this.mainLoadHandler);this.mainLoadHandler=null;},update:function(){if(ig.debug&&this.fpsTextbox){this.fpsTextbox.text=Math.round(cjs.Ticker.getMeasuredFPS());}
if(this.preloader&&ig.LAYERS.PRELOADER.visible){this.preloader.update();}
if(this.backStars){this.backStars.update();}
if(ig.TransitionControl){ig.TransitionControl.update();}
if(ig.ScreenControl){ig.ScreenControl.update();}
if(this.scene){this.scene.update();}
if(this.world){this.world.update();}},handleFileLoad:function(e){var item=e.item;var type=item.type;var result;ig.log("Loaded: "+item.src);},setSnapToPixel:function(active){this.stage.snapToPixelEnabled=active||ig.ua.mobile;ig.log("setSnapToPixel: "+this.stage.snapToPixelEnabled);}});ig.deploy=function(mediaPath){ig.prefix=mediaPath||"";ig.main(ig.PPMagicRescue,60,960,600);};});