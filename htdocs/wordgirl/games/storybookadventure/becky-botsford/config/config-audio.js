PBS.KIDS.storybook.audio = {
    player : {},

    narrations : {
        narration_1_default : [
            'ding'
        ],
        narration_1A : [
            '1000ms_of_silence',
            'ah_the_engrossing_dictionary'
        ],
        narration_1B : [
            '1000ms_of_silence',
            'the_exciting_princess_great_escape'
        ],
        narration_1C : [
            '1000ms_of_silence',
            'never_hurts_to_brush_up'
        ],
        narration_2_default : [
            'ding'
        ],
        narration_2A : [
            '1000ms_of_silence',
            'interested_in_this_marvelous'
        ],
        narration_2B : [
            '1000ms_of_silence',
            'hey_tj_why_dont_you'
        ],
        narration_2C : [
            '1000ms_of_silence',
            'this_sensational_soccer'
        ],
        narration_3_default : [
            'ding'
        ],
        narration_3A : [
            '1000ms_of_silence',
            'might_i_suggest_and_appetizing_apple'
        ],
        narration_3B : [
            '1000ms_of_silence',
            'one_delectable_ice_cream'
        ],
        narration_3C : [
            '1000ms_of_silence',
            'ive_got_just_the_thing'
        ]
    },

    clips : [

        {
            // Having completed her homework and vanquished Dr. Two Brains, Becky is ready for a little me time.
            clipId : 'having_completed_her_homework',
            startTime: 0,
            endTime: 7.540000,
            loop: false
        },
        {
            // Surveying. To survey means to look over something carefully. Becky surveyed her entire bookshelf to find the book she wanted to read.
            clipId : 'surveying_definition',
            startTime: 9.330000,
            endTime: 21.780000,
            loop: false
        },
        {
            // Pondered. To ponder means to think about something deeply. Becky pondered which book she really wanted to read.
            clipId : 'pondered_definition',
            startTime: 23.550000,
            endTime: 34.350000,
            loop: false
        },
        {
            // As Becky settles down with one of her favorites
            clipId : 'as_becky_settles',
            startTime: 36.140000,
            endTime: 39.710000,
            loop: false
        },
	    {
         // As Becky settles down with one of her favorites the
         clipId : 'as_becky_settles_the',
         startTime: 383.580000,
         endTime: 387.510000,
         loop: false
     },
        {
            // TJ bursts into the room, complaining of boredom
            clipId : 'tj_bursts_into_the_room',
            startTime: 41.500000,
            endTime: 45.690000,
            loop: false
        },
        {
            // Needing something to occupy TJ so she can get back to her book, Becky notices her
            clipId : 'needing_something_to_occupy',
            startTime: 47.480000,
            endTime: 55.070000,
            loop: false
        },
        {
            // Pleasant Pretty Princess Doll
            clipId : '2B',
            startTime: 56.860000,
            endTime: 59.450000,
            loop: false
        },
        {
            // Marvelous unicorn
            clipId : '2A',
            startTime: 61.240000,
            endTime: 63.620000,
            loop: false
        },
        {
            // Sensational soccer ball
            clipId : '2C',
            startTime: 65.410000,
            endTime: 67.810000,
            loop: false
        },
        {
            // How can i keep TJ busy so i can get back to my book?
            clipId : 'how_can_i_keep_tj',
            startTime: 69.600000,
            endTime: 73.820000,
            loop: false
        },
        {
            // Contemplated Becky
            clipId : 'contemplated_becky',
            startTime: 75.610000,
            endTime: 77.310000,
            loop: false
        },
        {
            // Hey TJ, why don't you play with this pleasant pretty princess doll?
            clipId : 'hey_tj_why_dont_you',
            startTime: 79.100000,
            endTime: 83.100000,
            loop: false
        },
        {
            // Suggested Becky
            clipId : 'suggested_becky',
            startTime: 84.890000,
            endTime: 86.640000,
            loop: false
        },
        {
            // Interested in this marvelous unicorn, TJ? It's all yours.
            clipId : 'interested_in_this_marvelous',
            startTime: 88.430000,
            endTime: 93.270000,
            loop: false
        },
        {
            // Offered Becky
            clipId : 'offered_becky',
            startTime: 95.060000,
            endTime: 96.400000,
            loop: false
        },
        {
            // This sensational soccer ball isn't going to kick itself, TJ.
            clipId : 'this_sensational_soccer',
            startTime: 98.190000,
            endTime: 102.320000,
            loop: false
        },
        {
            // Announced Becky, tossing it his way.
            clipId : 'announced_becky_tossing',
            startTime: 104.110000,
            endTime: 107.260000,
            loop: false
        },
        {
            // Contemplated. To contemplate means to think seriously about something. Becky contemplated how best to distract TJ.
            clipId : 'contemplated_definition',
            startTime: 109.050000,
            endTime: 119.020000,
            loop: false
        },
        {
            // Happy to play with
            clipId : 'happy_to_play_with',
            startTime: 120.800000,
            endTime: 122.690000,
            loop: false
        },
	    {
         // Happy to play with the
         clipId : 'happy_to_play_with_the',
         startTime: 379.610000,
         endTime: 381.780000,
         loop: false
     },
        {
            // TJ left the room allowing Becky to return to her book, the
            clipId : 'tj_left_the_room_allowing',
            startTime: 124.480000,
            endTime: 130.110000,
            loop: false
        },
        {
            // Just then, a famished Bob moped into the room
            clipId : 'just_then_a_famished_bob',
            startTime: 131.900000,
            endTime: 136.060000,
            loop: false
        },
        {
            // Taking advantage of the peace and quiet, Becky decides to read a book. Surveying her bookshelf she sees the
            clipId : 'taking_advantage_of_the_peace',
            startTime: 137.850000,
            endTime: 147.420000,
            loop: false
        },
        {
            // Knowing a hungry Bob would never leave her be, Becky looked for food and noticed
            clipId : 'knowing_a_hungry_bob_would',
            startTime: 149.210000,
            endTime: 155.580000,
            loop: false
        },
        {
            // An appetizing apple
            clipId : '3A',
            startTime: 157.370000,
            endTime: 159.930000,
            loop: false
        },
        {
            // Scrumptious snappy snaps
            clipId : '3C',
            startTime: 161.680000,
            endTime: 164.330000,
            loop: false
        },
        {
            // A delectable ice cream sundae
            clipId : '3B',
            startTime: 166.120000,
            endTime: 169.750000,
            loop: false
        },
        {
            // Which of these will alleviate Bob's hunger?
            clipId : 'which_of_these_will_alleviate',
            startTime: 171.500000,
            endTime: 174.380000,
            loop: false
        },
        {
            // Deliberated Becky
            clipId : 'deliberated_becky',
            startTime: 176.170000,
            endTime: 178.190000,
            loop: false
        },
        {
            // Might I suggest and appetizing apple?
            clipId : 'might_i_suggest_and_appetizing_apple',
            startTime: 179.980000,
            endTime: 182.800000,
            loop: false
        },
        {
            // Smiled Becky
            clipId : 'smiled_becky',
            startTime: 184.590000,
            endTime: 186.270000,
            loop: false
        },
        {
            // I've got just the thing for you Bob, scrumptious snappy snaps.
            clipId : 'ive_got_just_the_thing',
            startTime: 188.060000,
            endTime: 192.000000,
            loop: false
        },
        {
            // Exclaimed Becky
            clipId : 'exclaimed_becky',
            startTime: 193.790000,
            endTime: 195.460000,
            loop: false
        },
        {
            // One delectable ice cream sundae coming up.
            clipId : 'one_delectable_ice_cream',
            startTime: 197.250000,
            endTime: 200.770000,
            loop: false
        },
        {
            // Stated Becky
            clipId : 'stated_becky',
            startTime: 202.560000,
            endTime: 204.140000,
            loop: false
        },
        {
            // Alleviate. Alleviate means to reduce or remove something. Becky wanted to find a food to alleviate Bob's hunger to make him less hungry or not hungry at all.
            clipId : 'alleviate_definition',
            startTime: 205.930000,
            endTime: 221.120000,
            loop: false
        },
        {
            // After helping Bob find a suitable snack
            clipId : 'after_helping_bob_find',
            startTime: 222.900000,
            endTime: 226.160000,
            loop: false
        },
        {
            // And entertaining TJ with the
            clipId : 'and_entertaining_tj',
            startTime: 227.950000,
            endTime: 230.710000,
            loop: false
        },
        {
            // Becky was finally ready to dig into the
            clipId : 'becky_was_finally_ready',
            startTime: 232.500000,
            endTime: 235.980000,
            loop: false
        },
        {
            // But before she could, Becky's super hearing picked up on the energy monster wreaking havoc downtown. Maybe there will be time to relax tomorrow
            clipId : 'but_before_she_could_beckys',
            startTime: 237.770000,
            endTime: 249.770000,
            loop: false
        },
        {
            // The End
            clipId : 'the_end',
            startTime: 251.560000,
            endTime: 252.760000,
            loop: false
        },
        {
            // Suitable. Suitable means when something is right for what you need. Becky helped Bob find a snack that was suitable, one that he liked.
            clipId : 'suitable_definition',
            startTime: 254.550000,
            endTime: 265.820000,
            loop: false
        },
        {
            // The Exciting Princess Trianna and the Ogre of Castlebaum
            clipId : '1B',
            startTime: 267.600000,
            endTime: 272.050000,
            loop: false
        },
        {
            // Famished. Famished means very hungry. Bob was so famished that he was moping.
            clipId : 'famished_definition',
            startTime: 273.840000,
            endTime: 282.610000,
            loop: false
        },
        {
            // Absorbing Superheroes and You: A Practical Guide
            clipId : '1C',
            startTime: 284.400000,
            endTime: 289.080000,
            loop: false
        },
        {
            // Engrossing Dictionary
            clipId : '1A',
            startTime: 290.870000,
            endTime: 293.240000,
            loop: false
        },
        {
            // Hmm, what to read, what to read?
            clipId : 'hmm_what_to_read',
            startTime: 295.030000,
            endTime: 298.310000,
            loop: false
        },
        {
            // Pondered Becky
            clipId : 'pondered_becky',
            startTime: 300.100000,
            endTime: 301.570000,
            loop: false
        },
        {
            // The Exciting Princess Trianna and the Ogre of Caslebaum will be a great escape!
            clipId : 'the_exciting_princess_great_escape',
            startTime: 303.360000,
            endTime: 307.880000,
            loop: false
        },
        {
            // Proclaimed Becky
            clipId : 'proclaimed_becky',
            startTime: 309.670000,
            endTime: 311.310000,
            loop: false
        },
        {
            // Never hurts to brush up on crime-fighting techniques. The Absorbing Superheroes and You: A Practical Guide it is.
            clipId : 'never_hurts_to_brush_up',
            startTime: 313.100000,
            endTime: 320.380000,
            loop: false
        },
        {
            // Decided Becky
            clipId : 'decided_becky',
            startTime: 322.170000,
            endTime: 323.800000,
            loop: false
        },
        {
            // Ah, the engrossing Dictionary. You can't top the classics.
            clipId : 'ah_the_engrossing_dictionary',
            startTime: 325.590000,
            endTime: 329.890000,
            loop: false
        },
        {
            // Determined Becky
            clipId : 'determined_becky',
            startTime: 331.680000,
            endTime: 333.310000,
            loop: false
        },
        {
            // ding
            clipId : 'ding',
            startTime: 335.000000,
            endTime: 337.50000,
            loop: false
        },

	    {
	        // Vanquished- To vanquish means to win at a battle and to defeat someone. WordGirl beat Dr. Two Brains.
			clipId : 'vanquished_definition',
			startTime: 344.990000,
			endTime: 354.000000,
			loop: false
        },
	    {
		    // Occupy – to occupy means to take your time and attention. Becky needs something to occupy TJ so that she can read her book.
			clipId : 'occupy_definition',
			startTime: 355.790000,
			endTime: 366.360000,
			loop: false
        },
	    {
		    // Havoc – Havoc means destruction, disorder, and chaos.  The Energy Monster was causing great confusion and damage downtown.
			clipId : 'havoc_definition',
			startTime: 368.150000,
			endTime: 378.660000,
			loop: false
        },

        // other
        {
            // (one second of silence)
            clipId : '1_second_of_silence',
            startTime: 8.000000,
            endTime: 9.000000,
            loop: false
        },
        {
            // 200ms os silence
            clipId : '200ms_of_silence',
            startTime: 8.000000,
            endTime: 8.200000,
            loop: false
        },
        {
            // 500ms os silence
            clipId : '500ms_of_silence',
            startTime: 8.000000,
            endTime: 8.500000,
            loop: false
        },
        {
            // 750ms os silence
            clipId : '750ms_of_silence',
            startTime: 8.000000,
            endTime: 8.750000,
            loop: false
        },
        {
            // 1 second of silence
            clipId : '1000ms_of_silence',
            startTime: 8.000000,
            endTime: 9.00000,
            loop: false
        }
    ],

    getClip : function(clipId) {
        return _.findWhere(PBS.KIDS.storybook.audio.clips, {
            clipId : clipId
        });
    },

    combineClips : function(clipIds) {
        var self = PBS.KIDS.storybook.audio;
        var soundObj = null;
		console.log('------------');
        // recursively nest the soundObj from the previous iteration into the one from the current iteration
        _.each(clipIds.reverse(), function(clipId, i) {
			console.log(clipId);
            // sound object has not been created yet.
            if(!_.isNull(soundObj)) {
                // save the value of "clipId" to find later (answer to {{choice1}}, {{choice2}}, etc)
                if (clipId === '{{choice1}}' || clipId === '{{choice2}}' || clipId === '{{choice3}}') {
                    soundObj = _.extend(
                        { next : soundObj },
                        { calculate : clipId }  // calculate {{choice1}}, {{choice2}}, or {{choice3}}
                    );
                }
                else if (clipId === '{{narration1}}' || clipId === '{{narration2}}' || clipId === '{{narration3}}') {
                    soundObj = _.extend(
                        { next : soundObj },
                        { narration : clipId }
                    );
                }
                // if clip exists
                else {
                    soundObj = _.extend(
                        { next : soundObj },
                        self.getClip(clipId)
                    );
                }
            }
            // if a soundObj hasn't been defined yet, create a new one instead of nesting
            else {
                if (clipId === '{{choice1}}' || clipId === '{{choice2}}' || clipId === '{{choice3}}') {
                    soundObj =  { calculate : clipId };  // calculate {{choice1}}, {{choice2}}, or {{choice3}}
                }
                else if (clipId === '{{narration1}}' || clipId === '{{narration2}}' || clipId === '{{narration3}}') {
                    soundObj =  { narration : clipId };
                }
                else {
                    soundObj = self.getClip(clipId);
                }
            }
        });
	    console.log(soundObj);
	    console.log('------------');
        return soundObj;
    },

    playNext : function(soundObj) {
        var self = PBS.KIDS.storybook.audio;

        if(soundObj && soundObj.next && self.player) {

            if(soundObj.next.calculate) {
                var choiceIndex = soundObj.next.calculate.replace(/[^\d]/g, ''); // extracts 1 from {{choice1}}
                var clipId = PBS.KIDS.storybook.choices.getOptionSelectedKey(choiceIndex); // gets the current option selected by the user for choice

                // if a clip id was found for the returned option key, add the audio clip
                if(clipId) {
                    clipId = choiceIndex + clipId;
                    var clip = PBS.KIDS.storybook.audio.getClip(clipId);

                    // a clip matching the generated clipId was found
                    if (clip) {
                        _.extend(soundObj.next, clip);
                        self.player.play(soundObj.next)
                    }
                    else {
                        console.log('{{ could not find sound clip for generated clip ' + clipId + ' }}');
                        self.playNext(soundObj.next);
                    }
                }
                // otherwise, skip to next item in the chain
                else {
                    console.log('{{ user has not made choice ' + choiceIndex + ' yet }}');
                    self.playNext(soundObj.next);
                }
            }

            else if(soundObj.next.narration) {
                var choiceIndex = soundObj.next.narration.replace(/[^\d]/g, ''); // extracts 1 from {{narration1}}
                var clipId = PBS.KIDS.storybook.choices.getOptionSelectedKey(choiceIndex); // gets the current option selected by the user for choice

                // narration_1A, narration_2C, etc
                if(clipId) {
                    clipId = choiceIndex + clipId;
                    var clip = self.combineClips(self.narrations['narration_' + clipId]);
                }
                // narration_1_default, narration_2_default, etc
                else {
                    var clip = self.combineClips(self.narrations['narration_' + choiceIndex + '_default']);
                }
                if (clip) {
                    _.extend(soundObj.next, clip);
                    self.player.play(soundObj.next)
                }
                else {
                    console.log('{{ could not find sound clip for generated clip ' + clipId + ' }}');
                    self.playNext(soundObj.next);
                }
            }

            else {
                self.player.play(soundObj.next)
            }
        }
    }
};